<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../mincss/mui.min.css">
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav">
			<a class="mui-icon mui-icon-back mui-action-back fl cfff"></a>
			<a class="mui-icon mui-text cfff fr hide" id="pic">删除</a>
			<a class="mui-icon mui-text cfff fr hide" id="mypic">完成</a>
			<a class="mui-icon mui-icon-plus fr cfff hide" id="addfan" onclick="AddUser()"></a>
			<div class="mui-title cfff" id="title"></div>
		</header>
	</body>

</html>
<script src="../minjs/mui.min.js"></script>
<script src="../js/base.min.js"></script>
<script type="text/javascript">
	var tempview = null;
	var currview = null;
	var appendview = [];

	mui.init({
		gestureConfig: {
			doubletap: true
		}
	});

	mui.ready(function() {
		base.Immersed();
	});

	mui.plusReady(function() {
		tempview = plus.webview.currentWebview();
		mui.back = function() {
			var list = tempview.children();
			if(list.length > 0) {
				tempview.remove(currview);
				if(currview)
					currview.close();
			}
			if(list.length == 1) {
				tempview.hide("auto", base.AnimateDuration);
				appendview = [];
				mui.later(function() {
					base.Get("title").innerHTML = "";
					base.AddClass(["#pic", "#mypic", "#addfan"], "hide");
				}, base.AnimateDuration)
			} else {
				currview = base.GetView(appendview[list.length - 2].id);
			}
		}
	})

	//加载子页面
	function InitPage(id, url, title, param, top) {
		appendview.push({
			id: id,
			url: url,
			title: title
		});

		var inittop = base.Get("header").clientHeight + "px";
		if(!top) {
			base.Get("title").innerHTML = title;
		} else {
			inittop = top;
		}
		if(base.IsNullOrEmpty(param)) {
			param = {};
		} else {
			param = JSON.parse(param);
		}

		currview = plus.webview.create(url, id, {
			top: inittop,
			bottom: "0px",
			bounce: "vertical",
			scrollIndicator: "none"
		}, param);
		tempview.append(currview);

		//点击关闭遮罩层
		tempview.addEventListener("maskClick", function() {
			tempview.setStyle({
				mask: "none"
			});
		}, false);

		//事件监听
		if(id == "pic") {
			base.Get("pic").addEventListener("tap", function() {
				if(base.RepeatAction()) {
					return;
				}
				currview.evalJS("Confirm()");
			}, false);
		}
		if(id == "mypic") {
			base.Get("mypic").addEventListener("tap", function() {
				if(base.RepeatAction()) {
					return;
				}
				currview.evalJS("Confirm()");
			}, false);
		}

		//返回顶部
		base.Get("header").addEventListener("doubletap", function() {
			if(base.RepeatAction()) {
				return;
			}
			currview.evalJS("Top()");
		}, false);
	}

	//重置标题
	function InitTitle(title) {
		base.Get("title").innerHTML = title;
	}

	//重置操作
	function InitAction(id, show) {
		if(show) {
			base.Get(id).classList.remove("hide");
		} else {
			base.Get(id).classList.add("hide");
		}
	}

	//遮罩层
	function Mask(show) {
		if(show) {
			tempview.setStyle({
				mask: "rgba(0,0,0,0.6)"
			});
		} else {
			tempview.setStyle({
				mask: "none"
			});
		}
	}

	//添加关注
	function AddUser() {
		base.OpenWindow("addfan", "addfan.html", {});
	}
</script>