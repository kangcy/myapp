<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/loading.min.css">
		<link rel="stylesheet" href="../css/animate.css">
		<link rel="stylesheet" href="../css/input.min.css">
		<link rel="stylesheet" href="../font-awesome-4.6.3/css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="../css/articledetail.css">
	</head>

	<body id="body">
		<header class="mui-bar mui-bar-nav" id="header">
			<a class="mui-icon mui-icon-back mui-action-back fl c333"></a>
			<div onclick="ActionTan(1)" class="hide" id="action">
			</div>
			<h1 class="mui-title c333 user" id="title"></h1>
		</header>
		<div class="loading" id="loader">
			<div class="card">
				<span class="circles-loader"></span>
			</div>
		</div>
		<div id="self" class="full tc hide">
			<img src="../images/article/stop.png" class="none" />
			<p class="mt20 f16 c333">私密文章</p>
			<p class="mt10 f12 c999">您查看的是私密文章,仅作者自己可见</p>
		</div>
		<div id="password" class="full tc hide">
			<img src="../images/article/stop.png" class="none" />
			<p class="mt20 f12 c999">文章已设权限,请输入密码浏览</p>
			<div id="input-form">
				<div class="pwd mt10 mui-input-row">
					<input id='pwd' type="password" class="mui-input-password text f13" placeholder="请输入位密码" maxlength="4" /><span class="mui-icon mui-icon-eye" style="top:0.8rem !important;"></span>
				</div>
				<div id="submit" class="input mt20 tc fl">
					解&nbsp;锁
				</div>
			</div>
		</div>

		<div class="mui-bar mui-bar-tab hide" id="bottomAction" style="background:#fff;">
			<div id="addcomment">
				<div class="c666 f12">我来说一句</div>
			</div>
			<div id="footer" class="c999">
				<div>
					<span id="zan" class="mui-icon fa fa-thumbs-up" style="font-size:20px;"><span class="mui-badge mui-badge-danger" style="margin-left:0px;" id="footer_zan">0</span></span>
				</div>
				<div>
					<span id="comment" class="mui-icon fa fa-comments" style="font-size:20px;"><span class="mui-badge mui-badge-danger" style="margin-left:0px;" id="footer_comment">0</span></span>
				</div>
				<div>
					<span id="share" class="mui-icon fa fa-share-alt" style="font-size:20px;" onclick="ShareTan(1)"></span>
				</div>
			</div>
		</div>
		<!--模板选择-->
		<img class="hide" src="../images/article/skin.png" onclick="TempTan(1)" id="btnTemp"></i>
		<i class="fa fa-check-circle hide" style="font-size:50px;color:#ed5565;" id="agreeTemp" onclick="ChooseTan()"></i>
		<div id="temps" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control boxshadow hide">
			<div class="mui-scroll" style="height:100px;margin-top:10px;" id="temp">
				<div class="mui-control-item temp f12" tid="0" color="#fff" type="0">
					<div style="background:#fff;line-height:80px;">纯白</div>
				</div>
				<div class="mui-control-item temp f12" tid="1" color="#fff" type="1">
					<div style="line-height:80px;">自定义</div>
				</div>
			</div>
		</div>
		<!--分享-->
		<div class="mytanbg hide" id="mysharebg" onclick="ShareTan(0)"></div>
		<div class="myshare hide" id="myshare">
			<p class="f16 c000 tc mt10 mb0">分享到</p>
			<div class="tc c000 myshare_body">
				<div class="myshare_items" onclick="ShareAction(1)"><img src="../images/share/1.jpg" />
					<p class="f11 mb0 c000">朋友圈</p>
				</div>
				<div class="myshare_items" onclick="ShareAction(2)"><img src="../images/share/2.jpg" />
					<p class="f11 mb0 c000">微信</p>
				</div>
				<div class="myshare_items" onclick="ShareAction(3)"><img src="../images/share/3.jpg" />
					<p class="f11 mb0 c000">新浪微博</p>
				</div>
				<div class="myshare_items" onclick="ShareAction(4)"><img src="../images/share/4.jpg" />
					<p class="f11 mb0 c000">QQ</p>
				</div>
				<div class="myshare_items" onclick="ShareAction(5)"><img src="../images/share/5.jpg" />
					<p class="f11 mb0 c000">QQ空间</p>
				</div>
				<div class="myshare_items" onclick="ShareAction(6)"><img src="../images/share/6.jpg" />
					<p class="f11 mb0 c000">其他</p>
				</div>
				<div class="myshare_items" onclick="ShareAction(7)"><img src="../images/share/7.jpg" />
					<p class="f11 mb0 c000">复制链接</p>
				</div>
				<div id="isnotkeep" class="myshare_items" onclick="ShareAction(8)"><img src="../images/share/8.jpg" />
					<p class="f11 mb0 c000" style="">收藏</p>
				</div>
				<div id="iskeep" class="myshare_items hide"><img src="../images/share/10.jpg" />
					<p class="f11 mb0 c000" style="">收藏</p>
				</div>
				<div class="myshare_items" onclick="ShareAction(9)"><img src="../images/share/9.jpg" />
					<p class="f11 mb0 c000">举报</p>
				</div>
				<div class="c000 mt10 f11 fl btnExit" onclick="ShareTan(0)">取消</div>
			</div>
		</div>
		<!--操作-->
		<div class="mytanbg hide" id="myactionbg" onclick="ActionTan(0)"></div>
		<div class="myaction boxshadow hide" id="myaction">
			<div class="tc c000 myaction_body">
				<div class="myaction_items" onclick="Delete()"><img src="../images/article/1.png" />
					<p class="f13 red">删除</p>
				</div>
				<div class="myaction_items" onclick="Copy()"><img src="../images/article/2.png" />
					<p class="f13 c000">复制</p>
				</div>
				<div class="myaction_items" onclick="Edit()"><img src="../images/article/3.png" />
					<p class="f13 c000">编辑</p>
				</div>
				<div class="myaction_items" onclick="Power()"><img src="../images/article/4.png" />
					<p class="f13 c000">权限</p>
				</div>
				<div class="myaction_items" onclick="ShowSide()"><img src="../images/article/5.png" />
					<p class="f13 c000">背景</p>
				</div>
			</div>
		</div>
		<!--打赏-->
		<img class="tada hide" src="../images/article/money.png" onclick="PaymentTan()" style="width:4rem;z-index:99;" id="btnPay"></i>
		<!--自定义背景-->
		<div id="custom" class="custom tc hide">
			<div class="full">
				<span class="span1 f13 cfff" onclick="NotAgree(0)">取消</span>
				<span class="span2 f13 cfff" onclick="Agree(0)">完成</span>
				<div class="items f13">
					<div class="item curr" onclick="ChangeCustom(0)">全屏</div>
					<div class="item" onclick="ChangeCustom(1)">居顶</div>
					<div class="item" onclick="ChangeCustom(2)">居底</div>
				</div>
			</div>
		</div>
		<div class="mui-iframe-wrapper hide" id="wrapper" style="top:46px;bottom:50px;">
			<div class="mui-content mui-scroll-wrapper bg">
				<div class="mui-scroll" id="bg">
					<!--通用样式-->
					<div id="main0" class="f13 tl mt20 mb10 hide">
						<div class="detail">
							<div class="full tl">
								<p class="f16 c000" id="title0"></p> 
								<span class="mt0 mb0 csubtitle f13" id="createdate0"></span>
								<span class="mb0 ml10 user mt5 blue" userid="0" id="nickname0"></span>
								<span class="mt0 mb0 ml10 csubtitle f13" id="views0"></span>
								<p id="music0" play="on" class="music mb10" onclick="switchsound()">
									<i></i>
									<span id="musicname0"></span>
								</p>
							</div>
						</div>
					</div>
					<!--排版1-->
					<div id="main1" class="f13 tc hide">
						<div class="full">
							<div class="full" style="position:relative;">
								<img id="useravatar1" class="mt30" />
								<p class="full user mt10 textshadow f15 cfff" userid="0" id="nickname1"></p>
								<i id="music1" class="fa fa-music f13" onclick="switchsound()" style="position:absolute;right:10px;top:10px"></i>
							</div>
						</div>
						<div class="detail cover cover1 fl">
							<div class="full">
								<p class="mt20 f16 c333" id="title1"></p>
								<p class="mb0 full csubtitle f13">
									<span id="createdate1" class="mr15"></span>
									<span class="ml15" id="views1"></span>
								</p>
							</div>
						</div>
					</div>
					<div class="detail2 cover cover2 fl tl mb20">
						<div class="c000 full" id="desc">

						</div>
					</div>
				</div>
			</div>
		</div>
	</body>

</html>
<script src="../js/jquery-1.10.2.min.js"></script>
<script src="../js/mui.min.js"></script>
<script src="../js/base.js"></script>
<script src="../js/music.js"></script>
<script type="text/javascript" src="http://player.youku.com/jsapi"></script>
<script type="text/javascript" src="../js/video.js"></script>
<script type="text/javascript">
	var Article = {};
	var ArticleID = 0; //文章ID
	var Source = ""; //来源
	var ShareInfo = {}; //分享信息
	var isLoading = false;
	var currEditID = 0; //当前操作对象ID
	var MusicID = ""; //音乐控件ID
	var MusicUrl = "";
	var CurrBackground = 0; //当前选中背景设置
	var CurrCover = ""; //当前背景图片
	var CurrTemplate = 0; //当前选中模板
	var userinfo = base.GetUserInfo();
	var $zan = document.getElementById('zan');

	//显示遮罩
	var mask = mui.createMask(function() {});
	var $custom = $("#custom");

	//启用双击监听 
	mui.init({
		gestureConfig: {
			doubletap: true
		}
	});

	mui.ready(function() {

		base.InitScroll();

		//模板选择
		mui('#temps').on('tap', '.temp', function() {
			$(".temp").removeClass("hover");
			var $this = $(this);
			$this.addClass("hover");
			CurrTemplate = $this.attr("tid");
			if(CurrTemplate == 1) {
				CurrCover = Article.Cover;
			} else {
				CurrCover = $this.attr("cover");
			}

			$("#wrapper").css("background-color", $this.attr("color"));

			var templatetype = $this.attr("type");

			//纯白背景
			if(templatetype == 0) {
				$("#main1").addClass("hide");
				$("#main0").removeClass("hide");
			} else {
				$("#main0").addClass("hide");
				$("#main1").removeClass("hide");
			}
			ChangeBg(CurrBackground); //背景切换

			ChangeMusic(templatetype); //音乐切换
		});

		//点赞
		$zan.addEventListener('tap', function(event) {
			if(isLoading) {
				return;
			}
			isLoading = true;
			if($zan.getAttribute("already") == "1") {
				isLoading = false;
				return mui.toast("已赞");
			}
			HttpGet(base.RootUrl + "Api/Zan/Edit", {
				ID: userinfo.ID,
				ArticleID: ArticleID
			}, function(data) {
				data = JSON.parse(data);
				if(data != null) {
					if(data.result) {
						$zan.setAttribute("already", "1");
						$zan.classList.add("heartbeat");
						$zan.classList.add("red");
						$("#footer_zan").html(data.message);
					}
				}
				isLoading = false;
			});
		})

		//添加评论
		document.getElementById('addcomment').addEventListener('tap', function(event) {
			base.OpenWindow("articleComment", "articleComment.html", {
				ArticleID: ArticleID,
				ArticleNumber: Article.Number,
				Action: "Add"
			});
		})

		//文章评论
		document.getElementById('comment').addEventListener('tap', function(event) {
			base.OpenWindow("articleComment", "articleComment.html", {
				ArticleID: ArticleID,
				ArticleNumber: Article.Number
			});
		});

		//解锁
		document.getElementById('submit').addEventListener('tap', function(event) {
			if(isLoading) {
				return false;
			}
			isLoading = true;
			var pwd = document.getElementById("pwd").value;
			if(base.IsNullOrEmpty(pwd)) {
				isLoading = false;
				return mui.toast("请填写解锁密码");
			}
			CheckPowerPwd(ArticleID, pwd, function() {
				$("#password").addClass("hide");
				$("#wrapper").removeClass("hide");
				isLoading = false;
			});
		});

		//打开外链
		mui('#detail').on('tap', 'span.link', function() {
			if(base.RepeatAction()) {
				return;
			}
			var link = this.getAttribute("link");
			if(base.IsNullOrEmpty(link)) {
				return;
			}
			base.OpenWindow("showhref", "showhref.html", {
				Link: link
			});
		});

		base.ShowUser("#body");
	});

	var Intent = null,
		File = null,
		Uri = null,
		main = null;
	var self = null,
		wc = null;

	mui.plusReady(function() {

		self = plus.webview.currentWebview();
		Source = self.Source || "Add";
		ArticleID = self.ArticleID || 0;
		NickName = self.NickName || "";
		document.getElementById("title").innerHTML = NickName;

		Load(function() {
			plus.webview.close("addarticle");

			//加载模板
			LoadTemplate();
		});

		//返回
		mui.back = function() {
			if(Source == "Add") {
				plus.webview.close("editimage");
			}
			plus.webview.close(self);
		}

		//系统定位
		base.GetCurrentPosition();

		//分享设置
		updateSerivces();

		if(plus.os.name == "Android") {
			Intent = plus.android.importClass("android.content.Intent");
			File = plus.android.importClass("java.io.File");
			Uri = plus.android.importClass("android.net.Uri");
			main = plus.android.runtimeMainActivity();
		}
	});

	//验证权限密码
	function CheckPowerPwd(articleid, pwd, callback) {
		HttpGet(base.RootUrl + "Article/CheckPowerPwd", {
			ArticleID: articleid,
			ArticlePowerPwd: pwd
		}, function(data) {
			if(data != null) {
				if(data.result) {
					if(callback) {
						callback();
					}
					return;
				}
			}
			mui.toast("解锁失败");
		});
	}

	//复制到剪贴板
	function CopyToClip() {
		var Context = plus.android.importClass("android.content.Context");
		var main = plus.android.runtimeMainActivity();
		var clip = main.getSystemService(Context.CLIPBOARD_SERVICE);
		plus.android.invoke(clip, "setText", ShareInfo.Url);
		mui.toast("分享链接已复制到剪贴板");
	}

	//更新文章评论数
	function UpdateComment() {
		Article.Comments += 1;
		$("#footer_comment").html(Article.Comments);
	}

	//重新加载数据 
	function UpdateDetail() {
		Load(function() {
			plus.webview.close("addarticle");
		});
	}

	//加载文章
	function Load(callback) {
		HttpGet(base.RootUrl + "Api/Article/Detail", {
			Number: userinfo.Number,
			ArticleID: ArticleID
		}, function(data) {
			data = JSON.parse(data);
			if(data != null) {
				if(data.result) {
					data = data.message;
					$("#title").html(data.NickName);

					//不是本人
					if(userinfo.Number != data.CreateUserNumber) {
						//私密可见 
						if(data.ArticlePower == 0) {
							$("#wrapper").addClass("hide");
							$("#self").removeClass("hide");
						}
						//密码可见
						else if(data.ArticlePower == 1) {
							$("#wrapper").addClass("hide");
							$("#password").removeClass("hide");
						} else {
							$("#wrapper").removeClass("hide");
						}
					} else {
						$("#wrapper").removeClass("hide");
					}

					Article = data;
					MusicUrl = data.MusicUrl;

					$("#payuser").attr("src", base.ShowThumb(data.Avatar, 1));
					$(".user").attr("userid", data.CreateUserNumber);

					//段落
					var html = []; 
					var parts = data.ArticlePart;
					for(var i = 0; i < parts.length; i++) {
						var part = parts[i];
						if(part.Types == 1) {
							//图片
							html.push('<div class="full f13 mt10"><img src="' + base.ShowThumb(part.Introduction, 1) + '" class="full" /></div>');
						} else if(part.Types == 2) {
							//文本
							html.push('<div class="full f13 mt10">' + part.Introduction + '</div>');
						} else if(part.Types == 3) {
							//视频
							html.push('<div class="full f13 mt10">' + AppendVideo(part.Introduction) + '</div>');
						}
					}

					if(data.IsZan > 0) {
						$zan.setAttribute("already", "1");
						$zan.classList.add("red");
					}

					$("#footer_zan").html(data.Goods);
					$("#footer_comment").html(data.Comments);

					//排版
					CurrCover = data.Cover;
					var mainIndex = 0;
					if(data.TemplateJson.ID > 0) {
						mainIndex = data.TemplateJson.TemplateType;
						CurrCover = data.TemplateJson.Cover;
						$("#wrapper").css("background-color", data.TemplateJson.Background);
					}
					CurrTemplate = data.Template;
					CurrBackground = data.Background;

					if(!base.IsNullOrEmpty(CurrCover)) {
						ChangeBg(CurrBackground);
					}

					$("#musicname0,#musicname1").html(data.MusicName);
					$("#useravatar0,#useravatar1").attr("src", base.ShowThumb(data.Avatar, 1));
					$("#title0,#title1").html(data.Title);
					$("#nickname0,#nickname1").html(data.NickName);
					$("#createdate0,#createdate1").html(data.CreateDateText);
					$("#views0,#views1").html("阅读  " + data.Views);
					$("#desc").html(html.join(""));

					//实例化播放器
					$(".youku_player").each(function() {
						var $this = $(this);
						ShowVideo($this.attr("id"), $this.attr("sid"));
					});

					//音乐
					ChangeMusic(mainIndex);

					$("#main" + mainIndex).removeClass("hide");

					document.getElementById("loader").classList.add("hide");

					//显示操作
					if(userinfo.ID == data.UserID) {
						$("#action").removeClass("hide");
						$("#btnTemp").removeClass("hide");
					} else {
						base.ShowUser("#body");
					}

					$("#bottomAction").removeClass("hide").addClass("bounceIn");

					//启用打赏
					if(data.IsPay == 1) {
						$("#btnPay").removeClass("hide");
					}

					//分享信息
					ShareInfo.Title = (userinfo.ShareNick == 1 ? "[" + userinfo.NickName + "]" : "") + data.Title;
					ShareInfo.Cover = data.Cover;
					ShareInfo.Url = data.ShareUrl;

					//收藏状态
					if(data.IsKeep == 1) {
						$("#iskeep,#isnotkeep").toggleClass("hide");
					}
				} else {
					mui.toast(data.message);
					plus.webview.currentWebview().close();
				}
			}
			if($.isFunction(callback)) {
				callback();
			}
			setTimeout(function() {
				base.CloseWaiting();
			}, 300);
		});
	}

	//切换音乐
	function ChangeMusic(index) {
		MusicID = "music" + index;
		if(!base.IsNullOrEmpty(MusicUrl)) {
			if(Article.AutoMusic == 1) {
				document.addEventListener('touchstart', startsound);
			}
			$("#music0,#music1").removeClass("hide");
		} else {
			$("#music0,#music1").addClass("hide");
		}
	}

	//删除
	function Delete() {
		ActionTan(0);
		var btnArray = ['确定', '取消'];
		mui.confirm('删除后将无法在浏览器中浏览', '确定要删除这篇文章吗？', btnArray, function(e) {
			if(e.index == 0) {
				HttpGet(base.RootUrl + "Article/Delete", {
					ID: userinfo.ID,
					ArticleID: ArticleID
				}, function(data) {
					if(data != null) {
						if(data.result) {
							plus.webview.close("articledetail");
							var articlePage = plus.webview.getWebviewById("articleSub");
							if(articlePage) {
								articlePage.evalJS("Delete(" + ArticleID + ")");
							}
						}
					}
				});
			}
		});
	}

	//复制
	function Copy() {
		if(isLoading) {
			return;
		}
		isLoading = true;
		ActionTan(0);
		mask.show();
		base.ShowWaiting("正在复制");
		HttpGet(base.RootUrl + "Article/Copy", {
			ID: userinfo.ID,
			ArticleID: ArticleID,
			Province: base.Province,
			City: base.City,
			District: base.District,
			Street: base.Street,
			DetailName: base.DetailName,
			CityCode: base.CityCode,
			Latitude: base.Latitude,
			Longitude: base.Longitude
		}, function(data) {
			setTimeout(function() {
				base.CloseWaiting();
				mask.close();
				mui.toast(data.result ? "复制成功,请刷新我的动态查看" : data.message);
				isLoading = false;
			}, 500);
		});
	}

	//编辑 
	function Edit() {
		ActionTan(0);
		mask.show();
		base.ShowWaiting("正在同步文章内容");
		base.OpenWindow("addarticle", "addarticle.html", {
			ArticleID: ArticleID,
			ArticleNumber: Article.Number,
			Source: Source
		});
		setTimeout(function() {
			mask.close();
		}, 2000);
	}

	//权限
	function Power() {
		ActionTan(0);
		base.OpenWindow("sharesetting", "sharesetting.html", {
			ArticleID: ArticleID,
			ArticleNumber: Article.Number,
			ArticlePower: Article.ArticlePower,
			ArticlePowerPwd: Article.ArticlePowerPwd,
			ArticleType: Article.TypeID,
			ArticleTypeName: Article.TypeName
		});
	}

	//背景状态切换
	function ChangeBg(index) {
		CurrBackground = index;

		var $bg = $("#bg");

		if(CurrTemplate > 0) {
			if(CurrTemplate == 1) {
				$("#bg").css({
					"background": "none",
				});
				$bg = $("#wrapper");
			} else {
				$("#wrapper").css({
					"background-image": "none",
				});
				$bg = $("#bg");
			}
		}

		//纯白背景
		if(CurrTemplate == 0) {
			$bg.css("background", "#fff");
		} else if(CurrTemplate > 1) {
			$bg.css({
				"background": "url(" + CurrCover + ") top center no-repeat",
				"background-size": "100% auto"
			});
		} else {
			switch(index) {
				case 0:
					//全屏
					$bg.css({
						"background": "url(" + CurrCover + ") no-repeat",
						"background-size": "100% 100%",
					});
					break;
				case 1:
					//居顶
					$bg.css({
						"background": "url(" + CurrCover + ") no-repeat top center",
						"background-size": "100% auto"
					});
					break;
				case 2:
					//居底
					$bg.css({
						"background": "url(" + CurrCover + ") bottom center repeat",
						"background-size": "100% auto"
					});
					break;
				default:
					break;
			}
		}
	}

	//取消修改背景设置
	function NotAgree() {
		if(base.RepeatAction()) {
			return;
		}
		CustomTan(0);
		ChangeBg(Article.Background);
	}

	//修改背景设置
	function Agree() {
		if(isLoading) {
			return;
		}
		isLoading = true;
		if(Article.Background == CurrBackground) {
			isLoading = false;
			CustomTan(0);
			return;
		}
		CustomTan(0);
		HttpGet(base.RootUrl + "Article/EditBackground", {
			ID: userinfo.ID,
			ArticleID: ArticleID,
			Background: CurrBackground
		}, function(data) {
			if(data.result) {
				Article.Background = CurrBackground;
			}
			isLoading = false;
		});
	}

	//收藏
	function Keep() {
		if(isLoading) {
			return;
		}
		isLoading = true;
		HttpGet(base.RootUrl + "Keep/Edit", {
			ID: userinfo.ID,
			ArticleID: ArticleID
		}, function(data) {
			if(data != null) {
				if(data.result) {
					userinfo.Keeps += 1;
					$("#iskeep,#isnotkeep").toggleClass("hide");
				}
				mui.toast(data.result ? "收藏成功" : data.message);
			}
			isLoading = false;
		});
	}

	//加载模板
	function LoadTemplate() {
		HttpGet(base.RootUrl + "Article/Template", {}, function(data) {
			if(data != null) {
				var length = data.records;
				if(length > 0) {
					var table = $('#temp');
					var index = 0;
					for(var i = 0, len = data.list.length; i < len; i++) {
						index += 1;
						var item = data.list[i];
						table.append('<div class="mui-control-item temp ' + (item.ID == CurrTemplate ? "hover" : "") + '" tid="' + item.ID + '" color="' + item.Background + '" cover="' + item.Cover + '" type="' + item.TemplateType + '"><img src="' + item.ThumbUrl + '" /></div>');
					}
				}
			}
		});
	}

	//重新加载数据
	function UpdatePower(ArticlePower, ArticlePowerPwd, ArticleType, ArticleTypeName) {
		Article.ArticlePower = ArticlePower;
		Article.ArticlePowerPwd = ArticlePowerPwd;
		Article.TypeID = ArticleType;
		Article.TypeName = ArticleTypeName;
	}

	//显示侧滑页面
	function ShowSide() {
		if(CurrTemplate != 1) {
			return mui.toast("仅自定义模板可用");
		}
		ActionTan(0);
		CustomTan(1);
	}

	//分享
	var shares = null; //分享服务
	var shareImageUrl = ''; //分享图片地址

	//更新分享服务
	function updateSerivces() {
		plus.share.getServices(function(s) {
			shares = {};
			for(var i in s) {
				var t = s[i];
				shares[t.id] = t;
			}
		}, function(e) {
			console.log("获取分享服务列表失败：" + e.message);
		});
	}

	//分享弹窗
	function ShareTan(index) {
		if(Article.ArticlePower == 0) {
			return mui.toast("私密文章不可以分享");
		}
		if(index == 0) {
			$("#mysharebg").addClass("hide");
			$("#myshare").removeClass("bounceIn").addClass("bounceOut");
		} else {
			$("#myshare").removeClass("hide").removeClass("bounceOut").addClass("bounceIn");
			$("#mysharebg").removeClass("hide");
		}
	}

	//操作弹窗
	function ActionTan(index) {
		if(index == 0) {
			$("#myactionbg").addClass("hide");
			$("#myaction").removeClass("bounceIn").addClass("bounceOut");
		} else {
			$("#myactionbg").removeClass("hide");
			$("#myaction").removeClass("hide").removeClass("bounceOut").addClass("bounceIn");
		}
	}

	//打开支付
	function PaymentTan() {
		base.OpenWindow("money", "money.html", {
			ArticleNumber: Article.Number,
			ArticleUserNumber: Article.UserNumber,
			Name: Article.NickName,
			Avatar: Article.Avatar
		});
	}

	//模板选择弹窗
	function TempTan(index) {
		if(index == 0) {
			$("#agreeTemp,#temps").addClass("hide");
			$("#btnTemp").removeClass("hide");
		} else {
			$("#btnTemp").addClass("hide");
			$("#agreeTemp,#temps").removeClass("hide");
		}
	}

	//自定义背景弹窗
	function CustomTan(index) {
		if(index == 0) {
			$custom.removeClass("bounceIn").addClass("bounceOut");
		} else {
			$custom.find(".curr").removeClass("curr");
			$custom.find(".item:eq(" + CurrBackground + ")").addClass("curr");
			$custom.removeClass("hide").removeClass("bounceOut").addClass("bounceIn");
		}
	}

	function ChangeCustom(index) {
		$custom.find(".curr").removeClass("curr");
		$custom.find(".item:eq(" + index + ")").addClass("curr");
		ChangeBg(index);
	}

	//确认模板
	function ChooseTan() {
		if(isLoading) {
			return;
		}
		isLoading = true;
		if(Article.Template == CurrTemplate) {
			isLoading = false;
			TempTan(0);
			return;
		}
		TempTan(0);
		HttpGet(base.RootUrl + "Article/EditArticleTemp", {
			ID: userinfo.ID,
			ArticleID: ArticleID,
			Template: CurrTemplate
		}, function(data) {
			isLoading = false;
		});
	}

	//分享信息
	function ShareAction(index) {
		ShareTan(0); //关闭分享弹窗

		//系统分享
		if(index == 6) {
			ShareSystem();
			return;
		}
		//复制链接
		if(index == 7) {
			CopyToClip();
			return;
		}
		//收藏
		if(index == 8) {
			Keep();
			return;
		}
		//举报
		if(index == 9) {
			base.OpenWindow("edittext", "edittext.html", {
				source: "report",
				ArticleNumber: Article.Number
			});
			return;
		}

		var id = "";
		var ex = "";
		switch(index) {
			//朋友圈
			case 1:
				id = "weixin";
				ex = "WXSceneTimeline";
				break;
				//微信
			case 2:
				id = "weixin";
				ex = "WXSceneSession";
				break;
				//新浪微博
			case 3:
				id = "sinaweibo";
				ex = "";
				break;
				//qq
			case 4:
				id = "qq";
				ex = "";
				break;
				//qq空间
			case 5:
				id = "qq";
				ex = "";
				break;
			default:
				break;
		}
		var s = null;
		if(!id || !(s = shares[id])) {
			console.log("无效的分享服务！");
			return;
		}
		if(s.authenticated) {
			shareMessage(s, ex, id);
		} else {
			mui.toast("授权中");
			s.authorize(function() {
				shareMessage(s, ex, id);
			}, function(e) {
				mui.toast("认证授权失败");
			});
		}
	}

	//系统分享
	function ShareSystem() {
		if(plus.os.name !== "Android") {
			plus.nativeUI.alert("此平台暂不支持系统分享功能");
			return;
		}
		var intent = new Intent(Intent.ACTION_SEND);
		intent.setType("text/plain");
		intent.putExtra(Intent.EXTRA_SUBJECT, "");
		intent.putExtra(Intent.EXTRA_TEXT, "分享自「微篇」" + ShareInfo.Title + " " + ShareInfo.Url);
		intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
		main.startActivity(Intent.createChooser(intent, "系统分享"));
		base.ShareLog(userinfo.ID, Article.Number, "system");
	}

	//发送分享信息
	function shareMessage(s, ex, id) {
		var msg = {
			href: ShareInfo.Url,
			title: ShareInfo.Title,
			content: "分享自「微篇」",
			thumbs: [ShareInfo.Cover],
			pictures: [ShareInfo.Cover],
			extra: {
				scene: ex
			}
		};
		s.send(msg, function() {
			mui.toast("分享成功");
			base.ShareLog(userinfo.ID, Article.Number, id);
		}, function(e) {
			mui.toast("分享失败");
		});
	}
</script>