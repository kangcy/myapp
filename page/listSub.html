<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>朋友圈</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/img.preview.css">
		<style type="text/css">
			.onefloor {
				width: 100%;
				height: 150px;
				overflow: hidden;
			}
			
			.onefloor img {
				width: 100%;
				min-height: 100%;
			}
			
			.secondfloor {
				width: 50%;
				height: 120px;
				text-align: center;
				overflow: hidden;
				margin-bottom: 1.5%;
				float: left;
			}
			
			.secondfloor img {
				width: 97%;
				min-height: 100%;
			}
		</style>
	</head>

	<body>
		<!--下拉刷新容器-->
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<div id="scroll-view">
				</div>
			</div>
		</div>
	</body>

</html>
<script src="../js/default.js"></script>
<script src="../js/mui.min.js"></script>
<script src="../js/mui.zoom.js"></script>
<script src="../js/mui.previewimage.js"></script>
<script src="../js/mui.lazyload.js"></script>
<script src="../js/mui.lazyload.img.js"></script>
<script>
	var id = 0;
	var count = 0;
	mui.init({
		pullRefresh: {
			container: '#pullrefresh',
			down: {
				callback: pulldownRefresh
			},
			up: {
				contentrefresh: '正在加载...',
				contentnomore: '没有更多数据了',
				callback: pullupRefresh
			}
		}
	});

	mui.previewImage();

	/**
	 * 下拉刷新具体业务实现
	 */
	function pulldownRefresh() {
		setTimeout(function() {
			var table = document.getElementById('scroll-view');
			table.innerHTML = "";
			count = 1;
			id = 0;
			/*document.body.removeAttribute('data-lazyload');*/
			for(var i = 0, len = i + 10; i < len; i++) {
				++id;

				var div = document.createElement('div');
				div.className = 'mui-card';
				var model = [];
				model.push('<div class="mui-card-header mui-card-media user">');
				model.push('<img data-lazyload="../images/logo.png" style="border-radius:50%;width:2.5rem;height:2.5rem;" /><div class="mui-media-body f11">小M<span class="fr caaa">前天</span></div></div>');
				model.push('<div class="mui-card-content show"><div class="mui-card-content-inner">');
				model.push('<p class="c333 fl article full">测试</p>');

				model.push('</div></div>');
				model.push('<div class="mui-card-footer fl full"><span style="border:1px solid #459df5;color:#459df5;border-radius:5px;padding:5px 10px;" class="f11">其它</span><span class="f11">0次阅 · 0评论 · 0喜欢 · 0打赏</span></div>');
				div.innerHTML = model.join('');

				/*var div = document.createElement('div');
				div.className = 'mui-card';
				var model = [];
				model.push('<div class="mui-card-header mui-card-media">');
				model.push('<img src="../images/logo.png" /><div class="mui-media-body">小M<p>Posted on January 18, 2016</p></div></div>');
				model.push('<div class="mui-card-content show"><div class="mui-card-content-inner">');
				var num = parseInt(Math.random() * 4);
				if(num == 1) {
					model.push('<div class="onefloor"><img data-lazyload="http://www.dcloud.io/hellomui/images/' + parseInt(Math.random() * 5 + 1) + '.jpg?version=' + Math.random() * 1000 + '" data-preview-src="" data-preview-group="' + id + '" /></div>');
				}
				if(num > 1) {
					for(var j = 1; j <= num; j++) {
						model.push('<div class="secondfloor"><img data-lazyload="http://www.dcloud.io/hellomui/images/' + parseInt(Math.random() * 5 + 1) + '.jpg?version=' + Math.random() * 1000 + '" data-preview-src="" data-preview-group="' + id + '" /></div>');
					}
				}
				model.push('<p class="c333 fl mt10">这里显示文章摘要，让读者对文章内容有个粗略的概念...</p>');
				model.push('</div></div>');
				model.push('<div class="mui-card-footer fl full"><a class="mui-card-link">Like</a><a class="mui-card-link">Read more</a></div>');
				div.innerHTML = model.join('');*/
				table.insertBefore(div, table.firstChild); //下拉刷新，新纪录插到最前面；
			}
			mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
			mui('#pullrefresh').pullRefresh().refresh(true); //重置上拉加载控件
			document.body.removeAttribute('data-imageLazyload');
			mui(document).imageLazyload({
				placeholder: '../images/60x60.gif',
				diff: window.innerHeight
			});
		}, 1000);
	}

	/**
	 * 上拉加载具体业务实现
	 */
	function pullupRefresh() {
		setTimeout(function() {
			mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > 2)); //参数为true代表没有更多数据了。
			var table = document.getElementById('scroll-view');
			var cells = document.body.querySelectorAll('.mui-card');
			for(var i = cells.length, len = i + 10; i < len; i++) {
				++id;
				var div = document.createElement('div');
				div.className = 'mui-card';
				var model = [];
				/*model.push('<div class="mui-card-header mui-card-media">');
				model.push('<img src="../images/logo.png" /><div class="mui-media-body">小M<p>Posted on January 18, 2016</p></div></div>');
				model.push('<div class="mui-card-content show"><div class="mui-card-content-inner">');*/

				model.push('<div class="mui-card-header mui-card-media user">');
				model.push('<img src="../images/logo.png" style="border-radius:50%;" /><div class="mui-media-body f11">小M<span class="fr caaa">13小时前</span></div></div>');
				model.push('<div class="mui-card-content show"><div class="mui-card-content-inner">');

				var num = parseInt(Math.random() * 4);
				if(num == 1) {
					model.push('<div class="onefloor"><img data-lazyload="http://www.dcloud.io/hellomui/images/' + parseInt(Math.random() * 5 + 1) + '.jpg?version=' + Math.random() * 1000 + '" data-preview-src="" data-preview-group="' + id + '" /></div>');
				}
				if(num > 1) {
					for(var j = 1; j <= num; j++) {
						model.push('<div class="secondfloor"><img data-lazyload="http://www.dcloud.io/hellomui/images/' + parseInt(Math.random() * 5 + 1) + '.jpg?version=' + Math.random() * 1000 + '" data-preview-src="" data-preview-group="' + id + '" /></div>');
					}
				}
				model.push('<p class="c333 fl mt10">这里显示文章摘要，让读者对文章内容有个粗略的概念...</p>');
				model.push('</div></div>');
				model.push('<div class="mui-card-footer fl full"><a class="mui-card-link">Like</a><a class="mui-card-link">Read more</a></div>');
				div.innerHTML = model.join('');
				table.appendChild(div);
			}
			mui(document).imageLazyload({
				placeholder: '../images/60x60.gif',
				diff: window.innerHeight
			});
		}, 1000);
	}
	if(mui.os.plus) {
		mui.plusReady(function() {
			setTimeout(function() {
				mui('#pullrefresh').pullRefresh().pullupLoading();
			}, 1000);

		});
	} else {
		mui.ready(function() {
			mui('#pullrefresh').pullRefresh().pullupLoading();
		});
	}
</script>