<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/animate.css">
		<style type="text/css">
			.mui-bar {
				background: #fff;
			}
			
			#signature {
				width: 75%;
				line-height: 20px;
				white-space: normal;
			}
			
			.mui-table-view-cell {
				padding: .8rem 0.9375rem;
			}
			
			.mui-table-view-cell:after {
				left: 0.9375rem;
				right: 0.9375rem;
			}
			
			.mui-table-view:after {
				height: 0px;
			}
			
			#url {
				border: 0px;
				height: 150px;
				padding: 10px;
				line-height: 1.25rem;
			}
			/**进度条**/
			
			progress {
				border-radius: 2px;
				background-color: #eee;
				height: 1rem;
			}
			
			progress::-webkit-progress-bar {
				background-color: #d7d7d7;
			}
			
			progress::-webkit-progress-value {
				background-color: #aadd6a;
			}
			
			.myprogress {
				position: fixed;
				left: 0px;
				top: 0px;
				width: 100%;
				z-index: 1000;
			}
			
			.myprogress .myaction_body {
				width: 100%;
				padding: 5%;
				display: inline-block;
			}
			
			.mui-table-view:after {
				height: 0px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a id="back" class="mui-icon mui-icon-back fl c333"></a>
			<h1 class="mui-title c333">编辑视频</h1>
		</header>
		<div class="mui-content">
			<ul class="mui-table-view f13 mt0">
				<li class="mui-table-view-cell tc">
					<p class="f18 c333 mt20">GO支持导入(优酷)视频</p>
					<p class="f13 blue mt10 mb10" onclick="Notice()">如何获取视频网页地址?</p>
				</li>
				<li class="mui-table-view-cell" id="apply">
					<p class="f13 c333">有优酷账号</p>
					<p class="f11 blue mt5">可以导入账号下收藏和上传的视频</p>
				</li>
				<li class="mui-table-view-cell" id="addurl" onclick="ActionTan(1)">
					<p class="f13 c333">没有优酷账号</p>
					<p class="f11 blue mt5">从视频网页地址导入</p>
				</li>
				<li class="mui-table-view-cell" onclick="showActionSheet()">
					<p class="f13 c333">本地视频导入</p>
					<p class="f11 blue mt5">用户自定义10秒短视频</p>
				</li>
			</ul>
		</div>
		<div class="mytanbg hide" id="mytanbg"></div>
		<div class="boxshadow hide" id="notice" style="position:fixed;bottom:30%;left:5%;width:90%;z-index:99999;background:#fff;">
			<div style="padding:30px;padding-bottom:15px;">
				<textarea id='url' class="mui-input-clear f12 mb0" placeholder="请粘贴视频网页地址" maxlength="250"></textarea>
			</div>
			<div class="full" style="height:2.5rem;line-height:2.5rem;position:relative;border-top:1px solid #eee;">
				<div style="width:50%;" class="tc fl f13" onclick="NotAgree(0)">取消</div>
				<div style="width:50%;" class="tc fl f13" id="agree">确定</div>
				<div style="width:1px;height:100%;border-left:1px solid #eee;position:absolute;left:50%;bottom:0px;"></div>
			</div>
		</div>
		<!--视频同步进度条-->
		<div class="mytanbg hide" id="myprogressbg"></div>
		<div class="myprogress hide" id="myprogress">
			<div class="tc c000 myaction_body">
				<ul class="mui-table-view f13" style="border-radius: 20px;">
					<li class="mui-table-view-cell">
						<p class="full tl mb10 c333" id="checkupdate">正在压缩视频文件</p>
						<progress class="fl" value="" max="" id="proDownFile" style="width:80%;"></progress>
						<span class="persent fl ml10 caaa" id="persent" style="line-height:1rem;">0%</span>
					</li>
				</ul>
			</div>
		</div>
	</body>

</html>
<script src="../js/default.js"></script>
<script src="../js/jquery-1.10.2.min.js"></script>
<script src="../js/mui.min.js"></script>
<script src="../js/base.js"></script>
<script src="../js/video.copper.js"></script>
<script type="text/javascript">
	var isLoading = false;
	var ArticleID = 0;
	var ArticleNumber = ""; //文章编号
	var userinfo = base.GetUserInfo();
	mui.init({
		gestureConfig: {
			doubletap: true
		},
		swipeBack: false //启用右滑关闭功能
	});

	mui.plusReady(function() {

		//判断网络状态
		base.NetChange();

		//获取参数
		var self = plus.webview.currentWebview();
		ArticleID = self.ArticleID || 0;
		ArticleNumber = self.ArticleNumber;

		//返回
		mui.back = function() {
			var self = plus.webview.currentWebview();
			plus.webview.close(self);
		}

		//返回
		document.getElementById('back').addEventListener('tap', function(e) {
			mui.back();
		});

		document.getElementById('agree').addEventListener('tap', function(e) {
			if(isLoading) {
				return;
			}
			isLoading = true;
			var url = document.getElementById("url");
			if(base.IsNullOrEmpty(url.value)) {
				return mui.toast('请粘贴视频网页地址');
			}
			AddVideo(url.value, 0);
		});

		/*var Intent = plus.android.importClass("android.content.Intent");
		    var Uri = plus.android.importClass("android.net.Uri");
		    var main = plus.android.runtimeMainActivity();
		    var intent=new Intent(Intent.ACTION_VIEW);
		    var uri=Uri.parse("网络视频地址");
		    intent.setDataAndType(uri,"video/*");
		    main.startActivity(intent);*/

	});

	function NotAgree() {
		ActionTan(0);
		isLoading = false;
	}

	//操作弹窗
	function ActionTan(index) {
		if(index == 0) {
			$("#mytanbg").addClass("hide");
			$("#notice").removeClass("bounceIn").addClass("bounceOut").addClass("hide");
		} else {
			$("#mytanbg").removeClass("hide");
			$("#notice").removeClass("hide").removeClass("bounceOut").addClass("bounceIn");
		}
	}

	function Notice() {
		base.OpenWindow("videonotice", "videonotice.html", {});
	}

	//编辑视频
	function AddVideo(url, index) {
		HttpGet(base.RootUrl + "ArticlePart/Edit", {
			ID: userinfo.ID,
			Introduction: url,
			Types: 3,
			ArticleNumber: ArticleNumber,
			VideoType: index
		}, function(data) {
			base.CloseWaiting();
			if(data == null) {
				mui.toast("失败");
			} else {
				if(data.result) {
					var parentPage = plus.webview.getWebviewById("addarticle");
					if(parentPage) {
						parentPage.evalJS("AddVideo('" + data.message.ID + "','" + data.message.Url + "')");
					}
					mui.back();
				} else {
					mui.toast(data.message);
				}
			}
			isLoading = false;
		});
	}
</script>