<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../cropper/cropper.css">
	</head>

	<body>
		<!--图片显示容器-->
		<div class="mui-content">
			<div id="changeAvatar" class="touxiang tc" onclick="showActionSheet()">
				<!--触发选择图片事件-->
				<img src="../images/60x60.gif" style="width:60%;" />
			</div>
			<div style="width:90%;margin: 0 auto;margin-top:30px;">
				<button type="button" class="mui-btn mui-btn-primary mui-btn-block" style="height: 40px;" onclick="postAvatar()">确认提交</button>
				<!--保存数据事件-->
			</div>
		</div>
		<!--图片编辑容器-->
		<div id="cropperEdit" class="mui-iframe-wrapper full">
			<img id="readyimg" />
			<div class="flex-container tc">
				<a><span class="mui-icon mui-icon-closeempty" onclick="closepop()"></span></a>
				<!--关闭裁剪窗口-->
				<a><span class="mui-icon mui-icon-undo" onclick="rotateimgleft()"></span></a>
				<!--左旋转90度-->
				<a><span class="mui-icon mui-icon-redo" onclick="rotateimgright()"></span></a>
				<!--右旋转90度-->
				<a><span class="mui-icon mui-icon-checkmarkempty" onclick="confirm()"></span></a>
				<!--确定选择-->
			</div>
		</div>
	</body>

</html>
<script src="../js/default.js"></script>
<script src="../js/jquery-1.10.2.min.js"></script>
<script src="../js/mui.min.js"></script>
<script src="../cropper/cropper.min.js"></script>
<script src="../js/base.js"></script>
<script src="../js/copper.js"></script>
<script type="text/javascript">
	var currUserID = base.GetUserID(); //当前登录用户ID

	//启用双击监听
	mui.init({
		gestureConfig: {
			doubletap: true
		},
		swipeBack: false
	});

	//post内容  
	function postAvatar() {
		if(mui.os.plus) {
			plus.nativeUI.showWaiting();
		}

		var petimage = $("#changeAvatar > img").attr("src"); //此时取到的图片已经是base64形式  
		//你的处理代码，改post到服务器了，服务器接收同接收普通post参数一样，只是，存图片的字段改成ntext，这是sql的数据类型，其他数据库同类型，jq的getJSON可能会不执行，因为getJSON是get模式，图片转成base64后，很容易超出最大长度，其实，经过压缩后，一般不会超出的，具体压缩方法下文有  
		if(mui.os.plus) {
			plus.nativeUI.closeWaiting();
		}
	}

	mui.plusReady(function() {
		//判断网络类型
		if(plus.networkinfo.getCurrentType() == plus.networkinfo.CONNECTION_NONE) {
			mui.toast("网络异常，请检查网络设置！");
		}

	});
</script>