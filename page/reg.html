<!DOCTYPE html>
<html class="ui-page-login">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="../css/mui.min.css" rel="stylesheet" />
		<style type="text/css">
			#login-form {
				display: inline-block;
				width: 100%;
			}
			
			#login-form .div1,
			#login-form .div2,
			#login-form .div3,
			#login-form .div4 {
				width: 85%;
				margin: 0px 7.5%;
				border-radius: 30px;
				height: 2.5rem;
				line-height: 2.5rem;
			}
			
			#login-form .div1 {
				background: #EFEFEF;
				background-image: url(../images/login/phone.png);
				background-repeat: no-repeat;
				background-position: 0.8rem 0.5rem;
				background-size: 1.5rem;
			}
			
			#login-form .div2 {
				background: #EFEFEF;
				background-image: url(../images/login/pwd.png);
				background-repeat: no-repeat;
				background-position: 0.8rem 0.5rem;
				background-size: 1.5rem;
			}
			
			#login-form .div3 {
				background: #EFEFEF;
				background-image: url(../images/login/user.png);
				background-repeat: no-repeat;
				background-position: 0.8rem 0.5rem;
				background-size: 1.5rem;
			}
			
			#login-form .div4 {
				color: #fff;
				background: #4087CB;
			}
			
			#login-form .text {
				height: 1.2rem;
				line-height: 1.2rem;
				margin-top: 0.6rem;
				width: 80%;
				border: 0px;
				float: right;
				background: transparent;
				border-left: 1px solid #333;
				text-indent: 0.4rem;
				color: #999;
				border-radius: 0px;
			}
			
			#reg {
				display: inline-block;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">注册</h1>
		</header>
		<div class="mui-content mui-scroll-wrapper tc">
			<div class="mui-scroll">
				<div id="login-form">
					<div class="div1 mt20">
						<input id='account' type="tel" class="text f13" placeholder="请输入您的手机号码" />
					</div>
					<div class="div2 mt20">
						<input id='code' type="number" class="text f13" placeholder="请输入验证码" />
					</div>

					<div class="div2 mt20">
						<input id='password' type="password" class="text f13" placeholder="请输入6-16位密码" />
					</div>
					<div class="div2 mt20">
						<input id='password_confirm' type="password" class="text f13" placeholder="请在输一次" />
					</div>
					<div class="div3 mt20">
						<input id='nickname' type="text" class="text f13" placeholder="请输入昵称，最多12字" />
					</div>
					<div class="div4 mt20" id='reg'>
						完成注册
					</div>
					<div class="c999 f13 mt10">
						<div id='notice'>*注册代表您同意<span class="fa-underline" style="color:#4087CB;">《Go服务协议》</span></div>
					</div>
				</div>
			</div>
		</div>
	</body>

</html>
<script type="text/javascript" src="../js/default.js"></script>
<script type="text/javascript" src="../js/mui.min.js"></script>
<script type="text/javascript" src="../js/base.js"></script>
<script type="text/javascript" src="../js/login.js"></script>
<script type="text/javascript">
	var Province = "";
	var City = "";
	(function($, doc) {
		$.init();

		$.ready(function() {
			base.InitScroll();
		})

		$.plusReady(function() {
			//系统定位
			plus.geolocation.getCurrentPosition(function(p) {
				console.log("注册:" + JSON.stringify(p));
				Province = p.address.province;
				City = p.address.city;
			}, function(e) {
				//mui.toast("未授权")
			});

			var settings = app.getSettings();
			var accountBox = doc.getElementById('account'); //账号
			var nickname = doc.getElementById('nickname'); //昵称
			var passwordBox = doc.getElementById('password'); //密码
			var passwordConfirmBox = doc.getElementById('password_confirm'); //确认密码

			//注册
			doc.getElementById('reg').addEventListener('tap', function(event) {
				var regInfo = {
					UserName: accountBox.value,
					NickName: nickname.value,
					Password: passwordBox.value,
					Province: Province,
					City: City
				};
				var passwordConfirm = passwordConfirmBox.value;
				if(passwordConfirm != regInfo.Password) {
					plus.nativeUI.toast('密码两次输入不一致');
					return;
				}
				app.reg(regInfo, function(err) {

					if(err) {
						plus.nativeUI.toast(err);
						return;
					}
					accountBox.value = "";
					nickname.value = "";
					passwordBox.value = "";
					passwordConfirmBox.value = "";
					plus.nativeUI.toast('注册成功');
					$.openWindow({
						url: 'login.html',
						id: 'login',
						show: {
							aniShow: 'pop-in'
						}
					});
				});
			});

			//用户协议
			var mainPage = mui.preload({
				"id": 'notice',
				"url": 'notice.html'
			});

			//跳转用户协议页
			var toNotice = function() {
				mui.fire(mainPage, 'show', null);
				setTimeout(function() {
					mui.openWindow({
						id: 'notice',
						show: {
							aniShow: 'pop-in'
						},
						waiting: {
							autoShow: false
						}
					});
				}, 0);
			};

			doc.getElementById('notice').addEventListener('tap', function(event) {
				toNotice();
			});
		});
	}(mui, document));
</script>