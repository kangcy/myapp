<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../mincss/loading.min.css">
	</head>

	<body>
		<div class="loading" id="loader">
			<div class="card">
				<span class="circles-loader"></span>
			</div>
		</div>
	</body>

</html>
<script src="../minjs/mui.min.js"></script>
<script src="../minjs/base.min.js"></script>
<script type="text/javascript">
	var groupItems = "";
	var headheight = "0px";
	var bottomheight = "0px";
	var menu = null;
	var self = null;
	var totalview = 0;

	if(window.plus) {
		plusReady();
	} else {
		document.addEventListener('plusready', plusReady, false);
	}

	function plusReady() {
		self = plus.webview.currentWebview();
		headheight = self.headheight || "0px";
		bottomheight = self.bottomheight || "0px";
		groupItems = self.groupItems || "";
		if(!base.IsNullOrEmpty(groupItems)) {
			groupItems = JSON.parse(groupItems);
		}
		preload(headheight);
	}

	function preload(headheight) {
		var menu_style = {
			top: headheight,
			bottom: bottomheight,
			left: "100%",
			width: "100%",
			popGesture: "none",
			render: "always",
			scrollIndicator: "none"
		};

		//创建页面
		mui.each(groupItems, function(i, view) {
			menu_style.left = i * 100 + "%";
			var currview = plus.webview.create(view.url, view.id, menu_style, {
				ArticleType: view.ArticleType,
				PageName: view.PageName,
				headheight: headheight
			});
			currview.onloaded = function() {
				totalview += 1;
			};
		});
		var i = setInterval(function() {
			if(totalview == groupItems.length) {
				clearInterval(i);
				base.GetView("subindex").evalJS('InitChangeItem()');
				InitDrag();
			}
		}, 100);
	}

	//绑定手指事件
	function InitDrag() {
		mui.each(groupItems, function(i, view) {
			if(i > 0) {
				menu = base.GetView(view.id);
				self = base.GetView(groupItems[i - 1].id);
				menu.drag({
					direction: 'right',
					moveMode: 'followFinger'
				}, {
					view: self,
					moveMode: 'follow'
				}, function(e) {
					if(e.type == "end" && e.result) {
						base.GetView("subindex").evalJS('scroll.gotoPage(' + (i - 1) + ');ChangeItem(mui(".mui-control-item")[' + (i - 1) + '])');
						//刷新页面数据
						base.GetView(groupItems[i - 1].id).evalJS('ResetCache()');
					}
				});
			}

			if(i < groupItems.length - 1) {
				self = base.GetView(view.id);
				menu = base.GetView(groupItems[i + 1].id);
				self.drag({
					direction: 'left',
					moveMode: 'followFinger'
				}, {
					view: menu,
					moveMode: 'follow'
				}, function(e) {
					if(e.type == "end" && e.result) {
						base.GetView("subindex").evalJS('scroll.gotoPage(' + (i + 1) + ');ChangeItem(mui(".mui-control-item")[' + (i + 1) + '])');
						//刷新页面数据
						base.GetView(groupItems[i + 1].id).evalJS('ResetCache()');
					}
				});
			}
		})
	}
</script>