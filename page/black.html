<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../mincss/mui.min.css">
		<link rel="stylesheet" href="../mincss/loading.min.css">
		<link rel="stylesheet" href="../mincss/fan.min.css">
		<link rel="stylesheet" href="../mincss/animate.min.css">
	</head>

	<body id="main">

	</body>

</html>
<script src="../js/mui.min.js"></script>
<script src="../js/base.js"></script>
<script type="text/javascript">
	var totalpage = 0;
	var records = 0;
	var isLoading = false;
	var userinfo = base.GetUserInfo();

	mui.init({
		gestureConfig: {
			doubletap: true
		}
	});

	mui.ready(function() {
		mui('#main').load("../part/list.html", function(response) {
			base.Immersed();
			
			base.Get("title").innerHTML = "黑名单";
			base.Get("none_tip").innerHTML = "加入黑名单的用户将无法浏览你的专栏";

			base.InitScroll();

			Load();
		});
	});

	mui.plusReady(function() {

		base.ShowUser("#scroll");

		//取消拉黑
		mui("#scroll").on('tap', '.mui-btn', function(event) {
			if(base.RepeatAction()) {
				return;
			}
			var li = this.parentNode.parentNode;
			mui.confirm('确认移除黑名单？', '', ['确认', '取消'], function(e) {
				if(e.index < 0) {
					return;
				}
				if(e.index == 0) {
					mui.swipeoutClose(li);
					HttpGet(base.RootUrl + "Api/Black/Delete", {
						ID: userinfo.ID,
						ToUserNumber: li.getAttribute("userid")
					}, function(data) {
						data = JSON.parse(data);
						base.CheckLogin(userinfo, data.code);
						if(data.result) {
							li.parentNode.removeChild(li);
							var list = document.querySelectorAll(".mui-table-view-cell");
							if(list.length == 0) {
								base.ShowNone(true);
							}
						} else {
							mui.toast(data.message);
						}
					});
				} else {
					mui.swipeoutClose(li);
				}
			});
		});
	});

	//我的拉黑
	function Load(callback) { 
		var data = {
			CreateUserNumber: userinfo.Number
		}
		LoadPull(base.RootUrl + "Api/Black/All", data, true, true,function(item) {
			return base.AppendUser(item, true, false, true, "移除黑名单");
		}, callback);
	}
</script>