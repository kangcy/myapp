<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>文章编辑预览</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../mincss/mui.min.css">
		<link rel="stylesheet" href="../mincss/animate.min.css">
		<link rel="stylesheet" href="../css/articledetail.min.css">
		<link rel="stylesheet" href="../swipe/swiper.min.css">
		<link rel="stylesheet" href="../css/demo.css">
		<style type="text/css">
			#snowcanvas {
				pointer-events: none;
				position: fixed;
				z-index: 20;
				width: 100%;
				height: 100%;
				left: 0;
				top: 0;
			}
			
			.swiper-cover {
				background: transparent;
				position: fixed;
				left: 0;
				bottom: 0;
				width: 100%;
				height: 100%;
				z-index: 999;
			}
			
			.swiper-container {
				position: fixed;
				left: 0;
				bottom: 0;
				z-index: 1000;
			}
			
			.swiper-slide {
				font-size: 18px;
				width: auto;
				height: auto;
				-webkit-box-sizing: border-box;
				box-sizing: border-box;
				padding: 0px 0;
				font-size: 13px;
				font-family: microsoft yahei;
			}
			
			div.background {
				width: 5rem;
				height: 7.25rem;
				margin-right: 0.5rem;
				margin-bottom: 0.2rem;
				float: left;
				display: inline-block;
				position: relative;
				background-size: 150%;
				background-position: center center;
				border-radius: 5px;
			}
			
			div.background.hover {
				border: 2px solid #007aff;
				color: #007aff;
				border-radius: 8px;
			}
			
			div.background:first-child {
				margin-left: 0.5rem;
			}
			
			div.background div {
				position: absolute;
				bottom: 0px;
				font-size: 11px;
				text-align: center;
				width: 100%;
				background: rgba(0, 0, 0, 0.5);
				color: #fff;
				height: 1.6rem;
				line-height: 1.6rem;
				border-radius: 0px 0px 5px 5px;
			}
			
			div.background img {
				width: 100% !important;
				height: 100% !important;
				border-radius: 6px;
			}
			
			#mycolor .color {
				width: 3rem;
				height: 3rem;
				margin: 0.8rem 0.4rem;
				display: inline-block;
				float: left;
			}
			
			#mycool .cool {
				width: 6rem;
				height: 3rem;
				line-height: 3rem;
				margin: 0.8rem 0.4rem;
				display: inline-block;
				float: left;
			}
			
			#mycolor .color.hover {
				background-image: url(../images/addarticle/icon_pic_y.png);
				background-size: 50% 50%;
				background-position: center center;
				background-repeat: no-repeat;
			}
			
			#mycolor .color:first-child,
			#mycool .cool:first-child {
				margin-left: 0.8rem;
			}
			
			#mycolor .color:last-child,
			#mycool .cool:last-child {
				margin-right: 0.4rem;
			}
			
			.icons {
				display: inline-block;
				width: 60%;
				text-align: center;
				position: fixed;
				bottom: 1rem;
				left: 20%;
				z-index: 99999;
			}
			
			.icons .items {
				width: 50%;
				display: inline;
				float: left;
				text-align: center;
			}
			
			.icons .items div {
				width: 4rem;
				height: 4rem;
				display: inline-block;
				border-radius: 100%;
				color: #fff;
				background-repeat: no-repeat;
				background-size: 55%;
				background-position: center center;
				margin-bottom: 0.5rem;
			}
			
			.icons div span {
				background: rgba(0, 0, 0, 0.3);
				padding: 0.3rem 1rem;
				border-radius: 30px;
				color: #fff;
			}
			
			.icons div.div1 {
				background-image: url(../images/preview/5.png);
			}
			
			.icons div.div2 {
				background-image: url(../images/preview/6.png);
			}
			
			.icons div.div3 {
				background-image: url(../images/preview/9.png);
			}
			/**新版**/
			
			#x-bg {
				position: fixed;
				height: 100%;
				width: 100%;
			}
			
			.root {
				height: 100%;
				position: relative;
				z-index: 0;
			}
			
			.root.x-cover {
				width: 100%;
				position: relative;
				z-index: 1;
				background-image: url(https://ss2.meipian.me/theme/v2/img/059/bg.jpg?1);
				background-size: 100% auto;
				background-repeat: no-repeat;
				min-height: 100%;
				background-color: #426a76;
			}
			
			.x-head {
				position: relative;
			}
			
			.x-head .img-container {
				padding-top: 2rem;
			}
			
			.x-head .img-container .avatar {
				width: 5rem;
				height: 5rem;
				margin: 0 auto;
				background-size: 100% 100%;
				overflow: hidden;
				border-radius: 50%;
				-webkit-box-sizing: border-box;
				box-sizing: border-box;
				border: 2px solid #fff;
			}
			
			.x-head .img-container .avatar img {
				width: 100%;
			}
			
			.root .article-meta {
				overflow: hidden;
				word-wrap: break-word;
			}
			
			.root .article-meta p.time-read {
				font-family: PingFangSC-Regular;
				margin-top: 10px;
				font-size: 14px;
				letter-spacing: 0;
				line-height: 20px;
			}
			
			.root .article-meta p.time-read>span {
				margin-right: 10px;
			}
			
			.root .article-meta p.nickname {
				font-family: PingFangSC-Medium;
				font-size: 15px;
				letter-spacing: 0;
				margin: 0;
				line-height: 20px;
			}
			
			.x-content {
				position: relative;
			}
			
			.x-content .section {
				display: inline-block;
				padding: 3%;
			}
			
			.x-content .section .text {
				line-height: 1.8 !important;
				word-wrap: break-word;
				font-weight: normal;
				white-space: pre-wrap;
				font-family: PingFangSC-Light;
			}
			
			.x-content .section img {
				width: 100%;
				vertical-align: bottom;
			}
			
			.x-content .x-bg-blur {
				/*background: rgba(27, 62, 85, 0.6);*/
				width: 94%;
				height: 100%;
				z-index: -1;
				top: 0;
				-webkit-backdrop-filter: blur(12px);
				position: absolute;
				border-radius: 8px;
			}
			
			.well {
				padding: 0 3%;
			}
			
			.well2 {
				padding: 0 6%;
			}
		</style>
	</head>
	<!--禁止复制-->

	<body id="body" oncontextmenu="return false" onselectstart="return false">
		<header class="mui-bar" id="header">
			<span class="mui-action-back mui-icon mui-icon-back fl cfff"></span>
			<span class="mui-icon fr mui-text cfff" id="submit" onclick="Save()">发布</span>
			<h1 class="mui-title cfff">文章预览</h1>
		</header>
		<p class="tc c666 f12" id="loader">正在加载中...</p>
		<img class="hide" src="../images/preview/icon_theme.png" onclick="IconTan(1)" id="btnTemp" style="bottom:1rem;">
		<!--主题色-->
		<img class="hide" src="../images/preview/btn_sure.png" onclick="ColorTan(0)" id="agreeColor">
		<div class="swiper-container hide" id="mycolor" style="bottom:0px;background:rgba(0, 0, 0, .5);height:auto;width:auto;">
			<div class="swiper-wrapper">
				<div class="swiper-slide tc" id="mycolor-slide">
				</div>
			</div>
			<div class="swiper-scrollbar" id="mycolor-scrollbar"></div>
		</div>
		<div class="swiper-cover hide" id="color-cover"></div>
		<!--炫标题-->
		<img class="hide" src="../images/preview/btn_sure.png" onclick="CoolTan(0)" id="agreeCool">
		<div class="swiper-container hide" id="mycool" style="bottom:0px;background:rgba(0, 0, 0, .5);height:auto;width:auto;">
			<div class="swiper-wrapper">
				<div class="swiper-slide tc" id="mycool-slide">
				</div>
			</div>
			<div class="swiper-scrollbar" id="mycool-scrollbar"></div>
		</div>
		<div class="swiper-cover hide" id="cool-cover"></div>
		<!--模板选择-->
		<img class="hide" src="../images/preview/btn_sure.png" onclick="ChooseTan()" id="agreeTemp" style="bottom:10rem;">
		<div class="swiper-container hide" id="temps" style="bottom:0px; padding:0.5rem 0;background:rgba(0, 0, 0, .5);">
			<div class="swiper-wrapper">
				<div class="swiper-slide" id="temp-slide"></div>
			</div>
			<div class="swiper-scrollbar" id="temp-scrollbar"></div>
		</div>
		<div class="swiper-cover hide" id="background-cover"></div>
		<!--漂浮特效-->
		<div id="snowwrapper"></div>
		<canvas id="snowcanvas"></canvas>
		<img id="music1" class="hide" src="../images/article/btn_music.png" onclick="switchsound()" />
		<div class="swiper-cover hide" id="icon-cover"></div>
		<div id="btnIcon" class="icons f13 hide">
			<!--<div class="items">
				<div class="div1" onclick="ColorTan(1)" style="background-color:#9BC402;"></div><span class="f12">主题色</span>
			</div>-->
			<!--<div><div onclick="CoolTan(1)">炫标题</div></div>-->
			<div class="items">
				<div class="div2" onclick="TempTan()" style="background-color:#457ED8;"></div>
				<p><span class="f12">背景</span></p>
			</div>
			<div class="items">
				<div class="div3" onclick="ShowShowy()" style="background-color:#D147EA;"></div>
				<p><span class="f12">漂浮</span></p>
			</div>
		</div>
		<!--固定背景-->
		<div id="x-bg" class="hide"></div>
		<!--内容-->
		<div id="wrapper" class="hide">
			<!--x-cover:滚动背景-->
			<div class="root" id="x-cover">
				<!--头部-->
				<div class="x-head mb15 hide" id="x-head">
					<div class="img-container" id="x-avatar">
						<div class="avatar" id="x-avatar-sub">
							<img id="useravatar0" src="../images/avatar.png">
						</div>
					</div>
					<div class="article-meta well2 mt10 tc" id="x-article">
						<h4 class="title" id="title0"></h4>
						<p class="time-read">
							<span id="createdate0"></span>
							<span class="read-count" id="views0"></span>
						</p>
						<p class="nickname hide" id="nickname0"></p>
						<p id="music0" play="on" class="music mt10 mb0 hide" onclick="switchsound()">
							<span id="musicname0" class="f11"></span>
						</p>
					</div>
				</div>
				<!--内容-->
				<div class="x-content well mb10">
					<div class="section" id="desc"></div>
					<!--半透明蒙层-->
					<div class="x-bg-blur" id="x-bg-blur"></div>
				</div>
			</div>
		</div>
	</body>

</html>
<script src="../minjs/mui.min.js"></script>
<script src="../minjs/base.min.js"></script>
<script src="../js/music.js"></script>
<script src="http://player.youku.com/jsapi"></script>
<script src="../js/video.js"></script>
<script src="../swipe/swiper.min.js"></script>
<script type="text/javascript">
	var Article = {};
	var ArticleID = 0; //文章ID
	var isLoading = false;
	var Title = "";
	var MusicID = ""; //音乐控件ID
	var MusicName = "";
	var MusicUrl = "";
	var ThemeColor = "";
	var Part = [];

	var CurrTemplate = 0; //当前选中模板
	var CurrTemplateSortID = 0; //当前选中模板
	var CurrBackground = null; //背景设置
	var CurrTemplateJson = null; // 当前模板设置
	var Showy = "";
	var userinfo = base.GetUserInfo();

	var $header = base.Get("header");
	var $wrapper = base.Get("wrapper"); //内容父背景（放图片背景色）
	var $wrapper1 = base.Get("x-cover"); //内容子背景（放背景图片）
	var $wrapper2 = base.Get("x-bg"); //纯色背景
	var $cover = base.Get("x-bg-blur"); //非纯色内容透明度底
	var scrolly = 0;
	var browserName = base.BrowserName();
	var num = 0;
	var colorSwiper, tempSwiper, coolSwiper = null;

	//显示遮罩
	var mask = base.CreateMask(true, function() {
		base.CloseWaiting();
	});

	//主题色
	var colors = ["#fff", "#000", "#242424", "#545454", "#848484", "#C93756", "#F05654", "#F35336", "#C32136", "#FF8936", "#FFA400", "#EE8FB7", "#ff84a2", "#fba4c2", "#e7a3cb", "#F0C239", "#C89B40", "#60281E", "#B25D25", "#AE7000", "#7C4B00", "#6E511E", "#955539", "#789262", "#0C8918", "#0EB83A", "#057748", "#9ED048", "#177CB0", "#44CEF6", "#0cd3fa", "#42b3d5", "#1880c5", "#8D4BBB", "#815476", "#952eb6", "#72528a", "#920783"]

	//炫标题
	var cools = [{
		id: 1,
		color: ["rgba(0, 0, 0, 0.6)", "#aff0ff", "rgba(0, 0, 0, 0.6)"]
	}, {
		id: 2,
		color: ["rgba(0, 0, 0, 0.5)", "#aff0ff", "rgba(0, 0, 0, 0.5)"]
	}, {
		id: 3,
		color: ["rgba(0, 0, 0, 0.4)", "#aff0ff", "rgba(0, 0, 0, 0.4)"]
	}, {
		id: 4,
		color: ["rgba(0, 0, 0, 0.3)", "#aff0ff", "rgba(0, 0, 0, 0.3)"]
	}, {
		id: 5,
		color: ["rgba(0, 0, 0, 0.2)", "#aff0ff", "rgba(0, 0, 0, 0.2)"]
	}, {
		id: 6,
		color: ["rgba(0, 0, 0, 0.1)", "#aff0ff", "rgba(0, 0, 0, 0.1)"]
	}, {
		id: 7,
		color: ["rgba(0, 0, 0, 0.6)", "#aff0ff", "rgba(0, 0, 0, 0.6)"]
	}, {
		id: 8,
		color: ["#A9A9A9", "#aff0ff", "#A9A9A9"]
	}, {
		id: 9,
		color: ["#00FF7F", "#aff0ff", "#00FF7F"]
	}, {
		id: 10,
		color: ["#FF00FF", "#aff0ff", "#FF00FF"]
	}]

	//启用双击监听 
	mui.init({
		gestureConfig: {
			doubletap: true
		}
	});

	mui.ready(function() {
		base.Immersed();
		base.ToTop();

		base.Get("loader").style.paddingTop = window.innerHeight * 0.3 + "px";
		$wrapper.style.paddingTop = base.Get("header").clientHeight + "px";
		$wrapper2.style.top = base.Get("header").clientHeight + "px";

		//CoolTan(1)

		//打开外链
		mui('#wrapper').on('tap', 'a.link', function() {
			var link = this.getAttribute("link");
			if(base.IsNullOrEmpty(link)) {
				return;
			}
			base.OpenWindow("showhref", "showhref.html", {
				Link: link
			});
		});

		//选中主题色
		/*mui('#mycolor-slide').on('tap', 'div', function() {
			ThemeColor = this.getAttribute("name");
			base.Get("title0").style.color = ThemeColor;
			base.Get("title1").style.color = ThemeColor;
			base.Get("nickname0").style.color = ThemeColor;
			base.Get("nickname1").style.color = ThemeColor;
			base.Get("createdate0").style.color = ThemeColor;
			base.Get("createdate1").style.color = ThemeColor;
			base.Get("views0").style.color = ThemeColor;
			base.Get("views1").style.color = ThemeColor;

			base.RemoveClass([".color"], "hover");
			this.classList.add("hover");
		});*/

		//选中炫标题
		mui('#mycool-slide').on('tap', 'div', function() {
			/*ThemeColor = this.getAttribute("name");
			base.Get("title0").style.color = ThemeColor;
			base.Get("title1").style.color = ThemeColor;*/

			base.RemoveClass([".cool"], "hover");
			this.classList.add("hover");
		});

		base.Get("icon-cover").addEventListener("tap", function() {
			IconTan(0);
			base.Get("btnTemp").classList.remove("hide");
		})
	});

	var self = null;

	mui.plusReady(function() {
		self = plus.webview.currentWebview();
		ArticleID = self.ArticleID || 0;
		Title = self.Title || "";
		MusicID = self.MusicID || "";
		MusicName = self.MusicName || "";
		MusicUrl = self.MusicUrl || "";
		CurrTemplate = self.ThemeTemplate || 0;
		Showy = self.Showy || "";

		Part = self.Part || [];

		Load(function(data) {

		});

		//加载模板
		LoadTemplate();

		mui.back = function() {
			//关闭弹层
			if(base.HasClass(base.Get("btnTemp"), "hide")) {
				TempTan(0);
				ColorTan(0);
				IconTan(0);
				base.Get("btnTemp").classList.remove("hide");
				return;
			}
			self.close();
		}
	});

	//加载文章
	function Load(callback) {
		HttpGet(base.RootUrl + "Api/Article/Detail", {
			Number: userinfo.Number,
			ArticleID: ArticleID,
			Template: CurrTemplate
		}, function(data) {
			data = JSON.parse(data);
			if(data != null) {
				if(data.result) {
					data = data.message;

					Article = data;
					Article.NickName = base.UnUnicodeText(data.NickName);

					if(audio != null) {
						var item = document.getElementById("bgsound")
						item.parentNode.removeChild(item);
						audio = null;
					}

					//段落 
					var html = [];

					//过滤删除项
					var parts = Part.filter(x => {
						return x.Status != 3
					});

					parts.sort(function(a, b) {
						return a.SortID - b.SortID;
					});

					parts.forEach(part => {
						if(part.PartType == 1) {
							//图片
							html.push('<div class="full f13 fl mt10 ' + part.IntroExpand + '"><img src="' + base.ShowThumb(part.Introduction, 1) + '" class="full fl" /></div>');
						} else if(part.PartType == 2) {
							//文本
							html.push('<div class="full f13 fl mt10">' + base.UnUnicodeText(part.Introduction) + '</div>');
						} else if(part.PartType == 3) {
							//视频
							html.push('<div class="full f13 fl mt10 hide" style="display:inline-block;">' + AppendVideo(part.Introduction) + '</div>');
							//html.push('<div class="full f13 mt10" style="display:inline-block;position:relative;">' + AppendVideo(part.Introduction) + '<img src="../images/article/bg.png" style="width:3.5rem;position:absolute;top:40%;left:40%;" /></div>');
						} else if(part.PartType == 4) {
							//分隔
							html.push('<div class="full f13 fl mt10" style="display:inline-block;">' + part.Introduction + '</div>');
						}
					})
					if(data.TemplateJson != null) {
						if(data.TemplateJson.ID != 1) {
							CurrTemplateJson = data.TemplateJson;

							base.Get("title0").style.color = CurrTemplateJson.TitleColor;
							base.Get("nickname0").style.color = CurrTemplateJson.UserColor;
							base.Get("createdate0").style.color = CurrTemplateJson.TimeColor;
							base.Get("views0").style.color = CurrTemplateJson.ViewColor;
							base.Get("x-avatar-sub").style.border = "2px solid " + CurrTemplateJson.TitleColor;
						}
					}
					CurrBackground = data.BackgroundJson;

					ChangeBg();

					base.Get("musicname0").innerHTML = data.MusicName;

					base.Get("useravatar0").setAttribute("src", base.ShowThumb(data.Avatar, 1));

					base.InnerHtml(["title", "title0"], Article.Title);

					base.InnerHtml(["nickname", "nickname0"], Article.NickName);

					base.InnerHtml(["createdate0"], data.CreateDateText);

					base.InnerHtml(["views0"], "阅读  " + data.Views);

					base.Get("x-head").classList.remove("hide");

					base.Get("desc").innerHTML = base.UnUnicodeText(html.join(""));

					if(base.IsNullOrEmpty(Showy)) {
						Showy = data.Showy;
					}
					InitShowy(Showy);

					//实例化播放器
					mui.each(mui(".youku_player"), function() {
						var $this = this;
						ShowVideo($this.getAttribute("id"), $this.getAttribute("sid"));
					})

					mui.each(mui(".video"), function() {
						var $this = this;
						//可以播放
						$this.addEventListener('canplay', function() {
							$this.parentNode.classList.remove("hide");
							//document.addEventListener('touchstart', Video($this));

							/*var img = $($this).next("img")[0];
							img.addEventListener('tap', function() { 
								mui.toast("ok");
								if($this.paused) {
									item.classList.add("hide");
									$this.play();
								} else {
									$this.pause();
								}
							});*/
						});
						//播放结束
						/*$this.addEventListener('ended', function() {
							var img = $($this).next("img")[0];
							item.classList.remove("hide");
						});*/
					});

					//音乐 
					ChangeMusic();

					$wrapper.classList.remove("hide");
				} else {
					mui.toast(data.message);
					plus.webview.currentWebview().hide();
					plus.webview.currentWebview().close();
				}
			}
			if(callback) {
				callback(data);
			}
			base.ShowLoading(false);
			mask.close();
		});
	}

	function Video(video) {
		document.removeEventListener('touchstart', Video(video));
		if(!video) {
			return;
		}
		if(video.paused) {
			video.play();
		} else {
			video.pause();
		}
	}

	//自定义装扮
	function ShowShowy() {
		if(isLoading) {
			return;
		}
		isLoading = true;
		IconTan(0);
		base.OpenWindow("showy", "showy.html", {
			ArticleNumber: Article.Number
		});
		base.Get("btnTemp").classList.remove("hide");
		isLoading = false;
	}

	//初始化装扮 
	function InitShowy(src) {
		if(base.IsNullOrEmpty(src)) {
			return
		}
		LoadScript("../js/snow.js", function() {
			base.GetView("addarticle").evalJS("changeShowy('" + Showy + "')");
			var srcs = src.split("|");
			if(srcs.length > 2) {
				snow.init(srcs[0], srcs[1], srcs[2])
			} else {
				snow.init(src, 1, 0)
			}
		});
	}

	//更新自定义装扮
	function UpdateShowy(src) {
		var page = base.GetView("showypreview");
		if(page) {
			plus.webview.close("showy", "none");
			plus.webview.close("showypreview");
		} else {
			plus.webview.close("showypreview", "none");
			plus.webview.close("showy");
		}

		if(base.IsNullOrEmpty(Showy)) {
			InitShowy(src)
		} else {
			snow.clear();
			if(!base.IsNullOrEmpty(src)) {
				var srcs = src.split("|");
				if(srcs.length >= 2) {
					snow.init(srcs[0], srcs[1], srcs[2])
				} else {
					snow.init(src, 1, 0)
				}
			}
		}
		Showy = src;
		base.GetView("addarticle").evalJS("changeShowy('" + Showy + "')");
	}

	//切换音乐
	function ChangeMusic() {
		base.AddClass(["#music0", "#music1"], "hide");
		MusicID = "music" + (CurrTemplate == 0 ? 0 : 1);
		if(!base.IsNullOrEmpty(MusicUrl)) {
			if(Article.AutoMusic == 1) {
				document.addEventListener('touchstart', startsound);
			}
			base.Get("music" + (CurrTemplate == 0 ? 0 : 1)).classList.remove("hide");
		}
	}

	//主题色选择弹窗
	function ColorTan(index) {
		IconTan(0);
		if(index == 0) {
			CloseColor();
			base.AddClass(["#agreeColor", "#mycolor"], "hide");
			//base.GetView("addarticle").evalJS("changeColor('" + ThemeColor + "')");
			base.Get("btnTemp").classList.remove("hide");
		} else {
			base.Get("color-cover").classList.remove("hide");
			var mycolor = base.Get("mycolor");
			mycolor.classList.remove("hide");
			if(colorSwiper == null) {
				var fragment = document.createDocumentFragment();
				colors.forEach(x => {
					var div = document.createElement('div');
					div.className = "color";
					div.style.backgroundColor = x;
					div.setAttribute("name", x);
					div.innerHTML = "<div></div>";
					fragment.appendChild(div);
				})
				base.Get("mycolor-slide").innerHTML = "";
				base.Get("mycolor-slide").appendChild(fragment);
				colorSwiper = new Swiper('#mycolor', {
					scrollbar: '#mycolor-scrollbar',
					direction: 'horizontal',
					slidesPerView: 'auto',
					mousewheelControl: true,
					freeMode: true,
					roundLengths: true,
					spaceBetween: 10,
					onInit: function(swiper) {
						mycolor.classList.remove("bounceOutUp");
						mycolor.classList.add("bounceInUp");
					}
				});
			} else {
				mycolor.classList.remove("bounceOutUp");
				mycolor.classList.add("bounceInUp");
			}
			base.RemoveClass([".color"], "hover");

			mui.each(mui("#mycolor .color"), function(index, item) {
				if(item.getAttribute("name") == ThemeColor) {
					item.classList.add("hover");
				}
			});
			base.RemoveClass(["#agreeColor"], "hide");
		}
	}

	function CloseColor() {
		var mycolor = base.Get("mycolor");
		mycolor.classList.remove("bounceInUp");
		mycolor.classList.add("bounceOutUp");
		base.Get("color-cover").classList.add("hide");
	}

	//炫标题选择弹窗
	function CoolTan(index) {
		IconTan(0);
		if(index == 0) {
			CloseCool();
			base.AddClass(["#agreeCool", "#mycool"], "hide");
			base.GetView("addarticle").evalJS("changeColor('" + ThemeColor + "')");
			base.Get("btnTemp").classList.remove("hide");
		} else {
			base.Get("cool-cover").classList.remove("hide");
			var mycool = base.Get("mycool");
			mycool.classList.remove("hide");
			if(coolSwiper == null) {
				var fragment = document.createDocumentFragment();
				cools.forEach(x => {
					var div = document.createElement('div');
					div.className = "cool";
					//div.style.backgroundColor = x;

					div.setAttribute("name", x.id);

					var child = document.createElement('div');
					child.className = "inline wave";

					ThemeColor = "#ff6900"
					child.style.backgroundColor = base.IsNullOrEmpty(ThemeColor) ? "#333" : ThemeColor;
					/*if(x.color.length == 2) {
						child.style.backgroundImage = browserName + 'linear-gradient(-45deg,' + x.color[0] + ' 30%,' + x.color[1] + ' 70%)';
					} else if(x.color.length == 3) {
						child.style.backgroundImage = browserName + 'linear-gradient(-45deg,' + x.color[0] + ' 30%,' + x.color[1] + ' 50%,' + x.color[2] + ' 70%)';
					}*/

					child.innerHTML = "我的小微篇";
					div.appendChild(child);
					//div.innerHTML = "<div></div>";
					fragment.appendChild(div);
				})
				base.Get("mycool-slide").innerHTML = "";
				base.Get("mycool-slide").appendChild(fragment);
				coolSwiper = new Swiper('#mycool', {
					scrollbar: '#mycool-scrollbar',
					direction: 'horizontal',
					slidesPerView: 'auto',
					mousewheelControl: true,
					freeMode: true,
					roundLengths: true,
					spaceBetween: 10,
					onInit: function(swiper) {
						mycool.classList.remove("bounceOutUp");
						mycool.classList.add("bounceInUp");
					}
				});
			} else {
				mycool.classList.remove("bounceOutUp");
				mycool.classList.add("bounceInUp");
			}
			base.RemoveClass([".cool"], "hover");
			mui.each(mui("#mycool .cool"), function(index, item) {
				if(item.getAttribute("name") == ThemeColor) {
					item.classList.add("hover");
				}
			});
			base.RemoveClass(["#agreeCool"], "hide");
		}
	}

	function CloseCool() {
		var mycolor = base.Get("mycool");
		mycolor.classList.remove("bounceInUp");
		mycolor.classList.add("bounceOutUp");
		base.Get("cool-cover").classList.add("hide");
	}

	//模板选择弹窗
	function TempTan(index) {
		IconTan(0);
		if(index == 0) {
			base.AddClass(["#agreeTemp", "#temps", "#background-cover"], "hide");
		} else {
			base.Get("background-cover").classList.remove("hide");
			var temps = base.Get("temps");
			temps.classList.remove("hide");
			if(tempSwiper == null) {
				tempSwiper = new Swiper('#temps', {
					scrollbar: '#temp-scrollbar',
					direction: 'horizontal',
					slidesPerView: 'auto',
					mousewheelControl: true,
					freeMode: true,
					roundLengths: true,
					spaceBetween: 10,
					onInit: function(swiper) {
						temps.classList.remove("bounceOutUp");
						temps.classList.add("bounceInUp");
					}
				});
			} else {
				temps.classList.remove("bounceOutUp");
				temps.classList.add("bounceInUp");
			}
			base.RemoveClass([".background"], "hover");
			mui(".background")[CurrTemplateSortID + 1].classList.add("hover");
			base.RemoveClass(["#agreeTemp"], "hide");
		}
	}

	//确认模板
	function ChooseTan(callback) {
		if(isLoading) {
			return;
		}
		isLoading = true;
		TempTan(0);
		base.RemoveClass([".background"], "hover");
		mui(".background")[CurrTemplateSortID + 1].classList.add("hover");
		base.GetView("addarticle").evalJS("changeTemp(" + CurrTemplate + ")");
		base.Get("btnTemp").classList.remove("hide");
		if(callback) {
			callback();
		}
		isLoading = false;
	}

	//背景状态切换
	function ChangeBg() {
		console.log(CurrTemplate);
		if(CurrTemplate == 0) {
			base.Get("x-avatar").classList.add("hide");
			base.Get("x-article").classList.remove("tc");
			base.Get("x-article").classList.add("tl");
		} else {
			base.Get("x-avatar").classList.remove("hide");
			base.Get("x-article").classList.remove("tl");
			base.Get("x-article").classList.add("tc");
		}

		$wrapper.style.backgroundColor = "";
		$wrapper1.style.background = "";
		$cover.style.backgroundColor = "";
		$wrapper2.style.background = "";

		if(CurrTemplate > 1) {
			//模板 
			base.Get("x-avatar").style.paddingTop = CurrTemplateJson.MarginTop + "rem";
			$cover.style.backgroundColor = CurrTemplateJson.Transparency;
			if(CurrTemplateJson.CoverFixed == 0) {
				if(!base.IsNullOrEmpty(CurrTemplateJson.BackgroundImage)) {
					$wrapper1.style.backgroundImage = "url(" + CurrTemplateJson.BackgroundImage + ")";
					if(!base.IsNullOrEmpty(CurrTemplateJson.BackgroundRepeat)) {
						$wrapper1.style.backgroundRepeat = CurrTemplateJson.BackgroundRepeat;
					}

					if(!base.IsNullOrEmpty(CurrTemplateJson.BackgroundSize)) {
						$wrapper1.style.backgroundSize = CurrTemplateJson.BackgroundSize;
					}
				}
				if(!base.IsNullOrEmpty(CurrTemplateJson.Background)) {
					$wrapper.style.background = CurrTemplateJson.Background;
					if(!CurrTemplateJson.Background.startWith("#") && !CurrTemplateJson.Background.startWith("rgba")) {
						$wrapper.style.background = base.BrowserName() + CurrTemplateJson.Background;
					}
				}
			} else {
				if(!base.IsNullOrEmpty(CurrTemplateJson.BackgroundImage)) {
					$wrapper2.style.backgroundImage = "url(" + CurrTemplateJson.BackgroundImage + ")";
					if(!base.IsNullOrEmpty(CurrTemplateJson.BackgroundRepeat)) {
						$wrapper2.style.backgroundRepeat = CurrTemplateJson.BackgroundRepeat;
					}
					if(!base.IsNullOrEmpty(CurrTemplateJson.BackgroundSize)) {
						$wrapper2.style.backgroundSize = CurrTemplateJson.BackgroundSize;
					}
				}
				if(!base.IsNullOrEmpty(CurrTemplateJson.Background)) {
					if(CurrTemplateJson.Background.startWith("#") || CurrTemplateJson.Background.startWith("rgba")) {
						$wrapper2.style.backgroundColor = CurrTemplateJson.Background;
					} else {
						$wrapper2.style.background = CurrTemplateJson.Background;
						$wrapper2.style.background = base.BrowserName() + CurrTemplateJson.Background;
					}
				}
				$wrapper2.classList.remove("hide");
			}
		} else if(CurrTemplate == 1) {
			console.log(JSON.stringify(CurrBackground));
			//自定义
			$wrapper.style.backgroundColor = "";
			$wrapper1.style.background = "";
			if(CurrBackground == null) {
				//全屏
				$wrapper2.style.background = "";
				$wrapper2.className = "";
			} else {
				//背景透明度
				$cover.style.backgroundColor = "RGBA(255, 255, 255, " + (100 - CurrBackground.Transparency) / 100 + ")";
				var url = CurrBackground.Url;
				if(CurrBackground.High == 0) {
					url = base.ShowThumb(url, 1);
				} else {
					url = base.ShowThumb(url, 0);
				}
				$wrapper2.className = "";
				switch(CurrBackground.Full) {
					case 0:
						//居顶 
						$wrapper2.style.background = "url(" + url + ") no-repeat top center";
						$wrapper2.style.backgroundSize = "100% 15.5rem";
						break;
					case 1: 
						//全屏
						$wrapper2.style.background = "url(" + url + ") center center no-repeat";
						$wrapper2.style.backgroundSize = "100% auto";
						break;
					default:
						break;
				}
			}
		}
	}

	//加载模板
	function LoadTemplate() {
		HttpGet(base.RootUrl + "Article/Template", {}, function(data) {
			if(data != null) {
				var length = data.records;
				if(length > 0) {
					var fragment = document.createDocumentFragment();
					var div = document.createElement('div');
					div.className = "background";
					div.setAttribute("name", "back");
					div.innerHTML = '<img src="../images/preview/btn_cancel1.png" />';
					fragment.appendChild(div);

					data.list.forEach(x => {
						var div = document.createElement('div');
						div.className = "background";
						div.setAttribute("name", x.Cover);
						div.setAttribute("tid", x.ID);
						div.setAttribute("sortid", x.SortID);
						div.setAttribute("model", JSON.stringify(x));
						if(x.ID > 1) {
							div.innerHTML = '<img src="' + x.ThumbImage + '" /><div class="f15">' + x.Name + '</div>';
						} else {
							div.innerHTML = '<img src="' + x.ThumbImage + '" />';
						}
						fragment.appendChild(div);
					})
					base.Get("temp-slide").innerHTML = "";
					base.Get("temp-slide").appendChild(fragment);
				}
			}

			//模板选择
			mui('#temps').on('tap', '.background', function() {
				var name = this.getAttribute("name");
				if(name == "back") {
					TempTan(0);
					base.Get("btnTemp").classList.remove("hide");
					return;
				}

				base.RemoveClass([".background"], "hover");
				this.classList.add("hover");

				if(parseInt(this.getAttribute("tid")) == 1) {
					base.OpenWindow("customsetting", "customsetting.html", {
						ArticleNumber: Article.Number
					});
					TempTan(0);
					base.Get("btnTemp").classList.remove("hide");
					return;
				}

				CurrTemplate = parseInt(this.getAttribute("tid"));
				CurrTemplateSortID = parseInt(this.getAttribute("sortid"));
				CurrTemplateJson = JSON.parse(this.getAttribute("model"));

				base.Get("title0").style.color = CurrTemplateJson.TitleColor;
				base.Get("nickname0").style.color = CurrTemplateJson.UserColor;
				base.Get("createdate0").style.color = CurrTemplateJson.TimeColor;
				base.Get("views0").style.color = CurrTemplateJson.ViewColor;
				base.Get("x-avatar-sub").style.border = "2px solid " + CurrTemplateJson.TitleColor;

				ChangeBg(); //背景切换 

				ChangeMusic(); //音乐切换
			});

			base.RemoveClass(["#btnTemp"], "hide");
		});
	}

	//重新加载数据 
	function Reload(source, model) {
		console.log(model);
		CurrTemplate = 1;
		CurrBackground = JSON.parse(model);
		if(source == "custom") {
			plus.webview.close("customsetting", "none");
			plus.webview.close("custom");
		} else {
			plus.webview.close("custom", "none");
			plus.webview.close("customsetting");
		}
		console.log("bbbbb");
		ChooseTan(function() {

			console.log('aaaa');

			ChangeBg();
			/*Load(function() {
				if(source == "custom") {
					plus.webview.close("customsetting", "none");
					plus.webview.close("custom");
				} else {
					plus.webview.close("custom", "none");
					plus.webview.close("customsetting");
				}
			});*/
		});
	}

	function IconTan(index) {
		var btnIcon = base.Get("btnIcon");
		if(index == 0) {
			base.Get("icon-cover").classList.add("hide");
			btnIcon.classList.remove("bounceInUp");
			btnIcon.classList.add("bounceOutUp");
		} else {
			base.Get("icon-cover").classList.remove("hide");
			base.Get("btnTemp").classList.add("hide");
			btnIcon.classList.remove("hide");
			btnIcon.classList.remove("bounceOutUp");
			btnIcon.classList.add("bounceInUp");
		}
	}

	function Save() {
		base.GetView("addarticle").evalJS("Save()");
	}
</script>