<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/articleType.css">
	</head>

	<body>
		<header class="mui-bar mui-bar-nav header">
			<a id="back" class="mui-icon mui-icon-arrowleft mui-pull-left cfff"></a>
			<a id="submit" class="mui-icon cfff f13 fr mt6">完成</a>
			<h1 class="mui-title cfff f15">文章类别</h1>
		</header>
		<div class="mui-iframe-wrapper" style="top: 2.75rem;bottom:0px;">
			<div class="mui-content mui-scroll-wrapper">
				<div class="mui-scroll">
					<div id="scroll-view">
					</div>
				</div>
			</div>
		</div>
	</body>

</html>
<script src="../js/default.js"></script>
<script src="../js/jquery-1.10.2.min.js"></script>
<script src="../js/mui.min.js"></script>
<script src="../js/base.js"></script>
<script type="text/javascript">
	var ArticleID = 0; //文章ID
	var ArticleType = 0; //文章类型ID
	var ArticleTypeName = 0; //文章类型名称
	var userinfo = base.GetUserInfo();
	var shareSettingPage = null;
	mui.init({
		gestureConfig: {
			doubletap: true
		},
		swipeBack: false //启用右滑关闭功能
	});

	$(function() {
		mui('.mui-scroll-wrapper').scroll({
			indicators: false //不显示滚动条
		});

		//选中切换
		$("#scroll-view").on('tap', 'div.mui-table-view-cell', function(event) {
			$(".check").removeClass("check");
			$(this).find(".oa-contact-icon").addClass("check");
			ArticleType = $(this).find(".oa-contact-icon").attr("type");
			ArticleTypeName = $(this).find(".oa-contact-icon").attr("name");
		});

		//完成
		document.getElementById("submit").addEventListener('tap', function(event) {
			if(mui.os.plus) {
				plus.nativeUI.showWaiting();
			}
			HttpGet(base.RootUrl + "Article/EditArticleType", {
					UserName: userinfo.account,
					Password: userinfo.password,
					ArticleID: ArticleID,
					ArticleType: ArticleType
				},
				function(data) {
					if(mui.os.plus) {
						plus.nativeUI.closeWaiting();
					}
					mui.toast(data.result ? "编辑成功~" : data.message);
					if(mui.os.plus) {
						if(!shareSettingPage) {
							shareSettingPage = plus.webview.getWebviewById('sharesetting');
						}
						mui.fire(shareSettingPage, "updateArticleType", {
							"ArticleType": ArticleType,
							"ArticleTypeName": ArticleTypeName
						});
						mui.back();
					}
				});
		}, false);
	});

	mui.plusReady(function() {
		
		var self = plus.webview.currentWebview();
		ArticleID = self.ArticleID;
		ArticleType = self.ArticleType;
		ArticleTypeName = self.ArticleTypeName;

		Load();

		//返回
		document.getElementById("back").addEventListener('tap', function(event) {
			mui.back();
		});
	});

	//加载数据
	function Load(callback) {
		if(mui.os.plus && base.IsTest) {
			var table = document.getElementById('scroll-view');
			for(var i = 1; i < 6; i++) {
				var item = {
					ID: i,
					Cover: "http://www.dcloud.io/hellomui/images/" + i + ".jpg",
					Name: "动漫" + i,
					Summary: "动漫动漫动漫动漫动漫动漫动漫动漫动漫动漫动漫动漫动漫  "
				}
				table.appendChild(appendStr(item));
			}
		} else {
			HttpGet(base.RootUrl + "ArticleType/All", {}, function(data) {
				if(data != null) {
					var length = data.list.length;
					if(length > 0) {
						var table = document.getElementById('scroll-view');
						for(var i = 0, len = data.list.length; i < len; i++) {
							var div = appendStr(data.list[i]);
							table.appendChild(div);
						}
					}
				}
				if($.isFunction(callback)) {
					callback();
				}
			});
		}
	}

	//拼接Html
	function appendStr(item) {
		var div = document.createElement('div');
		div.className = 'mui-table-view-cell';
		var model = [];
		model.push('<div class="mui-slider-cell">');
		//分类图片
		model.push('<div class="oa-contact-cell mui-table"><div class="oa-contact-avatar mui-table-cell"><img src="' + item.Cover + '" /></div>');
		//分类信息
		model.push('<div  class="oa-contact-avatar mui-table-cell"><div class="mui-clearfix"><p class="f16 mb5 c000">' + item.Name + '</p></div><p class="f11 csubtitle">' + item.Summary + '</p></div>');
		//关注
		model.push('<div class="oa-contact-icon mui-table-cell ' + (item.ID == ArticleType ? "check" : "") + '" type="' + item.ID + '" name="' + item.Name + '"></div>');
		model.push('</div>');
		div.innerHTML = model.join('');
		return div;
	}
</script>