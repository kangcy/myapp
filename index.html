<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
	</head>

	<body>

	</body>

</html>
<script src="js/mui.min.js"></script>
<script type="text/javascript" charset="utf-8">
	var menu = null,
		main = null;
	var showMenu = false;
	mui.init({
		swipeBack: false, //启用右滑关闭功能

		//子页面
		subpages: [{
			id: 'subindex',
			url: 'subindex2.html',
			styles: {
				top: '0px',
				bottom: '0px',
				bounce: 'vertical'
			}
		}],
	});

	mui.plusReady(function() {
		//仅支持竖屏显示
		plus.screen.lockOrientation("portrait-primary");
		main = plus.webview.currentWebview();
		main.addEventListener('maskClick', closeMenu);
		//处理侧滑导航，为了避免和子页面初始化等竞争资源，延迟加载侧滑页面；
		setTimeout(function() {
			menu = mui.preload({
				id: 'menu',
				url: 'menu.html',
				styles: {
					left: 0,
					width: '70%',
					zindex: 1000
				},
				show: {
					aniShow: 'none'
				}
			});
		}, 200);
	});

	var isInTransition = false;
	/**
	 * 显示侧滑菜单
	 */
	function openMenu() {
		if(isInTransition) {
			return;
		}
		if(!showMenu) {
			//侧滑菜单处于隐藏状态，则立即显示出来；
			isInTransition = true;
			menu.setStyle({
				mask: 'rgba(0,0,0,0)'
			}); //menu设置透明遮罩防止点击
			menu.show('none', 0, function() {
				//主窗体开始侧滑并显示遮罩
				main.setStyle({
					mask: 'rgba(0,0,0,0.4)',
					left: '70%',
					transition: {
						duration: 150
					}
				});
				mui.later(function() {
					isInTransition = false;
					menu.setStyle({
						mask: "none"
					}); //移除menu的mask
				}, 160);
				showMenu = true;
			});
		}
	};
	/**
	 * 关闭菜单
	 */
	function closeMenu() {
		if(isInTransition) {
			return;
		}
		if(showMenu) {
			//关闭遮罩；
			//主窗体开始侧滑；
			isInTransition = true;
			main.setStyle({
				mask: 'none',
				left: '0',
				transition: {
					duration: 200
				}
			});
			showMenu = false;
			//等动画结束后，隐藏菜单webview，节省资源；
			mui.later(function() {
				isInTransition = false;
				menu.hide();
			}, 300);
		}
	};

	//切换左侧菜单显示
	window.addEventListener("toggleMenu", function(e) {
		if(showMenu) {
			closeMenu();
		} else {
			openMenu();
		}
	});

	//主界面向右滑动，若菜单未显示，则显示菜单；否则不做任何操作
	window.addEventListener("swiperight", openMenu);

	//主界面向左滑动，若菜单已显示，则关闭菜单；否则，不做任何操作；
	window.addEventListener("swipeleft", closeMenu);

	//侧滑菜单触发关闭菜单命令
	window.addEventListener("menu:close", closeMenu);
	window.addEventListener("menu:open", openMenu);

	//重写mui.menu方法，Android版本menu按键按下可自动打开、关闭侧滑菜单；
	mui.menu = function() {
		if(showMenu) {
			closeMenu();
		} else {
			openMenu();
		}
	}

	//首页返回键处理
	//1、若侧滑菜单显示，则关闭侧滑菜单
	//2、否则，执行mui框架默认的关闭首页功能
	var backButtonPress = 0;
	mui.back = function() {
		if(showMenu) {
			closeMenu();
		} else {
			backButtonPress++;
			if(backButtonPress > 1) {
				plus.runtime.quit();
			} else {
				plus.nativeUI.toast('再按一次退出应用');
			}
			setTimeout(function() {
				backButtonPress = 0;
			}, 1000);
			return false;
		}
	};

	/*mui.back = function() {
	var btn = ["确定", "取消"];
	mui.confirm('确认关闭当前窗口？', 'Hello MUI', btn, function(e) {
		if(e.index == 0) {
			//执行mui封装好的窗口关闭逻辑；
			_back();
		}
	});
}*/
</script>