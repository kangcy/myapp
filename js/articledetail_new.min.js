function ChangeMusic(){base.AddClass(["#music0","#music1"],"hide"),MusicID="music"+(0==CurrTemplate?0:1),base.IsNullOrEmpty(MusicUrl)||(1==Article.AutoMusic&&document.addEventListener("touchstart",startsound),base.Get("music"+(0==CurrTemplate?0:1)).classList.remove("hide"))}function Video(e){document.removeEventListener("touchstart",Video(e)),e&&(e.paused?e.play():e.pause())}function ChangeThemeColor(e){null!=e&&(base.Get("title0").style.color=e.TitleColor,base.Get("nickname0").style.color=e.UserColor,base.Get("nickname1").style.color=e.UserColor,base.Get("createdate0").style.color=e.TimeColor,base.Get("views0").style.color=e.ViewColor,$avatar.style.border="2px solid "+e.TitleColor)}function InitReady(){InitCoverScroll(),mui("#wrapper").on("tap","a.link",function(){var e=this.getAttribute("link");base.IsNullOrEmpty(e)||base.OpenWindow("showhref","showhref.html",{Link:e})})}function InitCoverScroll(){window.addEventListener("scroll",function(e){if(CurrTemplateJson&&2==CurrTemplateJson.CoverFixed){var r=document.documentElement.scrollTop||document.body.scrollTop;r>=150?($wrapper2.style.opacity=0,$wrapper21.style.opacity=1):($wrapper2.style.opacity=1-r/150,$wrapper21.style.opacity=r/150)}})}function ChangeBg(){switch(0==CurrTemplate?(base.Get("title0").classList.remove("well2"),base.Get("x-avatar").classList.add("hide"),base.Get("x-article").classList.remove("tc"),base.Get("x-article").classList.add("tl"),base.Get("nickname1").classList.add("hide"),base.Get("nickname0").classList.remove("hide"),base.Get("x-content").classList.remove("mt10"),$head.style.marginTop="1rem"):(base.Get("title0").classList.add("well2"),base.Get("x-avatar").classList.remove("hide"),base.Get("x-article").classList.remove("tl"),base.Get("x-article").classList.add("tc"),base.Get("nickname0").classList.add("hide"),base.Get("nickname1").classList.remove("hide"),base.Get("x-content").classList.add("mt10"),$head.style.marginTop="3rem"),mui.each(mui(".edit"),function(e,r){r.classList.remove("well2")}),CurrTemplateJson.PaddingFixed){case 0:$body.classList.add("well2"),$edit.classList.add("temp");break;case 1:$edit.classList.remove("temp"),$body.classList.add("well2");break;case 2:$body.classList.remove("well2"),$edit.classList.add("temp");break;case 3:$body.classList.remove("well2"),$edit.classList.remove("temp"),mui.each(mui(".edit"),function(e,r){r.classList.add("well2")});break;default:$body.classList.add("well2"),$edit.classList.add("temp")}if(ChangeMusic(),$top.classList.add("hide"),$bottom.classList.add("hide"),$body.style.margin="0",$wrapper.style.color="#333",$wrapper.style.backgroundColor="",$wrapper1.classList.remove("x-cover"),$wrapper1.style.background="",$cover.style.backgroundColor="",$cover1.style.backgroundColor="",$wrapper2.classList.add("hide"),$wrapper21.classList.add("hide"),$wrapper2.style.background="",$wrapper2.style.opacity="1",$wrapper21.style.background="",$wrapper21.style.opacity="0",$avatarbg.style.backgroundImage="",$avatarbg.style.width="5rem",$avatarbg.style.height="5rem",$avatar.style.width="100%",$avatar.style.left="0",$avatar.style.top="0",$avatar.style.borderRadius="50%",$avatar.style.zIndex="-1",$avatarbg.style.marginBottom="1rem",CurrTemplateJson.ShowAvatar<0&&base.Get("x-avatar").classList.add("hide"),base.IsNullOrEmpty(CurrTemplateJson.FontColor)||($wrapper.style.color=CurrTemplateJson.FontColor),CurrTemplate>1){if(!base.IsNullOrEmpty(CurrTemplateJson.TopImage)){for(var e=[],r=0;r<CurrTemplateJson.TopImage.length;r++){var a=CurrTemplateJson.TopImage[r];e.push('<img src="'+a.Url+'" class="'+a.Align+'" style="width:'+a.Width+'" />')}$top.innerHTML=e.join(""),$top.classList.remove("hide")}if(base.IsNullOrEmpty(CurrTemplateJson.BottomImage)||($bottom.setAttribute("src",CurrTemplateJson.BottomImage),$bottom.classList.remove("hide")),null!=CurrTemplateJson.Avatar&&(base.IsNullOrEmpty(CurrTemplateJson.Avatar.BackgroundImage)||($avatarbg.style.backgroundImage="url("+CurrTemplateJson.Avatar.BackgroundImage+")"),base.IsNullOrEmpty(CurrTemplateJson.Avatar.Width)||($avatarbg.style.width=CurrTemplateJson.Avatar.Width),base.IsNullOrEmpty(CurrTemplateJson.Avatar.Height)||($avatarbg.style.height=CurrTemplateJson.Avatar.Height),base.IsNullOrEmpty(CurrTemplateJson.Avatar.MarginBottom)||($avatarbg.style.marginBottom=CurrTemplateJson.Avatar.MarginBottom),base.IsNullOrEmpty(CurrTemplateJson.Avatar.MarginTop)||(0==CurrTemplateJson.TransparencyFixed?$head.style.marginTop=CurrTemplateJson.Avatar.MarginTop:($body.style.marginTop=CurrTemplateJson.Avatar.MarginTop,$head.style.marginTop="1rem")),base.IsNullOrEmpty(CurrTemplateJson.Avatar.SubWidth)||($avatar.style.width=CurrTemplateJson.Avatar.SubWidth),base.IsNullOrEmpty(CurrTemplateJson.Avatar.Top)||($avatar.style.top=CurrTemplateJson.Avatar.Top),base.IsNullOrEmpty(CurrTemplateJson.Avatar.Left)||($avatar.style.left=CurrTemplateJson.Avatar.Left),base.IsNullOrEmpty(CurrTemplateJson.Avatar.BorderRadius)||($avatar.style.borderRadius=CurrTemplateJson.Avatar.BorderRadius),base.IsNullOrEmpty(CurrTemplateJson.Avatar.Index)||($avatar.style.zIndex=CurrTemplateJson.Avatar.Index),base.IsNullOrEmpty(CurrTemplateJson.Avatar.Border)||($avatar.style.border=CurrTemplateJson.Avatar.Border)),0==CurrTemplateJson.TransparencyFixed?$cover.style.backgroundColor=CurrTemplateJson.Transparency:$cover1.style.backgroundColor=CurrTemplateJson.Transparency,0==CurrTemplateJson.CoverFixed){if($wrapper1.classList.add("x-cover"),!base.IsNullOrEmpty(CurrTemplateJson.BackgroundImage)){for(var t=[],s=CurrTemplateJson.BackgroundImage.split("?"),r=0;r<s.length;r++)t.push("url("+s[r]+")");$wrapper1.style.backgroundImage=t.join(","),base.IsNullOrEmpty(CurrTemplateJson.BackgroundPosition)||($wrapper1.style.backgroundPosition=CurrTemplateJson.BackgroundPosition),base.IsNullOrEmpty(CurrTemplateJson.BackgroundRepeat)||($wrapper1.style.backgroundRepeat=CurrTemplateJson.BackgroundRepeat),base.IsNullOrEmpty(CurrTemplateJson.BackgroundSize)||($wrapper1.style.backgroundSize=CurrTemplateJson.BackgroundSize)}base.IsNullOrEmpty(CurrTemplateJson.Background)||($wrapper.style.background=CurrTemplateJson.Background,CurrTemplateJson.Background.startWith("#")||CurrTemplateJson.Background.startWith("rgba")||($wrapper.style.background=base.BrowserName()+CurrTemplateJson.Background))}else{if(!base.IsNullOrEmpty(CurrTemplateJson.BackgroundImage)){for(var t=[],s=CurrTemplateJson.BackgroundImage.split("?"),r=0;r<s.length;r++)t.push("url("+s[r]+")");$wrapper2.style.backgroundImage=t.join(","),base.IsNullOrEmpty(CurrTemplateJson.BackgroundPosition)||($wrapper2.style.backgroundPosition=CurrTemplateJson.BackgroundPosition),base.IsNullOrEmpty(CurrTemplateJson.BackgroundRepeat)||($wrapper2.style.backgroundRepeat=CurrTemplateJson.BackgroundRepeat),base.IsNullOrEmpty(CurrTemplateJson.BackgroundSize)||($wrapper2.style.backgroundSize=CurrTemplateJson.BackgroundSize),$wrapper2.classList.remove("hide")}if(2==CurrTemplateJson.CoverFixed&&!base.IsNullOrEmpty(CurrTemplateJson.BackgroundBlurImage)){for(var t=[],s=CurrTemplateJson.BackgroundBlurImage.split("?"),r=0;r<s.length;r++)t.push("url("+s[r]+")");$wrapper21.style.backgroundImage=t.join(","),base.IsNullOrEmpty(CurrTemplateJson.BackgroundPosition)||($wrapper21.style.backgroundPosition=CurrTemplateJson.BackgroundPosition),base.IsNullOrEmpty(CurrTemplateJson.BackgroundRepeat)||($wrapper21.style.backgroundRepeat=CurrTemplateJson.BackgroundRepeat),base.IsNullOrEmpty(CurrTemplateJson.BackgroundSize)||($wrapper21.style.backgroundSize=CurrTemplateJson.BackgroundSize),$wrapper21.classList.remove("hide")}base.IsNullOrEmpty(CurrTemplateJson.Background)||(CurrTemplateJson.Background.startWith("#")||CurrTemplateJson.Background.startWith("rgba")?$wrapper2.style.backgroundColor=CurrTemplateJson.Background:($wrapper2.style.background=CurrTemplateJson.Background,$wrapper2.style.background=base.BrowserName()+CurrTemplateJson.Background),$wrapper2.classList.remove("hide"))}}else if(1==CurrTemplate)if(null==CurrBackground)$wrapper2.style.background="",$wrapper2.className="";else{$cover.style.backgroundColor="RGBA(255, 255, 255, "+(100-CurrBackground.Transparency)/100+")";var o=CurrBackground.Url;switch(o=0==CurrBackground.High?base.ShowThumb(o,1):base.ShowThumb(o,0),$wrapper2.className="",CurrBackground.Full){case 0:$wrapper2.style.background="url("+o+") no-repeat top center",$wrapper2.style.backgroundSize="100% 15.5rem";break;case 1:$wrapper2.style.background="url("+o+") center center no-repeat",$wrapper2.style.backgroundSize="cover"}$body.classList.add("well2"),$edit.classList.add("temp")}}function UpdateComment(){Article.Comments+=1,base.Get("footer_comment").innerHTML=Article.Comments}function UpdateDetail(){Load(function(){mui.later(function(){plus.webview.close("articlepreview","none"),plus.webview.close("addarticle","none"),plus.webview.close("sharesetting"),plus.webview.show("articledetail","fade-in")},500)})}function Delete(){mask.close();mui.confirm("确定要删除这篇文章吗？删除后将无法在浏览器中浏览","",["确定","取消"],function(e){e.index<0||0==e.index&&HttpGet(base.RootUrl+"Article/Delete",{ID:userinfo.ID,ArticleID:ArticleID},function(e){setTimeout(function(){null!=e&&e.result&&(userinfo.Articles-=1,localStorage.setItem("$userinfo",JSON.stringify(userinfo)),base.RefreshUser(),base.GetView("article").evalJS("Refresh()"),self.close())},500)})})}function Copy(){if(!isLoading){isLoading=!0,mui("#topPopover").popover("hide"),mask.show(),base.ShowWaiting("正在复制");var e=base.GetCurrentPosition();HttpGet(base.RootUrl+"Article/Copy",{ID:userinfo.ID,ArticleID:ArticleID,Province:e.Province,City:e.City,District:e.District,Street:e.Street,DetailName:e.DetailName,CityCode:e.CityCode,Latitude:e.Latitude,Longitude:e.Longitude},function(e){mui.later(function(){mask.close(),mui.toast(e.result?"复制成功,前往我的动态查看":e.message),isLoading=!1,e.result&&(base.OpenWindow("article","article.html",{CreateUserNumber:userinfo.Number,ArticleTypeName:"我的动态",Source:"My"}),userinfo.Articles+=1,localStorage.setItem("$userinfo",JSON.stringify(userinfo)),base.RefreshUser())},500)})}}function Edit(){stopsound(),mui("#topPopover").popover("hide"),mask.show(),base.ShowWaiting("正在同步文章内容"),base.OpenWindow("addarticle","addarticle.html",{ArticleID:ArticleID,ArticleNumber:Article.Number,Source:Source}),mui.later(function(){mask.close()},2e3)}function Power(){stopsound(),mask.close(),base.OpenWindow("sharesetting","sharesetting.html",{ArticleID:ArticleID,ArticleNumber:Article.Number,ArticlePower:Article.ArticlePower,ArticlePowerPwd:Article.ArticlePowerPwd,ArticleType:Article.TypeID,ArticleTypeName:Article.TypeName})}function Keep(){isLoading||(isLoading=!0,HttpGet(base.RootUrl+"Api/Keep/Edit",{ID:userinfo.ID,ArticleID:ArticleID},function(e){e=JSON.parse(e),base.CheckLogin(userinfo,e.code),null!=e?(e.result&&(base.Get("iskeep").classList.remove("hide"),base.Get("isnotkeep").classList.add("hide"),userinfo.Keeps+=1,localStorage.setItem("$userinfo",JSON.stringify(userinfo)),base.RefreshUser()),mui.toast(e.result?"收藏成功,在[收藏]中可以找到Ta哦!":e.message)):mui.toast("失败"),isLoading=!1}))}function OutKeep(){mui.confirm("确定要取消收藏吗？","",["确定","取消"],function(e){e.index<0||0==e.index&&HttpGet(base.RootUrl+"Api/Keep/Delete",{ID:userinfo.ID,ArticleNumber:Article.Number},function(e){e=JSON.parse(e),base.CheckLogin(userinfo,e.code),null!=e?(e.result&&(base.Get("iskeep").classList.add("hide"),base.Get("isnotkeep").classList.remove("hide"),userinfo.Keeps-=1,userinfo.Keeps<0&&(userinfo.Keeps=0),localStorage.setItem("$userinfo",JSON.stringify(userinfo)),base.RefreshUser()),mui.toast(e.result?"":e.message)):mui.toast("失败"),isLoading=!1})})}function UpdatePower(e,r,a,t){Article.ArticlePower=e,Article.ArticlePowerPwd=r,Article.TypeID=a,Article.TypeName=t}function UpdateAction(){base.AddClass(["#popover_delete","#popover_edit","#popover_power"],"hide"),plus.webview.close("sharesetting")}var CurrTemplate=0,CurrBackground=null,CurrTemplateJson=null,Article={},ArticleID=0,isLoading=!1,MusicID="",MusicUrl="",MusicName="",browserName=base.BrowserName(),userinfo=base.GetUserInfo(),$header=base.Get("header"),$wrapper=base.Get("wrapper"),$wrapper1=base.Get("x-cover"),$wrapper2=base.Get("x-bg"),$wrapper21=base.Get("x-bg-base"),$cover=base.Get("x-bg-blur"),$cover1=base.Get("x-bg-blur1"),$head=base.Get("x-head"),$body=base.Get("x-body"),$top=base.Get("x-top"),$bottom=base.Get("x-bottom"),$avatarbg=base.Get("x-avatar-sub"),$avatar=base.Get("useravatar0"),$edit=base.Get("desc");