function Camera(){mui("#upload").popover("hide");plus.camera.getCamera().captureImage(function(e){plus.io.resolveLocalFileSystemURL(e,function(e){var t=e.toLocalURL();compressIndex=0,compressTotal=1,length=1,mask.show(),base.ShowWaiting("正在上传图片"),compressImage(t)})},function(e){plus.webview.hide("action")})}function Gallery(){mui("#upload").popover("hide"),plus.gallery.pick(function(e){files=e.files,length=e.files.length,compressTotal=length,mask.show(),base.ShowWaiting("正在上传图片"),compressImage(e.files[0])},function(e){plus.webview.hide("action")},{filter:"image",multiple:!0,maximum:20,system:!1})}function Pic(){mui("#upload").popover("hide");var e={Source:PageName,Multiple:1};base.OpenWindow("mypic","mypic.html",e)}function LoadImage(e,t,a,o){if(e||(length=a-1),length<=0)mask.close();else if(e){var s=new Image;if(s.src=t,s.complete){Upload(getBase64Image(s),o)}else s.onload=function(){Upload(getBase64Image(s),o)}}}function compressImage(e){var t="_downloads/"+base.GetUid()+".jpg";plus.zip.compressImage({src:e,dst:t,overwrite:!0,quality:90,width:"720px",format:"jpg"},function(e){LoadImage(!0,e.target,length,function(){(compressIndex+=1)<compressTotal&&compressImage(files[compressIndex])})},function(t){LoadImage(!1,e,length,function(){(compressIndex+=1)<compressTotal&&compressImage(files[compressIndex])})})}function getBase64Image(e){var t=document.createElement("canvas"),a=e.width,o=e.height;t.width=a,t.height=o;return t.getContext("2d").drawImage(e,0,0,a,o),t.toDataURL("image/jpeg",1)}function Upload(e,t){HttpPost(base.UploadUrl+"Upload/Upload",{str:e,Standard:"Article",Number:userinfo.Number},function(e){if(null!=e&&e.result){if(base.ShowWaiting("正在导入第"+(currUploadImg.length+1)+"张图片..."),base.IsNullOrEmpty(e.message)?length-=1:currUploadImg.push(base.UploadUrl+e.message),length<=0)return mask.close(),void plus.nativeUI.alert("图片导入失败",null,"");currUploadImg.length>=length&&Import(currUploadImg.join(",")),t&&t()}})}function ConfirmImg(e){if(base.IsNullOrEmpty(e))return mask.close(),!1;mask.show(),base.ShowWaiting("正在上传图片"),Import(e)}function Import(e){var t=base.GetCurrentPosition(),a={ID:userinfo.ID,Cover:e,Title:"",Province:t.Province,City:t.City,District:t.District,Street:t.Street,DetailName:t.DetailName,CityCode:t.CityCode,Latitude:t.Latitude,Longitude:t.Longitude};HttpPost(base.RootUrl+"Article/Edit",a,function(e){null!=e?e.result?(base.OpenWindow("addarticle","addarticle.html",{ArticleID:e.message.ID,ArticleNumber:e.message.Number,Source:"Add"}),mui.later(function(){mask.close()},1e3)):(mask.close(),mui.toast(e.message)):mask.close()})}var length=0,files=[],compressIndex=0,compressTotal=0,currUploadImg=[],mask=base.CreateMask(!1,function(){base.CloseWaiting(),plus.webview.hide("action")});