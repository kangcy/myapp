function HttpGet(e,t,i){mui.getJSON(e,t,i)}function HttpPost(e,t,i){mui.post(e,t,i,"json")}function ChangeSlider(e){var t=e.parentNode.children[0];t.style.width=e.clientWidth+"px",t.style.transform="translateX("+e.offsetLeft+"px)",base.RemoveClass([".tabs_item"],"is-active"),e.classList.add("is-active")}function LoadPull(e,t,i,n,a,s,o){HttpGet(t,i,function(e){var t="";if(null!=(e=JSON.parse(e)))if(e.result){e=e.message,totalpage=e.totalpage,records=e.records,n&&base.ShowNone(!1);var i=base.IsNullOrEmpty(i)?"scroll-view":i,r=base.Get(i);records>0&&(t=e.list,a?DelayEachArray(e.list,0,50,base.CurrAnimate,function(e){var t=s(e);r.appendChild(t)}):mui.each(e.list,function(e,t){r.appendChild(s(t))}))}else totalpage=1,records=0;0==records&&n&&base.ShowNone(!0),o&&o(t),base.ShowLoading(!1)})}function LoadScript(e,t){var i=document.createElement("script");i.type="text/javascript",void 0!==t&&(i.readyState?i.onreadystatechange=function(){"loaded"!=i.readyState&&"complete"!=i.readyState||(i.onreadystatechange=null,t())}:i.onload=function(){t()}),i.src=e,document.body.appendChild(i)}function DelayEachArray(e,t,i,n,a){0==t&&(base.CurrAnimate=n),n==base.CurrAnimate&&(a&&a(e[t]),++t<e.length?mui.later(function(){DelayEachArray(e,t,i,n,a)},i):base.CurrAnimate="")}function Top(){mui.scrollTo(0,250)}function SetPullEnable(e,t,i){e?self.setPullToRefresh({support:!0,height:"100px",offset:t||Math.round(plus.navigator.getStatusbarHeight())+45+"px",style:"circle"},function(){i?i():pulldownRefresh()}):self.setPullToRefresh({support:!1,style:"circle",height:"0px"},function(){})}function LazyImg(e){e.removeAttribute("onload");var t=new Image,i=e.getAttribute("data-lazyload");t.src=i,t.complete?e.setAttribute("src",i):t.onload=function(){e.setAttribute("src",i)}}function LazyCover(e,t){var i=new Image;i.src=e,i.complete?t.call(i):i.onload=function(){t.call(i)}}function StorageImg(e){MobileFrame.init(e)}function ClearPush(e,t){HttpGet(base.RootUrl+"Push/Clear",{number:e,pushtype:t},function(e){if(e){var i=base.GetView("tipsetting");i&&i.evalJS("PushClear('"+t+"')");var n=base.GetView("my");n&&n.evalJS("InitPush()"),base.GetView("subindex").evalJS("InitPush()")}})}function CreatPageWaiting(e,t){var i=plus.nativeObj.View.getViewById("pageWaiting");return i||((i=new plus.nativeObj.View("pageWaiting",{top:e+"px",bottom:t+"px",left:"0%",width:"100%"})).interceptTouchEvent(!0),i.drawText("加 载 中 ...",{top:e+"px",left:"0px",width:"100%",height:"50%"},{size:"13px",color:"rgb(100,100,100)"}),i)}function ProgressLoading(e,t,i){mui.later(function(){(t+=20*Math.random())>i&&(t=i),e.progressbar().setProgress(t),t<i&&ProgressLoading(e,t,i),t>=100&&mui.later(function(){e.progressbar().hide()},250)},50*Math.random()+50)}function CopyToClip(e){if(window.plus){if(mui.os.android){var t=plus.android.importClass("android.content.Context"),i=plus.android.runtimeMainActivity().getSystemService(t.CLIPBOARD_SERVICE);plus.android.invoke(i,"setText",e)}else{var n=plus.ios.importClass("UIPasteboard").generalPasteboard();n.setValueforPasteboardType(e,"public.utf8-plain-text");var a=n.plusCallMethod({valueForPasteboardType:"public.utf8-plain-text"});console.log("IOS复制的数据是：",a)}mui.toast("分享链接已复制到剪贴板")}}!function(e,t){var i=e.documentElement,n="orientationchange"in window?"orientationchange":"resize",a=function(){var e=i.clientWidth,t=localStorage.getItem("$screenwidth");t&&(e=t),e&&(i.style.fontSize=e/320*16+"px",i.style.width="100%",i.style.height="100%")};e.addEventListener&&(t.addEventListener(n,a,!1),e.addEventListener("DOMContentLoaded",a,!1))}(document,window);var waiting=new function(){this.create=function(e){var t=base.Get("waiting");if(t)return base.Get("waiting_title").innerHTML=e,t;var i=document.createElement("div");return i.className="waiting c333 f13 tc",i.setAttribute("id","waiting"),i.style.zIndex="2147483647",i.innerHTML='<div><svg viewBox="25 25 50 50" class="circular"><circle cx="50" cy="50" r="20" fill="none" class="path"></circle></svg><span id="waiting_title">'+e+"</span></div>",document.getElementsByTagName("body")[0].appendChild(i),i},this.setTitle=function(e){this.create(e);base.Get("waiting_title").innerHTML=e},this.show=function(e){this.create(e).classList.remove("hide")},this.close=function(){this.create("").classList.add("hide")},this.isshow=function(){var e=document.getElementById("waiting");return!!e&&e.className.indexOf("hide")<0}},isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},browser={versions:function(){var e=navigator.userAgent;navigator.appVersion;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&-1==e.indexOf("KHTML"),mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:-1==e.indexOf("Safari")}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},base=new function(){this.ErrorCode={UnLogin:1,Delete:2,NoPower:3},this.TriggerMain=!1,this.InitPosition=function(e,t){plus.geolocation.getCurrentPosition(function(t){var i={Province:t.address.province,City:t.address.city,District:t.address.district,Street:t.address.street,DetailName:t.address.poiName,CityCode:t.address.cityCode,Latitude:t.coords.latitude,Longitude:t.coords.longitude};localStorage.setItem("$position",JSON.stringify(i)),e&&e()},function(e){localStorage.removeItem("$position"),t&&t()})},this.GetCurrentPosition=function(){var e=localStorage.getItem("$position")||"";return base.IsNullOrEmpty(e)?{Province:"",City:"",District:"",Street:"",DetailName:"",CityCode:"",Latitude:"",Longitude:""}:JSON.parse(e)},this.youku_client_id="59bec9b0be1fc34b",this.youku_client_secret="244a6bbc4b212e01b8702745b879e52d",this.IsLoading=!1,this.CurrAnimate="",this.PageSize=15,this.AnimateDuration=350,this.RootUrl="http://www.xiaoweipian.com/",this.RootUrlTest="http://www.xiaoweipian.com:8080/",this.UploadUrl="http://www.xiaoweipian.com:1010/",this.DefaultImg="../images/logo_default.png",this.DefaultAvatar="../images/avatar.png",this.ShowLoading=function(e){base.Get("loader")&&(e?base.Get("loader").classList.remove("hide"):base.Get("loader").classList.add("hide"))},this.ShowNone=function(e){e?base.Get("none").classList.remove("hide"):base.Get("none").classList.add("hide")},this.GetUserInfo=function(){var e=localStorage.getItem("$userinfo")||"";return""==e?"":JSON.parse(e)},this.GetSettings=function(){var e=localStorage.getItem("$settings")||"{}";return JSON.parse(e)},this.CheckLogin=function(e,t){if(""==e||t==base.ErrorCode.UnLogin)return base.IsLoading=!1,base.OpenWindow("login","../page/login.html",{},"fade-in"),!1},this.IsNullOrEmpty=function(e){return!e||(""==e||("null"==e.toString().toLowerCase()||"undefined"==e.toString().toLowerCase()))},this.FormatStr=function(e,t){return base.IsNullOrEmpty(e)||" "==e?t:e},this.GetUid=function(){return(new Date).getTime().toString()},this.CheckPhone=function(e){return!base.IsNullOrEmpty(e)&&(11==e.length&&!isNaN(e)&&/^1[3|4|5|6|7|8|9][0-9]\d{4,8}$/.test(e))},this.ShowWaiting=function(e){waiting.show(e)},this.CloseWaiting=function(){waiting.close()},this.CheckWaiting=function(){if(waiting.isshow())return!0;var e=document.getElementById("mui-backdrop");return!!e&&e.className.indexOf("hide")<0},this.Waiting=function(e,t){e?plus.nativeUI.showWaiting(t,{width:"80%",padding:"5%",background:"rgba(0,0,0,0.6)",loading:{display:"inline"}}):plus.nativeUI.closeWaiting()},this.CreateMask=function(e,t){var i=document.createElement("div");i.classList.add("mui-backdrop"),i.setAttribute("id","mui-backdrop"),i.addEventListener(mui.EVENT_MOVE,mui.preventDefault),i.addEventListener("tap",function(){n._enable&&n.close()});var n=[i];return n._show=!1,n._enable=e,n.show=function(){return n._show=!0,i.setAttribute("style","opacity:1"),document.body.appendChild(i),n},n._remove=function(){return n._show&&(n._show=!1,i.setAttribute("style","opacity:0"),mui.later(function(){var e=document.body;i.parentNode===e&&e.removeChild(i)},350)),n},n.close=function(){n._remove(),t()},n};var e=null;this.RepeatAction=function(){return!!e||(e=(new Date).getTime(),mui.later(function(){e=null},1e3),!1)},this.ShowAnimate=function(){var e="pop-in";return mui.os.android&&parseFloat(mui.os.version)<4.4&&(e="slide-in-right"),e},this.HideAnimate=function(){var e="pop-out";return mui.os.android&&parseFloat(mui.os.version)<4.4&&(e="slide-out-right"),e},this.OpenWindow=function(e,t,i,n,a,s,o){if(!base.RepeatAction()){var r={top:"0px",bottom:"0px",width:"100%",height:"100%",popGesture:"close",bounce:a||"none",scrollIndicator:"none",backButtonAutoControl:s||"none"};o&&(r.background=o),mui.openWindow({id:e,url:t,show:{autoShow:!0,duration:n&&"none"==n?0:base.AnimateDuration,aniShow:n||base.ShowAnimate()},styles:r,createNew:!0,waiting:{autoShow:!1},extras:i})}},this.OpenWindowNew=function(e,t,i,n){var a=plus.webview.create(e,t,i,n),s=new plus.nativeObj.Bitmap("nwbitmap");console.log("aa");var o=function(e,t,i){console.log("aaaa"),plus.nativeObj.View.startAnimation({type:e||"pop-in"},{},{bitmap:t},function(){console.log("动画结束"),i&&i()})};console.log("bb");console.log("cc"),a.onloaded=function(e){console.log("dd"),function(e,t,i){t=t||new plus.nativeObj.Bitmap("defultBitMap"),e.draw(t,function(){i&&i(t)},function(e){i&&i(),console.log("截图错误："+JSON.stringify(e))})}(a,s,function(e){console.log(e),e?o("pop-in",e,function(){console.log("ee"),a.show("none",0,function(){console.log("ff"),a.onclose=function(){o("pop-out",e,function(){plus.nativeObj.View.clearAnimation()})},plus.nativeObj.View.clearAnimation()})}):a.show("pop-in",250)})}},this.UpdateFan=function(e,t){t?e.Follows=t:e.Follows+=1,localStorage.setItem("$userinfo",JSON.stringify(e)),base.RefreshUser()},this.InitSlider=function(e){mui(".mui-slider").slider({bounce:e}),mui(".mui-scroll-wrapper.mui-slider-indicator.mui-segmented-control").scroll({scrollY:!1,scrollX:!0,indicators:!1,bounce:!1,snap:".mui-control-item"})},this.InitScroll=function(e){var t=mui.os.ios?.003:9e-4;mui(".mui-scroll-wrapper").scroll({bounce:e||!1,indicators:!1,deceleration:t})},this.RefreshScroll=function(){mui(".mui-scroll-wrapper").scroll().refresh()},this.ToTop=function(){base.Get("header").addEventListener("doubletap",function(){base.IsLoading||(base.IsLoading=!0,mui.scrollTo(0,250),mui.later(function(){base.IsLoading=!1},250))},!1)},this.UpdateUser=function(e,t){HttpGet(base.RootUrl+"User/Info",{Number:e},function(e){if(null!=e&&e.result){var i={ID:(e=e.message).ID,Sex:e.Sex,Signature:e.Signature,Password:e.Password,Avatar:""==e.Avatar?base.DefaultImg:e.Avatar,NickName:e.NickName,Address:e.Address,Birthday:e.BirthdayText,Follows:e.Follows,Fans:e.Fans,Articles:e.Articles,Keeps:e.Keeps,Comments:e.Comments,Zans:e.Zans,Cover:e.Cover,Phone:e.Phone,WeiXin:e.WeiXin,QQ:e.QQ,Weibo:e.Weibo,ShareNick:e.ShareNick,AutoMusic:e.AutoMusic,IsPay:e.IsPay,Money:e.Money,UseDraw:e.UseDraw,Number:e.Number,ShowZan:e.ShowZan,ShowKeep:e.ShowKeep,ShowFollow:e.ShowFollow,ShowFan:e.ShowFan,ShowPush:e.ShowPush,ShowPosition:e.ShowPosition,UserRole:e.UserRole,CreateDate:e.CreateDateText,Star:e.Star,DrawText:e.DrawText,RelatedNumber:e.RelatedNumber};localStorage.setItem("$userinfo",JSON.stringify(i)),t&&t(i)}})},this.ShowUser=function(e){mui(e).on("tap",".user",function(e){if(base.TriggerMain)return!1;base.TriggerMain=!0,mui.later(function(){base.TriggerMain=!1},500);var t=this.getAttribute("userid"),i=this.getAttribute("nickname"),n=this.getAttribute("cover"),a=this.getAttribute("avatar");base.OpenWindow("user"+t,"user.html",{UserNumber:t,NickName:i,Cover:n,Avatar:a},"","none")})},this.ShowArticle=function(e,t,i){mui(e).on("tap",".article",function(e){if(!base.TriggerMain){var n=this.getAttribute("articleid"),a=this.getAttribute("userid"),s=this.getAttribute("power").toString(),o=this.getAttribute("nickname").toString();i==a&&(s=3),base.OpenWindow("articledetail_new","articledetail_new_20171128.html",{ArticleID:n,Source:t,ArticlePower:s,NickName:o},null,"none")}})},this.ShowThumbBase=function(e,t){return base.IsNullOrEmpty(e)?base.DefaultAvatar:e.indexOf("_0")<0?e:e=e.replace("_0","_"+t)},this.ShowThumb=function(e,t){return base.IsNullOrEmpty(e)?base.DefaultAvatar:e.indexOf("_0")<0?e:((e=e.replace("_0","_"+t)).toString().toLowerCase().indexOf("http://")<0&&(e=base.UploadUrl+e),e)},this.ShareLog=function(e,t,i,n){HttpGet(base.RootUrl+"ShareLog/Edit",{UserNumber:e,Number:t,Source:i,ShareType:n},function(e){})},this.SwitchChange=function(e,t){base.ToggleClass(["#"+e],"active",t)},this.AppendUser=function(e,t,i,n,a,s){var o=document.createElement("div");o.className=a?"mui-table-view-cell user user1 bounceInUp":"mui-table-view-cell user user1",o.setAttribute("userid",e.Number),o.setAttribute("nickname",e.NickName),o.setAttribute("cover",e.Cover),o.setAttribute("avatar",e.Avatar);var r=[];if(r.push('<div class="flex-box flex-row">'),r.push('<div style="flex:0 0 16%;" class="flex-item tl">'),n?r.push('<div class="avatar"><img onload="StorageImg(this)" src="../images/avatar.png" data-lazyload="'+base.ShowThumb(e.Avatar,1)+'" class="fl"  /></div>'):r.push('<div class="avatar"><img src="'+base.ShowThumb(e.Avatar,1)+'" class="fl"  /></div>'),r.push("</div>"),s>0?r.push('<div style="flex:0 0 64%;" class="flex-item tl">'):r.push('<div style="flex:0 0 84%;" class="flex-item">'),r.push('<p class="f13 c333 mt3">'+base.UnUnicodeText(e.NickName)+"</p>"),t&&r.push('<p class="f10 mt3 c999">'+base.UnUnicodeText(e.Signature)+"</p>"),i){var u=parseFloat(e.Distance),l=parseInt(u/100);l<9?r.push('<p class="f10 mt3 c999">'+(l+1)+"00米以内</p>"):r.push('<p class="f10 mt3 c999">'+(parseInt(u/1e3)+1)+"公里以内</p>")}return r.push("</div>"),s>0&&(r.push('<div style="flex:0 0 20%;" class="flex-item tr">'),1==s?0==e.IsFollow&&userinfo.Number!=e.Number?r.push('<div class="guanzhu" userid="'+e.Number+'"><img src="../images/base/follow0.png" class="fr" /></div>'):r.push('<div class="guanzhu2" userid="'+e.Number+'"><img src="../images/base/follow1.png" class="fr" /></div>'):2==s&&r.push('<div class="blackrelease"><img src="../images/base/follow2.png" class="fr" style="width:3.8rem !important;" /></div>'),r.push("</div>")),r.push("</div>"),o.innerHTML=r.join(""),o},this.UserFan=function(e,t){base.UserAddFan(e,t),base.UserOutFan(e,t)},this.UserAddFan=function(e,t){mui(e).on("tap",".guanzhu",function(e){if(base.IsLoading)return!1;base.IsLoading=!0,base.TriggerMain=!0,mui.later(function(){base.TriggerMain=!1},500);var i=this,n=this.getAttribute("userid"),a={ID:t.ID,ToUserNumber:n};HttpGet(base.RootUrl+"Api/Fan/Edit",a,function(e){e=JSON.parse(e),base.CheckLogin(t,e.code),null!=e?(e.result&&(i.classList.remove("guanzhu"),i.classList.add("guanzhu2"),i.childNodes[0].setAttribute("src","../images/base/follow1.png"),base.UpdateFan(t,e.message)),mui.toast(e.result?"关注成功,在[关注]中可以找到Ta哦!":e.message)):mui.toast("失败"),base.IsLoading=!1})})},this.UserOutFan=function(e,t){mui(e).on("tap",".guanzhu2",function(e){if(base.IsLoading)return!1;base.IsLoading=!0,base.TriggerMain=!0,mui.later(function(){base.TriggerMain=!1},500);var i=this,n=this.getAttribute("userid");HttpGet(base.RootUrl+"Api/Fan/Delete",{ID:t.ID,ToUserNumber:n},function(e){e=JSON.parse(e),base.CheckLogin(t,e.code),e.result?(i.classList.remove("guanzhu2"),i.classList.add("guanzhu"),i.childNodes[0].setAttribute("src","../images/base/follow0.png"),base.UpdateFan(t,e.message)):mui.toast(e.message),base.IsLoading=!1})})},this.UnicodeText=function(e){return base.IsNullOrEmpty(e)?"":escape(e).toLocaleLowerCase().replace(/%u/gi,"\\u")},this.UnUnicodeText=function(e){return base.IsNullOrEmpty(e)?"":unescape(e.replace(/\\u/gi,"%u"))},this.AddClass=function(e,t){this.ToggleClass(e,t,!0)},this.RemoveClass=function(e,t){this.ToggleClass(e,t,!1)},this.ToggleClass=function(e,t,i){if(!base.IsNullOrEmpty(e)){var n=t.split(" ");i?mui.each(e,function(e,t){if(t.indexOf(".")<0){var i=mui(t)[0];mui.each(n,function(e,t){i.classList.add(t)})}else mui.each(n,function(e,i){mui(t).each(function(e,t){t.classList.add(i)})})}):mui.each(e,function(e,t){if(t.indexOf(".")<0){var i=mui(t)[0];mui.each(n,function(e,t){i.classList.remove(t)})}else mui.each(n,function(e,i){mui(t).each(function(e,t){t.classList.remove(i)})})})}},this.HasClass=function(e,t){return e.className.indexOf(t)>=0},this.Get=function(e){return e.indexOf(".")<0?mui("#"+e)[0]:mui(e)},this.GetView=function(e){return plus.webview.getWebviewById(e)},this.RefreshUser=function(){null!=base.GetView("my")&&base.GetView("my").evalJS("Refresh()")},this.InitPull=function(e,t,i){mui(base.Get(e)).pullToRefresh({down:{callback:function(){t&&t();pulldownRefresh(this)}},up:{auto:!0,callback:function(){i&&i();pullupRefresh(this)}}})},this.BrowserName=function(){var e="";return browser.versions.webKit?e="-webkit-":browser.versions.gecko?e="-moz-":browser.versions.presto?e="-o-":browser.versions.trident&&(e="-ms-"),e},this.Immersed=function(e){var t=0,i=/Html5Plus\/.+\s\(.*(Immersed\/(\d+\.?\d*).*)\)/gi.exec(navigator.userAgent);if(i&&i.length>=3&&(t=parseFloat(i[2])),t){var n=document.getElementById("header");if(n)if(n.style.paddingTop=t+"px",n.style.paddingBottom="45px","none"!=n.getAttribute("immersed")){n.style.background="-webkit-linear-gradient(left,#4e8cfb 0%,#24c3fb 75%,#39b8fd 100%)";var a=base.BrowserName();n.style.background=a+"linear-gradient(left,#4e8cfb 0%,#24c3fb 75%,#39b8fd 100%)",(n=document.getElementById("scroll-wrapper"))&&(n.style.marginTop=t+"px")}else n.style.background="transparent",(n=document.getElementById("scroll-wrapper"))&&(n.style.marginTop="0px");(n=document.getElementById("muicontent"))&&(n.style.paddingTop=t+45+"px")}},this.Immersed_White=function(e){var t=0,i=/Html5Plus\/.+\s\(.*(Immersed\/(\d+\.?\d*).*)\)/gi.exec(navigator.userAgent);if(i&&i.length>=3&&(t=parseFloat(i[2])),t){var n=document.getElementById("header");n&&(n.style.paddingTop=t+"px",n.style.paddingBottom="45px","none"!=n.getAttribute("immersed")?(n.style.background="#ffffff",(n=document.getElementById("scroll-wrapper"))&&(n.style.marginTop=t+"px")):(n.style.background="transparent",(n=document.getElementById("scroll-wrapper"))&&(n.style.marginTop="0px"))),(n=document.getElementById("muicontent"))&&(n.style.paddingTop=t+45+"px")}},this.ShowTemplate=function(e,t,i,n,a,s,o){if(!base.RepeatAction()){var r=o?"template"+base.GetUid():"template";plus.webview.create("template.html",r,{top:"0px",bottom:"0px",scrollIndicator:"none"},{subid:e,suburl:t,subtitle:i,subparam:n,subtop:s,subanimate:a,isnew:o?1:0})}},this.Html=function(e,t){var i=null;mui.each(e,function(e,n){(i=base.Get(n))&&(i.innerHTML=t)})},this.Text=function(e,t){var i=null;mui.each(e,function(e,n){(i=base.Get(n))&&(i.innerText=t)})},this.Attr=function(e,t){mui.each(t,function(t,i){e.setAttribute(i[0],i[1])})}},PushType={Comment:1,Money:2,Fan:3,FanArticle:4,Article:5,Red:6,Update:10};String.prototype.startWith=function(e){return new RegExp("^"+e).test(this)},String.prototype.endWith=function(e){return new RegExp(e+"$").test(this)};