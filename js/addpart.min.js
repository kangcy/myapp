function upload(){if(!(files.length<=0)){base.ShowWaiting("准备上传"+files.length+"张图片"),plus.uploader.clear();var e=plus.uploader.createUpload(base.UploadUrl+"Upload/UploadImage",{method:"POST"},function(e,l){if(200==l){clearInterval(a);var s=JSON.parse(e.responseText);base.IsNullOrEmpty(s.message)?(mui.toast("上传失败"),mask.close()):Import(s.message)}else mui.toast("上传失败"),mask.close()});e.addData("standard","Article"),e.addData("folder","Article"),e.addData("number",userinfo.Number),mui.each(uploadFiles,function(a,l){base.IsNullOrEmpty(l.url)||e.addFile(l.url,{key:l.id})}),e.start();var a=setInterval(function(){var a=e.totalSize,l=e.uploadedSize;a>0&&base.ShowWaiting("上传进度："+parseFloat(100*l/a).toFixed(2)+"%")},100)}}function Camera(){mui("#upload").popover("hide"),uploadFiles=[];plus.camera.getCamera().captureImage(function(e){plus.io.resolveLocalFileSystemURL(e,function(e){mask.show(),base.ShowWaiting("正在压缩图片"),compressImage((files=[e.toLocalURL()])[0])})})}function Gallery(){mui("#upload").popover("hide"),uploadFiles=[],plus.gallery.pick(function(e){mask.show(),base.ShowWaiting("正在压缩图片"),compressImage((files=e.files)[0])},function(e){console.log("取消选择图片")},{filter:"image",multiple:!0,maximum:100,system:!1})}function compressImage(e){var a="_downloads/"+base.GetUid()+".jpg";plus.zip.compressImage({src:e,dst:a,overwrite:!0,quality:90,width:"720px",format:"jpg"},function(e){uploadFiles.push({id:base.GetUid(),url:e.target}),uploadFiles.length<files.length?compressImage(files[uploadFiles.length]):upload()},function(e){uploadFiles.push({id:0,url:""}),uploadFiles.length<files.length?compressImage(files[uploadFiles.length]):upload()})}function Import(e){base.ShowWaiting("正在同步段落信息");for(var a=e.split(","),l=a.length,s=0;s<l;s++)AddPic(base.GetUid(),a[s],0),s>=l-1&&mask.close()}var files=[],uploadFiles=[],mask=base.CreateMask(!1,function(){base.CloseWaiting()});