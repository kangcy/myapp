function CreateActionView(){bgview=new plus.nativeObj.View("bgview",{top:"0px",left:"0px",height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0.5)"}),(customview=new plus.nativeObj.View("customview",{left:"0px",bottom:"0px",width:"100%",height:"200px",backgroundColor:"#fff"})).draw([{tag:"rect",id:"line1",color:"#f5f5f5",position:{bottom:"50px",left:"0px",width:"100%",height:"1px"}},{tag:"rect",id:"line2",color:"#f5f5f5",position:{bottom:"100px",left:"0px",width:"100%",height:"1px"}},{tag:"rect",id:"line3",color:"#f5f5f5",position:{bottom:"150px",left:"0px",width:"100%",height:"1px"}},{tag:"font",id:"font1",text:"添加收藏",textStyles:{size:"16px",color:"#000"},position:{bottom:"150px",height:"50px"}},{tag:"font",id:"font2",text:"添加关注",textStyles:{size:"16px",color:"#000"},position:{bottom:"100px",height:"50px"}},{tag:"font",id:"font3",text:"举报",textStyles:{size:"16px",color:"#ff0000"},position:{bottom:"50px",height:"50px"}},{tag:"font",id:"font4",text:"取消",textStyles:{size:"16px",color:"#ff0000"},position:{bottom:"0px",height:"50px"}}]),bgview.interceptTouchEvent(!0),customview.interceptTouchEvent(!0),bgview.addEventListener("click",function(e){HideView()},!1),customview.addEventListener("click",function(e){var t=e.clientY;t<=50?IsKeep?OutKeep():Keep():t>50&&t<=100?IsFan?OutFollow():Follow():t>100&&t<=150&&Report(),HideView()},!1)}function ActionTan(e,t,i,s){ArticleNumber=t,ArticleID=i,ArticleUserNumber=s;base.Get("article"+ArticleID)}function Keep(){base.RepeatAction()||HttpGet(base.RootUrl+"Api/Keep/Edit",{ID:userinfo.ID,ArticleID:ArticleID},function(e){if(e=JSON.parse(e),base.CheckLogin(userinfo,e.code),null!=e){if(e.result){userinfo.Keeps+=1,localStorage.setItem("$userinfo",JSON.stringify(userinfo));base.Get("article"+ArticleID).setAttribute("iskeep",1),base.RefreshUser()}mui.toast(e.result?"收藏成功,在[收藏]中可以找到Ta哦!":e.message)}else mui.toast("失败")})}function OutKeep(){if(!base.RepeatAction()){var e=base.Get("article"+ArticleID);mui.confirm("确定取消收藏？","",["确定","取消"],function(t){t.index<0||0==t.index&&HttpGet(base.RootUrl+"Api/Keep/Delete",{ID:userinfo.ID,ArticleNumber:ArticleNumber},function(t){t=JSON.parse(t),base.CheckLogin(userinfo,t.code),null!=t?t.result?("keep"==self.id?(e.parentNode.removeChild(e),records-=1,records<0&&(records=0),records<=0&&base.ShowNone(!0),userinfo.Keeps=records):(userinfo.Keeps=userinfo.Keeps-1,userinfo.Keeps<0&&(userinfo.Keeps=0),e.setAttribute("iskeep",0)),localStorage.setItem("$userinfo",JSON.stringify(userinfo)),base.RefreshUser()):mui.toast(t.message):mui.toast("失败")})})}}function Follow(){base.RepeatAction()||HttpGet(base.RootUrl+"Api/Fan/Edit",{ID:userinfo.ID,ToUserNumber:ArticleUserNumber},function(e){if(e=JSON.parse(e),base.CheckLogin(userinfo,e.code),null!=e){if(e.result){base.Get("article"+ArticleID).setAttribute("isfollow",1),base.Get("guanzhu"+ArticleID).setAttribute("src","../images/base/follow1.png"),base.Get("guanzhu"+ArticleID).classList.remove("guanzhu"),base.UpdateFan(userinfo,e.message)}mui.toast(e.result?"关注成功,在[关注]中可以找到Ta哦!":e.message)}else mui.toast("失败")})}function OutFollow(){base.RepeatAction()||HttpGet(base.RootUrl+"Api/Fan/Delete",{ID:userinfo.ID,ToUserNumber:ArticleUserNumber},function(e){if((e=JSON.parse(e)).result){base.Get("article"+ArticleID).setAttribute("isfollow",0),base.Get("guanzhu"+ArticleID).setAttribute("src","../images/base/follow0.png"),base.Get("guanzhu"+ArticleID).classList.remove("guanzhu2"),base.Get("guanzhu"+ArticleID).classList.add("guanzhu"),base.UpdateFan(userinfo,e.message)}else mui.toast(e.message)})}function Report(){base.OpenWindow("edittext","edittext.html",{source:"report",ArticleNumber:ArticleNumber})}function AppendArticle(e,t,i,s,r,a){var o=document.createElement("div");o.className="mui-card inline article",o.style.margin="3% 3% 0",o.setAttribute("articleid",t.ArticleID),o.setAttribute("userid",t.UserNumber),o.setAttribute("power",t.ArticlePower),o.setAttribute("nickname",t.NickName),o.setAttribute("iskeep",t.IsKeep),o.setAttribute("isfollow",t.IsFollow),o.setAttribute("id","article"+t.ArticleID);var n=[],l="",c="";switch(t.ArticlePower){case"0":c="power0.png",l="私密";break;case 1:c="power2.png",l="密码可见";break;case 2:c="power2.png",l="分享可见";break;case 3:c="power1.png",l="公开";break;default:c="power0.png",l="私密"}i?n.push('<div class="c999 f11 star mb10"><img src="../images/article/'+c+'" class="fl" /><span class="fl">'+l+'</span><span class="fr">'+t.CreateDate+"</span></div>"):(n.push('<div class="mui-card-header noborder mui-card-media">'),r?n.push('<img class="user" userid="'+t.UserNumber+'" nickname="'+t.NickName+'"avatar="'+t.Avatar+'"cover="'+t.UserCover+'" onload="StorageImg(this)" src="../images/avatar.png" data-lazyload="'+base.ShowThumb(t.Avatar,1)+'" style="border-radius:50%;width:2rem !important;height:2rem !important;" />'):n.push('<img class="user" userid="'+t.UserNumber+'" nickname="'+t.NickName+'"avatar="'+t.Avatar+'"cover="'+t.UserCover+'"src="'+base.ShowThumb(t.Avatar,1)+'" style="border-radius:50%;width:2rem !important;height:2rem !important;" />'),n.push('<div class="mui-media-body f14 mt0" style="position:relative;"><span class="user c333" userid="'+t.UserNumber+'"nickname="'+t.NickName+'"avatar="'+t.Avatar+'"cover="'+t.UserCover+'">'+base.UnUnicodeText(t.NickName)+'</span><p class="f10 full mt1">'),n.push("<span>"+t.CreateDate+"</span>"),base.IsNullOrEmpty(t.City)||n.push('<span class="blue ml5">'+t.Province+" • "+t.City+"</span>"),n.push("</p>"),""!=e&&e!=t.UserNumber&&n.push('<img id="guanzhu'+t.ArticleID+'" class="'+(0==t.IsFollow?"guanzhu":"guanzhu2")+'" userid="'+t.UserNumber+'" articleid="'+t.ArticleID+'" articleNumber="'+t.ArticleNumber+'" articleUserNumber="'+t.UserNumber+'" src="../images/base/'+(0==t.IsFollow?"follow0":"follow1")+'.png" style="position:absolute;right:0px;top:0.3rem;width:3.8rem;" />'),n.push("</div></div></div>")),n.push('<div class="mui-card-content show"><div class="mui-card-content-inner">'),n.push('<div class="c333 fl full mb10 f12" style="line-height:1.3rem;">'),n.push('<div class="c333 fl article f12" style="width:100%;display:inline-block;" articleid="'+t.ArticleID+'" userid="'+t.UserNumber+'" power="'+t.ArticlePower+'" nickname="'+t.NickName+'">'),base.IsNullOrEmpty(t.Title)&&(t.Title="我的小微篇"),n.push(base.UnUnicodeText(t.Title)+"</div>"),n.push("</div>");var u=t.ArticlePart;if(n.push('<div class="inline full">'),0==u.length)r?n.push('<div class="onefloor" href="'+base.ShowThumb(t.Cover,1)+'" articleid="'+t.ArticleID+'"><img onload="StorageImg(this)" src="../images/default.png" data-lazyload="'+base.ShowThumb(t.Cover,2)+'" /></div>'):n.push('<div class="onefloor" href="'+base.ShowThumb(t.Cover,1)+'" articleid="'+t.ArticleID+'"><img src="'+base.ShowThumb(t.Cover,2)+'" /></div>');else if(1==u.length)r?n.push('<div class="onefloor" href="'+base.ShowThumb(u[0].Introduction,1)+'" articleid="'+t.ArticleID+'"><img onload="StorageImg(this)" src="../images/default.png" data-lazyload="'+base.ShowThumb(u[0].Introduction,2)+'" /></div>'):n.push('<div class="onefloor" href="'+base.ShowThumb(u[0].Introduction,1)+'" articleid="'+t.ArticleID+'"><img src="'+base.ShowThumb(u[0].Introduction,2)+'" /></div>');else for(var c=3==u.length?"thirdfloor":"secondfloor",d=0;d<u.length;d++)r?n.push('<div class="'+c+'" href="'+base.ShowThumb(u[d].Introduction,1)+'" articleid="'+t.ArticleID+'"><img onload="StorageImg(this)" src="../images/default.png" data-lazyload="'+base.ShowThumb(u[d].Introduction,2)+'" /></div>'):n.push('<div class="'+c+'" href="'+base.ShowThumb(u[d].Introduction,1)+'" articleid="'+t.ArticleID+'"><img src="'+base.ShowThumb(u[d].Introduction,2)+'" /></div>');n.push("</div></div></div>"),n.push('<div class="mui-card-footer fl full c333 f11 inline">');var m="height:1.5rem;display:inline-block;";return n.push('<div style="'+m+'" class="fl tl"><img src="../images/article/view.png" style="width:1rem;" class="ml5 mr5 fl" /><span class="f13 fl mr10">'+t.Views+"</span></div>"),n.push('<div style="'+m+'" class="fl tl goods '+(0==t.IsZan?"":"red")+'" articleid="'+t.ArticleID+'" already="'+(0==t.IsZan?0:1)+'"><img src="../images/article/'+(0==t.IsZan?"btn_good":"btn_good2")+'.png" style="width:0.9rem;" class="ml5 mr5 fl" /><span class="f13 fl mr10">'+t.Goods+"</span></div>"),n.push('<div style="'+m+'" class="comments fl tl" articleid="'+t.ArticleID+'" ArticleNumber="'+t.ArticleNumber+'"><img id="icomments'+t.ArticleID+'" src="../images/article/btn_comment.png" style="width:0.9rem;" class="mt1 fl ml5 mr10" /><span class="f13 fl mr10" >'+t.Comments+"</span></div>"),""!=e&&e!=t.UserNumber&&n.push('<div style="width:1.5rem;height:100%;" class="fr tanaction" articleId="'+t.ArticleID+'" articleNumber="'+t.ArticleNumber+'" articleUserNumber="'+t.UserNumber+'"><img src="../images/article/btn_more.png" style="width:1rem;" class="mt1" /></div>'),n.push("</div>"),o.innerHTML=n.join(""),o}function ArticleAction(e,t){ArticleAddGuanZhu(e,t,function(){mui.toast("关注成功,在[关注]中可以找到Ta哦!")}),ArticleOutGuanZhu(e,t),mui(e).on("tap",".onefloor,.secondfloor,.thirdfloor",function(){if(isLoading)return!1;isLoading=!0,base.TriggerMain=!0,mui.later(function(){base.TriggerMain=!1},500);var e=this.getAttribute("href");ArticleID=this.getAttribute("articleid");var t=0,i=[];mui.each(this.parentNode.childNodes,function(s,r){e==r.getAttribute("href")&&(t=s),i.push(r.getAttribute("href"))});var s=base.GetView("imageviewer");s?s.evalJS("ResetImages('"+i+"','"+ArticleID+"','"+t+"')"):base.OpenWindow("imageviewer","imageviewer.html",{Url:i.join(","),Group:ArticleID,CurrID:t},"fade-in",!1,"hide","#000"),isLoading=!1}),mui(e).on("tap",".tanaction",function(){if(isLoading)return!1;isLoading=!0,base.TriggerMain=!0,mui.later(function(){base.TriggerMain=!1},500),ArticleNumber=this.getAttribute("articleNumber"),ArticleID=this.getAttribute("articleId"),ArticleUserNumber=this.getAttribute("articleUserNumber");var e=base.Get("article"+ArticleID),i=e.getAttribute("iskeep"),s=e.getAttribute("isfollow"),r=ArticleUserNumber==t.Number?1:0,a=base.GetView("action");a?a.evalJS("ResetAction(2,'"+PageName+"','"+i+"','"+s+"','"+r+"')"):base.OpenWindow("action","action.html",{Type:2,PageName:PageName,IsKeep:i,IsFollow:s,IsMy:r},"none",!1,!1,"transparent"),isLoading=!1})}function ArticleAddZan(e,t){mui(e).on("tap",".goods",function(e){if(!base.RepeatAction()){var i=this,s=i.getAttribute("articleid");HttpGet(base.RootUrl+"Api/Zan/ArticleZanEdit",{ID:t.ID,ArticleID:s},function(e){if(e=JSON.parse(e),base.CheckLogin(t,e.code),null!=e)if(e.result){if(1==e.message.split("|")[0]){i.setAttribute("already","0"),i.classList.remove("red"),i.classList.remove("heartbeat"),i.childNodes[0].setAttribute("src","../images/article/btn_good.png");s=parseInt(i.childNodes[1].innerHTML);i.childNodes[1].innerHTML=s-1<0?0:s-1}else{i.setAttribute("already","1"),i.childNodes[0].setAttribute("src","../images/article/btn_good2.png");var s=parseInt(i.childNodes[1].innerHTML);i.childNodes[1].innerHTML=s+1,i.classList.add("red"),i.classList.add("heartbeat")}}else mui.toast(e.message);else mui.toast("失败")})}})}function ArticleAddPay(e,t){mui(e).on("tap",".pays",function(e){if(base.IsLoading)return!1;base.IsLoading=!0;var t=this.getAttribute("ArticleNumber"),i=this.getAttribute("NickName"),s=this.getAttribute("Avatar");base.IsLoading=!1,base.OpenWindow("money","../page/money.html",{ArticleNumber:t,ArticleUserNumber:"",Name:i,Avatar:s})})}function ArticleAddComment(e,t){mui(e).on("tap",".comments",function(e){if(base.IsLoading)return!1;base.IsLoading=!0;var t=this.getAttribute("ArticleNumber");base.IsLoading=!1,base.OpenWindow("articleComment","../page/articleComment.html",{ArticleNumber:t})})}function ArticleAddGuanZhu(e,t,i){mui(e).on("tap",".guanzhu",function(e){if(isLoading)return!1;isLoading=!0,base.TriggerMain=!0,mui.later(function(){base.TriggerMain=!1},500);var s=this,r=this.getAttribute("userid"),a=this.getAttribute("articleid");this.classList.remove("guanzhu"),HttpGet(base.RootUrl+"Api/Fan/Edit",{ID:t.ID,ToUserNumber:r},function(e){e=JSON.parse(e),base.CheckLogin(t,e.code),null!=e?e.result?(s.classList.remove("guanzhu"),s.classList.add("guanzhu2"),s.setAttribute("src","../images/base/follow1.png"),base.UpdateFan(t,e.message),base.Get("article"+a).setAttribute("isfollow",1),i&&i(s)):(mui.toast(e.message),s.classList.add("guanzhu")):(mui.toast("失败"),s.classList.add("guanzhu")),isLoading=!1})})}function ArticleOutGuanZhu(e,t,i){mui(e).on("tap",".guanzhu2",function(e){if(isLoading)return!1;isLoading=!0,base.TriggerMain=!0,mui.later(function(){base.TriggerMain=!1},500),ArticleNumber=this.getAttribute("articlenumber"),ArticleID=this.getAttribute("articleid"),ArticleUserNumber=this.getAttribute("articleusernumber"),OutFollow(),isLoading=!1})}var ArticleNumber="",ArticleID=0,ArticleUserNumber="",IsKeep=!1,IsFan=!1,isLoading=!1,bgview=null,customview=null;