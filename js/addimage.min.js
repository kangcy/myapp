function upload(){plus.uploader.clear();var e=plus.uploader.createUpload(base.UploadUrl+"Upload/UploadImage",{method:"POST"},function(e,a){if(200==a){clearInterval(t);var i=JSON.parse(e.responseText);Init(),base.IsNullOrEmpty(i.message)?(mui.toast("上传失败"),mask.close()):Import(i.message)}else mui.toast("上传失败"),mask.close()});e.addData("standard","Article"),e.addData("folder","Article"),e.addData("number",userinfo.Number),mask.show(),base.ShowWaiting("准备上传"+mui(".thirdfloor").length+"张图片"),mui.each(mui(".thirdfloor"),function(t,a){e.addFile(a.getAttribute("url"),{key:a.getAttribute("id")})}),e.start();var t=setInterval(function(){var t=e.totalSize,a=e.uploadedSize;t>0&&base.ShowWaiting("上传进度："+parseFloat(100*a/t).toFixed(2)+"%")},100)}function Camera(){plus.camera.getCamera().captureImage(function(e){plus.io.resolveLocalFileSystemURL(e,function(e){mui("#upload").popover("hide"),compressImage(0,(files=[e.toLocalURL()])[0])})},function(e){mui("#upload").popover("hide")})}function Gallery(){plus.gallery.pick(function(e){mui("#upload").popover("hide"),compressImage(0,(files=e.files)[0])},function(e){mui("#upload").popover("hide"),console.log("取消选择图片")},{filter:"image",multiple:!0,maximum:100,system:!1})}function compressImage(e,t){var a=e+1,i="_downloads/"+base.GetUid()+".jpg";plus.zip.compressImage({src:t,dst:i,overwrite:!0,quality:90,width:"500px",format:"jpg"},function(e){AppendStart(e.target),a<files.length?compressImage(a,files[a]):AppendEnd()},function(e){a<files.length?compressImage(a,files[a]):AppendEnd()})}function Import(e){base.ShowWaiting("正在同步文章信息");var t=base.GetCurrentPosition(),a={ID:userinfo.ID,Cover:e,Title:"",Province:t.Province,City:t.City,District:t.District,Street:t.Street,DetailName:t.DetailName,CityCode:t.CityCode,Latitude:t.Latitude,Longitude:t.Longitude};HttpPost(base.RootUrl+"Article/Edit",a,function(e){null!=e?e.result?(base.OpenWindow("addarticle","addarticle.html",{ArticleID:e.message.ID,ArticleNumber:e.message.Number,Source:"Add"}),mui.later(function(){mask.close()},1e3)):(mask.close(),mui.toast(e.message)):mask.close()})}var files=[],mask=base.CreateMask(!1,function(){base.CloseWaiting()});