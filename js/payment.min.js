function Payment(){if(!isLoading){isLoading=!0;var a=$("#txtmoney").val().trim();if(base.IsNullOrEmpty(a)||isNaN(a))return isLoading=!1,mui.toast("红包金额格式错误");if(a<=0)return isLoading=!1,mui.toast("红包金额格式错误");if(!/^\d+(\.\d{1,2})?$/.test(a))return isLoading=!1,mui.toast("红包金额格式错误");if(a*=100,0==payway)return isLoading=!1,mui.toast("暂不支持支付宝，请使用微信支付");mask.show(),base.ShowWaiting("支付请求中");var e=0==payway?"alipay":"wxpay",i=base.RootUrl+"Notify/AddWxOrder?UserNumber="+userinfo.Number+"&Money="+a+"&Anony="+(anony?1:0)+"&ArticleNumber="+ArticleNumber+"&ArticleUserNumber="+ArticleUserNumber,r=base.RootUrl+"Notify/AddWxOrder?UserNumber="+userinfo.Number+"&Money="+a+"&Anony="+(anony?1:0)+"&ArticleNumber="+ArticleNumber+"&ArticleUserNumber="+ArticleUserNumber,s="";if("alipay"==e)s=i;else{if("wxpay"!=e)return isLoading=!1,mask.close(),base.CloseWaiting(),void plus.nativeUI.alert("不支持此支付通道！",null,"");s=r}mui.get(s,{},function(a){var i=a;if(base.IsNullOrEmpty(i))return isLoading=!1,mask.close(),plus.nativeUI.alert("请求订单失败！",null,""),!1;var r={retcode:0,retmsg:"ok",appid:i.appid,noncestr:i.noncestr,package:i.package,partnerid:i.partnerid,prepayid:i.prepayid,timestamp:i.timestamp,sign:i.sign};mask.close(),plus.payment.request(channel[e],r,function(a){mask.show(),base.Get("success").classList.remove("hide")},function(a){mask.show(),base.Get("error").classList.remove("hide")}),isLoading=!1},"json")}}function PayTan(a){0==a?$("#mypaybg,#mypay").addClass("hide"):$("#mypaybg,#mypay").removeClass("hide")}function ChangePayMoney(a){0==a?$("#mypaybg,#mypay").addClass("hide"):$("#mypaybg,#mypay").removeClass("hide")}function ChangePayWay(a){payway=a,0==a?($("#weixin").removeClass("curr"),$("#alipay").addClass("curr")):($("#alipay").removeClass("curr"),$("#weixin").addClass("curr"))}var channel={},payway=1;