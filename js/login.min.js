var owner = new function() {
	this.login = function(loginInfo, callback) {
		callback = callback || mui.noop;
		loginInfo = loginInfo || {};
		loginInfo.Phone = loginInfo.Phone || '';
		loginInfo.Password = loginInfo.Password || '';
		if(loginInfo.Phone.length < 5) {
			return callback('账号最短为 5 个字符')
		}
		if(loginInfo.Password.length < 6 || loginInfo.Password.length > 16) {
			return callback('密码为6-16个字符')
		}
		HttpGet(base.RootUrl + "User/Login", {
			Phone: loginInfo.Phone,
			Password: loginInfo.Password,
			Province: loginInfo.Province,
			City: loginInfo.City,
			District: loginInfo.District,
			Street: loginInfo.Street,
			DetailName: loginInfo.DetailName,
			CityCode: loginInfo.CityCode,
			Latitude: loginInfo.Latitude,
			Longitude: loginInfo.Longitude,
			ClientID: loginInfo.ClientID,
			PhoneModel: loginInfo.PhoneModel
		}, function(data) {
			if(data == null) {
				return callback("系统异常,请稍后再试")
			} else {
				if(data.result) {
					var user = data.message;
					var info = {
						ID: user.ID,
						Sex: user.Sex == "0" ? "男" : "女",
						Signature: user.Signature,
						Password: user.Password,
						Avatar: user.Avatar == "" ? base.DefaultImg : user.Avatar,
						NickName: user.NickName,
						Address: user.Address,
						Birthday: user.BirthdayText,
						Follows: user.Follows,
						Fans: user.Fans,
						Articles: user.Articles,
						Keeps: user.Keeps,
						Comments: user.Comments,
						Zans: user.Zans,
						Cover: user.Cover,
						Phone: user.Phone,
						WeiXin: user.WeiXin,
						QQ: user.QQ,
						Weibo: user.Weibo,
						ShareNick: user.ShareNick,
						AutoMusic: user.AutoMusic,
						IsPay: user.IsPay,
						Money: user.Money,
						UseDraw: user.UseDraw,
						Number: user.Number,
						ShowZan: user.ShowZan,
						ShowKeep: user.ShowKeep,
						ShowFollow: user.ShowFollow,
						ShowFan: user.ShowFan,
						ShowPush: user.ShowPush,
						ShowPosition: user.ShowPosition,
						UserRole: user.UserRole
					};
					localStorage.setItem('$userinfo', JSON.stringify(info));
					return callback(data)
				} else {
					return callback(data)
				}
			}
		})
	};
	this.loginThird = function(loginInfo, callback) {
		callback = callback || mui.noop;
		HttpGet(base.RootUrl + "User/LoginThird", {
			NickName: loginInfo.NickName,
			Avatar: loginInfo.Avatar,
			Sex: loginInfo.Sex,
			OpenID: loginInfo.OpenID,
			Cover: "",
			Province: loginInfo.Province,
			City: loginInfo.City,
			District: loginInfo.District,
			Street: loginInfo.Street,
			DetailName: loginInfo.DetailName,
			CityCode: loginInfo.CityCode,
			Latitude: loginInfo.Latitude,
			Longitude: loginInfo.Longitude,
			Source: loginInfo.Source,
			ClientID: loginInfo.ClientID,
			PhoneModel: loginInfo.PhoneModel
		}, function(data) {
			if(data == null) {
				return callback("系统异常,请稍后再试")
			}
			if(data.result) {
				var user = data.message;
				var info = {
					ID: user.ID,
					Sex: user.Sex == "0" ? "男" : "女",
					Signature: user.Signature,
					Password: user.Password,
					Avatar: user.Avatar == "" ? base.DefaultImg : user.Avatar,
					NickName: user.NickName,
					Address: user.Address,
					Birthday: user.BirthdayText,
					Follows: user.Follows,
					Fans: user.Fans,
					Articles: user.Articles,
					Keeps: user.Keeps,
					Comments: user.Comments,
					Zans: user.Zans,
					Cover: user.Cover,
					Phone: user.Phone,
					WeiXin: user.WeiXin,
					QQ: user.QQ,
					Weibo: user.Weibo,
					ShareNick: user.ShareNick,
					AutoMusic: user.AutoMusic,
					IsPay: user.IsPay,
					Money: user.Money,
					UseDraw: user.UseDraw,
					Number: user.Number,
					ShowZan: user.ShowZan,
					ShowKeep: user.ShowKeep,
					ShowFollow: user.ShowFollow,
					ShowFan: user.ShowFan,
					ShowPush: user.ShowPush,
					ShowPosition: user.ShowPosition,
					UserRole: user.UserRole
				};
				localStorage.setItem('$userinfo', JSON.stringify(info));
				return callback(data)
			} else {
				return callback(data)
			}
		})
	};
	this.reg = function(regInfo, callback) {
		callback = callback || mui.noop;
		regInfo = regInfo || {};
		regInfo.Phone = regInfo.Phone || '';
		regInfo.NickName = regInfo.NickName || '';
		regInfo.Password = regInfo.Password || '';
		HttpGet(base.RootUrl + "User/Register", {
			Phone: regInfo.Phone,
			Password: regInfo.Password,
			NickName: regInfo.NickName,
			Province: regInfo.Province,
			City: regInfo.City,
			District: regInfo.District,
			Street: regInfo.Street,
			DetailName: regInfo.DetailName,
			CityCode: regInfo.CityCode,
			Latitude: regInfo.Latitude,
			Longitude: regInfo.Longitude,
			Cover: "",
			Code: regInfo.Code,
			SMS: regInfo.SMS,
			ClientID: loginInfo.ClientID
		}, function(data) {
			if(data == null) {
				return callback("系统异常,请稍后再试")
			}
			if(data.result) {
				data = data.message;
				var info = {
					ID: data.ID,
					Password: data.Password,
					Avatar: data.Avatar,
					NickName: data.NickName,
					Address: "",
					Birthday: "0001-01-01",
					Sex: "男",
					Signature: "",
					Follows: 0,
					Fans: 0,
					Articles: 0,
					Keeps: 0,
					Comments: 0,
					Zans: 0,
					Cover: data.Cover,
					Phone: data.Phone,
					WeiXin: data.WeiXin,
					QQ: data.QQ,
					Weibo: data.Weibo,
					ShareNick: data.ShareNick,
					AutoMusic: data.AutoMusic,
					IsPay: data.IsPay,
					Money: data.Money,
					UseDraw: data.UseDraw,
					Number: data.Number,
					ShowZan: data.ShowZan,
					ShowKeep: data.ShowKeep,
					ShowFollow: data.ShowFollow,
					ShowFan: data.ShowFan,
					ShowPush: data.ShowPush,
					ShowPosition: data.ShowPosition,
					UserRole: data.UserRole
				};
				localStorage.setItem('$userinfo', JSON.stringify(info));
				return callback()
			} else {
				return callback(data.message)
			}
		})
	};
	this.loginOut = function() {
		localStorage.removeItem('$userinfo');
	};
	var checkEmail = function(email) {
		email = email || '';
		if(email == '') {
			return false
		}
		return email.length > 3 && email.indexOf('@') > -1
	};
	var checkPhone = function(phone) {
		phone = phone || '';
		if(phone == '') {
			return false
		}
		return phone.length == 11 && !isNaN(phone) && (/^1[3|4|5|6|7|8|9][0-9]\d{4,8}$/.test(phone))
	};
	this.forgetPassword = function(email, callback) {
		callback = callback || $.noop;
		if(!checkEmail(email)) {
			return callback('邮箱地址不合法')
		}
		return callback(null, '新的随机密码已经发送到您的邮箱，请查收邮件。')
	};
	this.setSettings = function(settings) {
		settings = settings || {};
		localStorage.setItem('$settings', JSON.stringify(settings))
	};
	this.getSettings = function() {
		var settingsText = localStorage.getItem('$settings') || "{}";
		return JSON.parse(settingsText)
	};
	this.isInstalled = function(id) {
		if(id === 'qihoo' && mui.os.plus) {
			return true
		}
		if(mui.os.android) {
			var main = plus.android.runtimeMainActivity();
			var packageManager = main.getPackageManager();
			var PackageManager = plus.android.importClass(packageManager);
			var packageName = {
				"qq": "com.tencent.mobileqq",
				"weixin": "com.tencent.mm",
				"sinaweibo": "com.sina.weibo"
			};
			try {
				return packageManager.getPackageInfo(packageName[id], PackageManager.GET_ACTIVITIES)
			} catch(e) {}
		} else {
			switch(id) {
				case "qq":
					var TencentOAuth = plus.ios.import("TencentOAuth");
					return TencentOAuth.iphoneQQInstalled();
				case "weixin":
					var WXApi = plus.ios.import("WXApi");
					return WXApi.isWXAppInstalled();
				case "sinaweibo":
					var SinaAPI = plus.ios.import("WeiboSDK");
					return SinaAPI.isWeiboAppInstalled();
				default:
					break
			}
		}
	}
}
window.app = owner;