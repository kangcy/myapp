var ArticleNumber="";var ArticleID=0;var ArticleUserNumber="";var mask=base.CreateMask(false,function(){base.CloseWaiting();mui("#action").popover("hide")});function OpenMask(){mask=base.CreateMask(false,function(){});mask.show();base.ShowWaiting("")}function CloseMask(){mask=base.CreateMask(true,function(){base.CloseWaiting();mui("#action").popover("hide")});mask.close()}function ActionTan(a,c,b,e){if(a){ArticleNumber=c;ArticleID=b;ArticleUserNumber=e;var d=base.Get("article"+ArticleID);if(d.getAttribute("iskeep")==0){base.Get("action_keep").classList.remove("hide");base.Get("action_outkeep").classList.add("hide")}else{base.Get("action_keep").classList.add("hide");base.Get("action_outkeep").classList.remove("hide")}if(d.getAttribute("isfollow")==0){base.Get("action_follow").classList.remove("hide");base.Get("action_outfollow").classList.add("hide")}else{base.Get("action_follow").classList.add("hide");base.Get("action_outfollow").classList.remove("hide")}mui("#action").popover("show")}}function Keep(){if(base.RepeatAction()){return}mask.close();HttpGet(base.RootUrl+"Api/Keep/Edit",{ID:userinfo.ID,ArticleID:ArticleID},function(b){b=JSON.parse(b);base.CheckLogin(userinfo,b.code);if(b!=null){if(b.result){userinfo.Keeps+=1;localStorage.setItem("$userinfo",JSON.stringify(userinfo));var a=base.Get("article"+ArticleID);a.setAttribute("iskeep",1);base.RefreshUser()}mui.toast(b.result?"收藏成功":b.message)}else{mui.toast("失败")}})}function OutKeep(){if(base.RepeatAction()){return}mask.close();var a=base.Get("article"+ArticleID);mui.confirm("确认取消收藏？","",["确认","取消"],function(b){if(b.index<0){return}if(b.index==0){HttpGet(base.RootUrl+"Api/Keep/Delete",{ID:userinfo.ID,ArticleNumber:ArticleNumber},function(c){c=JSON.parse(c);base.CheckLogin(userinfo,c.code);if(c!=null){if(c.result){if(PageName=="keep"){a.parentNode.removeChild(a);records=records-1;if(records<0){records=0}if(records<=0){base.ShowNone(true)}userinfo.Keeps=records}else{userinfo.Keeps=userinfo.Keeps-1;if(userinfo.Keeps<0){userinfo.Keeps=0}a.setAttribute("iskeep",0)}localStorage.setItem("$userinfo",JSON.stringify(userinfo));base.RefreshUser()}else{mui.toast(c.message)}}else{mui.toast("失败")}})}})}function Follow(){if(base.RepeatAction()){return}mask.close();HttpGet(base.RootUrl+"Api/Fan/Edit",{ID:userinfo.ID,ToUserNumber:ArticleUserNumber},function(b){b=JSON.parse(b);base.CheckLogin(userinfo,b.code);if(b!=null){if(b.result){var a=base.Get("article"+ArticleID);a.setAttribute("isfollow",1);base.UpdateFan(userinfo,b.message)}mui.toast(b.result?"关注成功":b.message)}else{mui.toast("失败")}})}function OutFollow(){if(base.RepeatAction()){return}mask.close();mui.confirm("确认取消关注？","",["确认","取消"],function(a){if(a.index<0){return}if(a.index==0){HttpGet(base.RootUrl+"Api/Fan/Delete",{ID:userinfo.ID,ToUserNumber:ArticleUserNumber},function(c){c=JSON.parse(c);if(c.result){userinfo.Follows=userinfo.Follows-1;if(userinfo.Follows<0){userinfo.Follows=0}var b=base.Get("article"+ArticleID);b.setAttribute("isfollow",0);localStorage.setItem("$userinfo",JSON.stringify(userinfo));base.RefreshUser()}else{mui.toast(c.message)}})}})}function Report(){base.OpenWindow("edittext","edittext.html",{source:"report",ArticleNumber:ArticleNumber});mask.close()};