var ArticleNumber="";var ArticleID=0;var ArticleUserNumber="";var mask=base.CreateMask(false,function(){base.CloseWaiting();mui("#action").popover("hide")});function OpenMask(){mask=base.CreateMask(false,function(){});mask.show();base.ShowWaiting("")}function CloseMask(){mask=base.CreateMask(true,function(){base.CloseWaiting();mui("#action").popover("hide")});mask.close()}function ActionTan(a,c,b,e){if(a){ArticleNumber=c;ArticleID=b;ArticleUserNumber=e;var d=base.Get("article"+ArticleID);if(d.getAttribute("iskeep")==0){base.Get("action_keep").classList.remove("hide");base.Get("action_outkeep").classList.add("hide")}else{base.Get("action_keep").classList.add("hide");base.Get("action_outkeep").classList.remove("hide")}if(d.getAttribute("isfollow")==0){base.Get("action_follow").classList.remove("hide");base.Get("action_outfollow").classList.add("hide")}else{base.Get("action_follow").classList.add("hide");base.Get("action_outfollow").classList.remove("hide")}mui("#action").popover("show")}}function Keep(){if(base.RepeatAction()){return}mask.close();HttpGet(base.RootUrl+"Api/Keep/Edit",{ID:userinfo.ID,ArticleID:ArticleID},function(b){b=JSON.parse(b);base.CheckLogin(userinfo,b.code);if(b!=null){if(b.result){userinfo.Keeps+=1;localStorage.setItem("$userinfo",JSON.stringify(userinfo));var a=base.Get("article"+ArticleID);a.setAttribute("iskeep",1);base.RefreshUser()}mui.toast(b.result?"收藏成功":b.message)}else{mui.toast("失败")}})}function OutKeep(){if(base.RepeatAction()){return}mask.close();var a=base.Get("article"+ArticleID);mui.confirm("确认取消收藏？","",["确认","取消"],function(b){if(b.index<0){return}if(b.index==0){HttpGet(base.RootUrl+"Api/Keep/Delete",{ID:userinfo.ID,ArticleNumber:ArticleNumber},function(c){c=JSON.parse(c);base.CheckLogin(userinfo,c.code);if(c!=null){if(c.result){if(PageName=="keep"){a.parentNode.removeChild(a);records=records-1;if(records<0){records=0}if(records<=0){base.ShowNone(true)}userinfo.Keeps=records}else{userinfo.Keeps=userinfo.Keeps-1;if(userinfo.Keeps<0){userinfo.Keeps=0}a.setAttribute("iskeep",0)}localStorage.setItem("$userinfo",JSON.stringify(userinfo));base.RefreshUser()}else{mui.toast(c.message)}}else{mui.toast("失败")}})}})}function Follow(){if(base.RepeatAction()){return}mask.close();HttpGet(base.RootUrl+"Api/Fan/Edit",{ID:userinfo.ID,ToUserNumber:ArticleUserNumber},function(b){b=JSON.parse(b);base.CheckLogin(userinfo,b.code);if(b!=null){if(b.result){var a=base.Get("article"+ArticleID);a.setAttribute("isfollow",1);base.UpdateFan(userinfo,b.message)}mui.toast(b.result?"关注成功":b.message)}else{mui.toast("失败")}})}function OutFollow(){if(base.RepeatAction()){return}mask.close();mui.confirm("确认取消关注？","",["确认","取消"],function(a){if(a.index<0){return}if(a.index==0){HttpGet(base.RootUrl+"Api/Fan/Delete",{ID:userinfo.ID,ToUserNumber:ArticleUserNumber},function(c){c=JSON.parse(c);if(c.result){userinfo.Follows=userinfo.Follows-1;if(userinfo.Follows<0){userinfo.Follows=0}var b=base.Get("article"+ArticleID);b.setAttribute("isfollow",0);localStorage.setItem("$userinfo",JSON.stringify(userinfo));base.RefreshUser()}else{mui.toast(c.message)}})}})}function Report(){base.OpenWindow("edittext","edittext.html",{source:"report",ArticleNumber:ArticleNumber});mask.close()}function AppendArticle(m,l,g,j,a,k){var d=document.createElement("div");if(k){d.className="mui-card mui-table-view-cell bounceInUp";d.style.padding="0px";d.setAttribute("kid",l.ArticleNumber)}else{d.className="mui-card"}d.setAttribute("iskeep",l.IsKeep);d.setAttribute("isfollow",l.IsFollow);d.style.paddingBottom="0.8rem";d.setAttribute("id","article"+l.ArticleID);var h=[];if(k){h.push('<div class="mui-slider-right mui-disabled tc"><a class="mui-btn mui-btn-red">删除</a></div>')}var c="";var b="";switch(l.ArticlePower){case"0":b="power0.png";c="私密";break;case 1:b="power2.png";c="密码可见";break;case 2:b="power2.png";c="分享可见";break;case 3:b="power1.png";c="公开";break;default:b="power0.png";c="私密";break}if(g){h.push('<div class="c999 f11 star mb10"><img src="../images/article/'+b+'" class="fl" /><span class="fl">'+c+'</span><span class="fr">'+l.CreateDate+"</span></div>")}else{if(k){h.push('<div class="mui-slider-cell mui-slider-handle">')}if(l.Recommend==99){h.push('<div class="c999 f11 star">');h.push('<img src="../images/article/star.png" class="fl" /><span class="fl">精华</span>');h.push('<div style="width:1.5rem;height:100%;" class="fr tanaction" articleId="'+l.ArticleID+'" articleNumber="'+l.ArticleNumber+'" articleUserNumber="'+l.UserNumber+'"><a class="mui-action-menu mui-icon mui-icon-arrowdown fr f16 mt10 c999"></a></div></div>')}else{if(l.Recommend==100){h.push('<div class="c999 f11 star">');h.push('<img src="../images/article/top.png" class="fl" /><span class="fl">置顶</span>');h.push('<div style="width:1.5rem;height:100%;" class="fr tanaction" articleId="'+l.ArticleID+'" articleNumber="'+l.ArticleNumber+'" articleUserNumber="'+l.UserNumber+'"><a class="mui-action-menu mui-icon mui-icon-arrowdown fr f16 mt10 c999"></a></div></div>')}}h.push('<div class="mui-card-header noborder mui-card-media">');if(a){h.push('<img class="user" userid="'+l.UserNumber+'" data-lazyload="'+base.ShowThumb(l.Avatar,1)+'" style="border-radius:50%;width:2rem !important;height:2rem !important;" />')}else{h.push('<img class="user" userid="'+l.UserNumber+'" src="'+base.ShowThumb(l.Avatar,1)+'" style="border-radius:50%;width:2rem !important;height:2rem !important;" />')}h.push('<div class="mui-media-body f14 mt0" style="position:relative;"><span class="user c333" userid="'+l.UserNumber+'">'+base.UnUnicodeText(l.NickName)+'</span><p class="f10 full c999 mt5">'+l.CreateDate);if(!base.IsNullOrEmpty(l.City)){h.push('<span class="ml5 mr5 c999">来自</span><span class="c999">'+l.Province+" • "+l.City+"</span>")}h.push("</p>");if(l.Recommend==0){h.push('<div style="width:1.5rem;height:100%;position:absolute;right:0rem;top:0rem;" class="fr tanaction" articleId="'+l.ArticleID+'" articleNumber="'+l.ArticleNumber+'" articleUserNumber="'+l.UserNumber+'"><a class="mui-action-menu mui-icon mui-icon-arrowdown fr f16 mt10 c999"></a></div></div>')}h.push("</div></div>")}h.push('<div class="mui-card-content show"><div class="mui-card-content-inner">');h.push('<div class="c333 fl article full mt5 mb10 f12" style="line-height:1.3rem;" articleid="'+l.ArticleID+'" userid="'+l.UserNumber+'" power="'+l.ArticlePower+'" nickname="'+l.NickName+'">');if(base.IsNullOrEmpty(l.Title)){l.Title="我的小微篇"}h.push(base.UnUnicodeText(l.Title)+"</div>");var e=l.ArticlePart;if(e.length==0){if(a){h.push('<div class="onefloor"><img data-lazyload="'+base.ShowThumb(l.Cover,1)+'" href="'+base.ShowThumb(l.Cover,1)+'" data-preview-src="" data-preview-group="'+l.ArticleID+'" /></div>')}else{h.push('<div class="onefloor"><img src="'+base.ShowThumb(l.Cover,1)+'" href="'+base.ShowThumb(l.Cover,1)+'" data-preview-src="" data-preview-group="'+l.ArticleID+'" /></div>')}}else{if(e.length==1){if(a){h.push('<div class="onefloor"><img data-lazyload="'+base.ShowThumb(e[0].Introduction,1)+'" href="'+base.ShowThumb(e[0].Introduction,1)+'" data-preview-src="" data-preview-group="'+l.ArticleID+'" /></div>')}else{h.push('<div class="onefloor"><img src="'+base.ShowThumb(e[0].Introduction,1)+'" href="'+base.ShowThumb(e[0].Introduction,1)+'" data-preview-src="" data-preview-group="'+l.ArticleID+'" /></div>')}}else{var b=e.length==3?"thirdfloor":"secondfloor";for(var f=0;f<e.length;f++){if(a){h.push('<div class="'+b+'"><img data-lazyload="'+base.ShowThumb(e[f].Introduction,2)+'" href="'+base.ShowThumb(e[f].Introduction,1)+'" data-preview-src="" data-preview-group="'+l.ArticleID+'" /></div>')}else{h.push('<div class="'+b+'"><img src="'+base.ShowThumb(e[f].Introduction,2)+'" href="'+base.ShowThumb(e[f].Introduction,1)+'" data-preview-src="" data-preview-group="'+l.ArticleID+'" /></div>')}}}}h.push("</div></div>");h.push('<div class="mui-card-footer fl full c999 f11" style="display:inline-block;"><span class="fl mt1">浏览'+l.Views+"次</span>");if(l.IsPay==1){h.push('<div style="width:2.5rem;height:1.5rem;display:inline-block;" class="pays fr tc" articleid="'+l.ArticleID+'" ArticleNumber="'+l.ArticleNumber+'" UserNumber="'+l.UserNumber+'" NickName="'+l.NickName+'" Avatar="'+l.Avatar+'" articleid="'+l.ArticleID+'"><img id="ipays'+l.ArticleID+'" src="../images/base/reward_nor.png" style="width:0.9rem;" class="mt1" /></div>')}h.push('<div style="width:2.5rem;height:1.5rem;display:inline-block;" class="comments fr tc" articleid="'+l.ArticleID+'" ArticleNumber="'+l.ArticleNumber+'"><img id="icomments'+l.ArticleID+'" src="../images/base/comment_nor.png" style="width:0.9rem;" class="mt1" /></div>');h.push('<div style="width:2.5rem;height:1.5rem;display:inline-block;" class="fr tc"><img src="../images/base/'+(l.IsZan==0?"like_nor":"like_hig")+'.png" style="width:0.9rem;" class="mr10 fr goods '+(l.IsZan==0?"":"red")+'" articleid="'+l.ArticleID+'" already="'+(l.IsZan==0?0:1)+'" /></div>');h.push("</div>");if(k){h.push("</div>")}d.innerHTML=h.join("");return d}function ArticleAction(b,a){ArticleAddZan(b,a);ArticleAddPay(b,a);ArticleAddComment(b,a)}function ArticleAddZan(b,a){mui(b).on("tap",".goods",function(d){if(base.RepeatAction()){return}var e=this;var c=e.getAttribute("articleid");HttpGet(base.RootUrl+"Api/Zan/ArticleZanEdit",{ID:a.ID,ArticleID:c},function(f){f=JSON.parse(f);base.CheckLogin(a,f.code);if(f!=null){if(f.result){var g=f.message.split("|");if(g[0]==1){e.setAttribute("already","0");e.setAttribute("src","../images/base/like_nor.png");e.classList.remove("red");e.classList.remove("heartbeat")}else{e.setAttribute("already","1");e.setAttribute("src","../images/base/like_hig.png");e.classList.add("red");e.classList.add("heartbeat")}}else{mui.toast(f.message)}}else{mui.toast("失败")}})})}function ArticleAddPay(b,a){mui(b).on("tap",".pays",function(d){if(base.IsLoading){return false}base.IsLoading=true;var e=this.getAttribute("ArticleNumber");var f=this.getAttribute("NickName");var c=this.getAttribute("Avatar");base.IsLoading=false;base.OpenWindow("money","../page/money.html",{ArticleNumber:e,ArticleUserNumber:"",Name:f,Avatar:c})})}function ArticleAddComment(b,a){mui(b).on("tap",".comments",function(c){if(base.IsLoading){return false}base.IsLoading=true;var d=this.getAttribute("ArticleNumber");base.IsLoading=false;base.OpenWindow("articleComment","../page/articleComment.html",{ArticleNumber:d})})};