var ArticleNumber="";var ArticleID=0;var ArticleUserNumber="";var IsKeep=false;var IsFan=false;var isLoading=false;var bgview=null;var customview=null;function CreateActionView(){bgview=new plus.nativeObj.View("bgview",{top:"0px",left:"0px",height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0.5)"});customview=new plus.nativeObj.View("customview",{left:"0px",bottom:"0px",width:"100%",height:"200px",backgroundColor:"#fff"});customview.draw([{tag:"rect",id:"line1",color:"#f5f5f5",position:{bottom:"50px",left:"0px",width:"100%",height:"1px"}},{tag:"rect",id:"line2",color:"#f5f5f5",position:{bottom:"100px",left:"0px",width:"100%",height:"1px"}},{tag:"rect",id:"line3",color:"#f5f5f5",position:{bottom:"150px",left:"0px",width:"100%",height:"1px"}},{tag:"font",id:"font1",text:"添加收藏",textStyles:{size:"16px",color:"#000"},position:{bottom:"150px",height:"50px"}},{tag:"font",id:"font2",text:"添加关注",textStyles:{size:"16px",color:"#000"},position:{bottom:"100px",height:"50px"}},{tag:"font",id:"font3",text:"举报",textStyles:{size:"16px",color:"#ff0000"},position:{bottom:"50px",height:"50px"}},{tag:"font",id:"font4",text:"取消",textStyles:{size:"16px",color:"#ff0000"},position:{bottom:"0px",height:"50px"}}]);bgview.interceptTouchEvent(true);customview.interceptTouchEvent(true);bgview.addEventListener("click",function(a){HideView()},false);customview.addEventListener("click",function(a){var b=a.clientY;if(b<=50){if(IsKeep){OutKeep()}else{Keep()}}else{if(b>50&&b<=100){if(IsFan){OutFollow()}else{Follow()}}else{if(b>100&&b<=150){Report()}}}HideView()},false)}function ActionTan(a,c,b,e){ArticleNumber=c;ArticleID=b;ArticleUserNumber=e;var d=base.Get("article"+ArticleID)}function Keep(){if(base.RepeatAction()){return}HttpGet(base.RootUrl+"Api/Keep/Edit",{ID:userinfo.ID,ArticleID:ArticleID},function(b){b=JSON.parse(b);base.CheckLogin(userinfo,b.code);if(b!=null){if(b.result){userinfo.Keeps+=1;localStorage.setItem("$userinfo",JSON.stringify(userinfo));var a=base.Get("article"+ArticleID);a.setAttribute("iskeep",1);base.RefreshUser()}mui.toast(b.result?"收藏成功,在[收藏]中可以找到Ta哦!":b.message)}else{mui.toast("失败")}})}function OutKeep(){if(base.RepeatAction()){return}var a=base.Get("article"+ArticleID);mui.confirm("确认取消收藏？","",["确认","取消"],function(b){if(b.index<0){return}if(b.index==0){HttpGet(base.RootUrl+"Api/Keep/Delete",{ID:userinfo.ID,ArticleNumber:ArticleNumber},function(c){c=JSON.parse(c);base.CheckLogin(userinfo,c.code);if(c!=null){if(c.result){if(self.id=="keep"){a.parentNode.removeChild(a);records=records-1;if(records<0){records=0}if(records<=0){base.ShowNone(true)}userinfo.Keeps=records}else{userinfo.Keeps=userinfo.Keeps-1;if(userinfo.Keeps<0){userinfo.Keeps=0}a.setAttribute("iskeep",0)}localStorage.setItem("$userinfo",JSON.stringify(userinfo));base.RefreshUser()}else{mui.toast(c.message)}}else{mui.toast("失败")}})}})}function Follow(){if(base.RepeatAction()){return}HttpGet(base.RootUrl+"Api/Fan/Edit",{ID:userinfo.ID,ToUserNumber:ArticleUserNumber},function(b){b=JSON.parse(b);base.CheckLogin(userinfo,b.code);if(b!=null){if(b.result){var a=base.Get("article"+ArticleID);a.setAttribute("isfollow",1);base.Get("guanzhu"+ArticleID).setAttribute("src","../images/base/follow1.png");base.Get("guanzhu"+ArticleID).classList.remove("guanzhu");base.UpdateFan(userinfo,b.message)}mui.toast(b.result?"关注成功,在[关注]中可以找到Ta哦!":b.message)}else{mui.toast("失败")}})}function OutFollow(){if(base.RepeatAction()){return}mui.confirm("确认取消关注？","",["确认","取消"],function(a){if(a.index<0){return}if(a.index==0){HttpGet(base.RootUrl+"Api/Fan/Delete",{ID:userinfo.ID,ToUserNumber:ArticleUserNumber},function(c){c=JSON.parse(c);if(c.result){userinfo.Follows=userinfo.Follows-1;if(userinfo.Follows<0){userinfo.Follows=0}var b=base.Get("article"+ArticleID);b.setAttribute("isfollow",0);base.Get("guanzhu"+ArticleID).setAttribute("src","../images/base/follow0.png");base.Get("guanzhu"+ArticleID).classList.remove("guanzhu2");base.Get("guanzhu"+ArticleID).classList.add("guanzhu");base.UpdateFan(userinfo,userinfo.Follows)}else{mui.toast(c.message)}})}})}function Report(){base.OpenWindow("edittext","edittext.html",{source:"report",ArticleNumber:ArticleNumber})}function AppendArticle(n,m,h,k,a,l){var e=document.createElement("div");if(l){e.className="mui-card mui-table-view-cell bounceInUp";e.style.padding="0px";e.setAttribute("kid",m.ArticleNumber)}else{e.className="mui-card"}e.setAttribute("iskeep",m.IsKeep);e.setAttribute("isfollow",m.IsFollow);e.style.paddingBottom="0.8rem";e.setAttribute("id","article"+m.ArticleID);var j=[];if(l){j.push('<div class="mui-slider-right mui-disabled tc"><a class="mui-btn mui-btn-red">删除</a></div>')}var d="";var c="";switch(m.ArticlePower){case"0":c="power0.png";d="私密";break;case 1:c="power2.png";d="密码可见";break;case 2:c="power2.png";d="分享可见";break;case 3:c="power1.png";d="公开";break;default:c="power0.png";d="私密";break}if(h){j.push('<div class="c999 f11 star mb10"><img src="../images/article/'+c+'" class="fl" /><span class="fl">'+d+'</span><span class="fr">'+m.CreateDate+"</span></div>")}else{if(l){j.push('<div class="mui-slider-cell mui-slider-handle">')}j.push('<div class="mui-card-header noborder mui-card-media">');if(a){j.push('<img class="user" userid="'+m.UserNumber+'" nickname="'+m.NickName+'"avatar="'+m.Avatar+'"cover="'+m.UserCover+'" onload="LazyImg(this)" src="../images/avatar.png" data-lazyload="'+base.ShowThumb(m.Avatar,1)+'" style="border-radius:50%;width:2rem !important;height:2rem !important;" />')}else{j.push('<img class="user" userid="'+m.UserNumber+'" nickname="'+m.NickName+'"avatar="'+m.Avatar+'"cover="'+m.UserCover+'"src="'+base.ShowThumb(m.Avatar,1)+'" style="border-radius:50%;width:2rem !important;height:2rem !important;" />')}j.push('<div class="mui-media-body f14 mt0" style="position:relative;"><span class="user c333" userid="'+m.UserNumber+'"nickname="'+m.NickName+'"avatar="'+m.Avatar+'"cover="'+m.UserCover+'">'+base.UnUnicodeText(m.NickName)+'</span><p class="f10 full blue mt3">');if(!base.IsNullOrEmpty(m.City)){j.push('<span class="blue">'+m.Province+" • "+m.City+"</span>")}j.push("</p>");if(n!=""&&n!=m.UserNumber){j.push('<img id="guanzhu'+m.ArticleID+'" class="'+(m.IsFollow==0?"guanzhu":"guanzhu2")+'" userid="'+m.UserNumber+'" articleid="'+m.ArticleID+'" articleNumber="'+m.ArticleNumber+'" articleUserNumber="'+m.UserNumber+'" src="../images/base/'+(m.IsFollow==0?"follow0":"follow1")+'.png" style="position:absolute;right:0px;top:0.5rem;width:3rem;" />')}j.push("</div></div></div>")}j.push('<div class="mui-card-content show"><div class="mui-card-content-inner">');j.push('<div class="c333 fl full mb10 f12" style="line-height:1.3rem;">');if(n!=""&&n==m.UserNumber){j.push('<div class="c333 fl article f12" style="width:100%;display:inline-block;" articleid="'+m.ArticleID+'" userid="'+m.UserNumber+'" power="'+m.ArticlePower+'" nickname="'+m.NickName+'">');if(base.IsNullOrEmpty(m.Title)){m.Title="我的小微篇"}j.push(base.UnUnicodeText(m.Title)+"</div>")}else{j.push('<div class="c333 fl article f12" style="width:85%;display:inline-block;" articleid="'+m.ArticleID+'" userid="'+m.UserNumber+'" power="'+m.ArticlePower+'" nickname="'+m.NickName+'">');if(base.IsNullOrEmpty(m.Title)){m.Title="我的小微篇"}j.push(base.UnUnicodeText(m.Title)+'</div><div class="f10 c999 fr tr" style="width:15%;display:inline-block;">'+m.CreateDate+"</div>")}j.push("</div>");var f=m.ArticlePart;j.push('<div class="inline full">');if(f.length==0){if(a){j.push('<div class="onefloor" href="'+base.ShowThumb(m.Cover,1)+'" articleid="'+m.ArticleID+'"><img onload="LazyImg(this)" src="../images/default.png" data-lazyload="'+base.ShowThumb(m.Cover,1)+'" /></div>')}else{j.push('<div class="onefloor" href="'+base.ShowThumb(m.Cover,1)+'" articleid="'+m.ArticleID+'"><img src="'+base.ShowThumb(m.Cover,1)+'" /></div>')}}else{if(f.length==1){if(a){j.push('<div class="onefloor" href="'+base.ShowThumb(f[0].Introduction,1)+'" articleid="'+m.ArticleID+'"><img onload="LazyImg(this)" src="../images/default.png" data-lazyload="'+base.ShowThumb(f[0].Introduction,1)+'" /></div>')}else{j.push('<div class="onefloor" href="'+base.ShowThumb(f[0].Introduction,1)+'" articleid="'+m.ArticleID+'"><img src="'+base.ShowThumb(f[0].Introduction,1)+'" /></div>')}}else{var c=f.length==3?"thirdfloor":"secondfloor";for(var g=0;g<f.length;g++){if(a){j.push('<div class="'+c+'" href="'+base.ShowThumb(f[g].Introduction,1)+'" articleid="'+m.ArticleID+'"><img onload="LazyImg(this)" src="../images/default.png" data-lazyload="'+base.ShowThumb(f[g].Introduction,2)+'" /></div>')}else{j.push('<div class="'+c+'" href="'+base.ShowThumb(f[g].Introduction,1)+'" articleid="'+m.ArticleID+'"><img src="'+base.ShowThumb(f[g].Introduction,2)+'" /></div>')}}}}j.push("</div></div></div>");j.push('<div class="mui-card-footer fl full c333 f11 inline">');var b="height:1.5rem;display:inline-block;";j.push('<div style="'+b+'" class="fl tl"><img src="../images/article/view.png" style="width:1rem;" class="ml5 mr5 fl" /><span class="f13 fl mr10">'+m.Views+"</span></div>");j.push('<div style="'+b+'" class="fl tl goods '+(m.IsZan==0?"":"red")+'" articleid="'+m.ArticleID+'" already="'+(m.IsZan==0?0:1)+'"><img src="../images/article/'+(m.IsZan==0?"btn_good":"btn_good2")+'.png" style="width:0.9rem;" class="ml5 mr5 fl" /><span class="f13 fl mr10">'+m.Goods+"</span></div>");j.push('<div style="'+b+'" class="comments fl tl" articleid="'+m.ArticleID+'" ArticleNumber="'+m.ArticleNumber+'"><img id="icomments'+m.ArticleID+'" src="../images/article/btn_comment.png" style="width:0.9rem;" class="mt1 fl ml5 mr10" /><span class="f13 fl mr10" >'+m.Comments+"</span></div>");if(m.IsPay==1){j.push('<div style="'+b+'" class="pays fl tl" articleid="'+m.ArticleID+'" ArticleNumber="'+m.ArticleNumber+'" UserNumber="'+m.UserNumber+'" NickName="'+m.NickName+'" Avatar="'+m.Avatar+'" articleid="'+m.ArticleID+'"><img id="ipays'+m.ArticleID+'" src="../images/article/btn_pay.png" style="width:0.9rem;" class="mt1 ml5" /></div>')}if(n!=""&&n!=m.UserNumber){j.push('<div style="width:1.5rem;height:100%;" class="fr tanaction" articleId="'+m.ArticleID+'" articleNumber="'+m.ArticleNumber+'" articleUserNumber="'+m.UserNumber+'"><img src="../images/article/btn_more.png" style="width:1rem;" class="mt1" /></div>')}j.push("</div>");if(l){j.push("</div>")}e.innerHTML=j.join("");return e}function ArticleAction(b,a){ArticleAddZan(b,a);ArticleAddPay(b,a);ArticleAddComment(b,a);ArticleAddGuanZhu(b,a,function(){mui.toast("关注成功,在[关注]中可以找到Ta哦!")});ArticleOutGuanZhu(b,a);mui(b).on("tap",".onefloor,.secondfloor,.thirdfloor",function(){if(isLoading){return false}isLoading=true;var e=this.getAttribute("href");ArticleID=this.getAttribute("articleid");var d=0;var f=[];mui.each(this.parentNode.childNodes,function(g,h){if(e==h.getAttribute("href")){d=g}f.push(h.getAttribute("href"))});var c=base.GetView("imageviewer");if(c){c.evalJS("ResetImages('"+f+"','"+ArticleID+"','"+d+"')")}else{base.OpenWindow("imageviewer","imageviewer.html",{Url:f.join(","),Group:ArticleID,CurrID:d},"fade-in",false,"hide","#000")}isLoading=false});mui(b).on("tap",".tanaction",function(){if(isLoading){return false}isLoading=true;ArticleNumber=this.getAttribute("articleNumber");ArticleID=this.getAttribute("articleId");ArticleUserNumber=this.getAttribute("articleUserNumber");var f=base.Get("article"+ArticleID);var e=f.getAttribute("iskeep");var c=f.getAttribute("isfollow");var d=base.GetView("action");if(d){d.evalJS("ResetAction(2,'"+PageName+"','"+e+"','"+c+"')")}else{base.OpenWindow("action","action.html",{Type:2,PageName:PageName,IsKeep:e,IsFollow:c},"none",false,false,"transparent")}isLoading=false})}function ArticleAddZan(b,a){mui(b).on("tap",".goods",function(d){if(base.RepeatAction()){return}var e=this;var c=e.getAttribute("articleid");HttpGet(base.RootUrl+"Api/Zan/ArticleZanEdit",{ID:a.ID,ArticleID:c},function(g){g=JSON.parse(g);base.CheckLogin(a,g.code);if(g!=null){if(g.result){var h=g.message.split("|");if(h[0]==1){e.setAttribute("already","0");e.classList.remove("red");e.classList.remove("heartbeat");e.childNodes[0].setAttribute("src","../images/article/btn_good.png");var f=parseInt(e.childNodes[1].innerHTML);e.childNodes[1].innerHTML=f-1<0?0:f-1}else{e.setAttribute("already","1");e.childNodes[0].setAttribute("src","../images/article/btn_good2.png");var f=parseInt(e.childNodes[1].innerHTML);e.childNodes[1].innerHTML=f+1;e.classList.add("red");e.classList.add("heartbeat")}}else{mui.toast(g.message)}}else{mui.toast("失败")}})})}function ArticleAddPay(b,a){mui(b).on("tap",".pays",function(d){if(base.IsLoading){return false}base.IsLoading=true;var e=this.getAttribute("ArticleNumber");var f=this.getAttribute("NickName");var c=this.getAttribute("Avatar");base.IsLoading=false;base.OpenWindow("money","../page/money.html",{ArticleNumber:e,ArticleUserNumber:"",Name:f,Avatar:c})})}function ArticleAddComment(b,a){mui(b).on("tap",".comments",function(c){if(base.IsLoading){return false}base.IsLoading=true;var d=this.getAttribute("ArticleNumber");base.IsLoading=false;base.OpenWindow("articleComment","../page/articleComment.html",{ArticleNumber:d})})}function ArticleAddGuanZhu(c,a,b){mui(c).on("tap",".guanzhu",function(f){var g=this;var d=this.getAttribute("userid");var e=this.getAttribute("articleid");this.classList.remove("guanzhu");HttpGet(base.RootUrl+"Api/Fan/Edit",{ID:a.ID,ToUserNumber:d},function(h){h=JSON.parse(h);base.CheckLogin(a,h.code);if(h!=null){if(h.result){g.setAttribute("src","../images/base/follow1.png");base.UpdateFan(a,h.message);base.Get("article"+e).setAttribute("isfollow",1);if(b){b(g)}}else{mui.toast(h.message);g.classList.add("guanzhu")}}else{mui.toast("失败");g.classList.add("guanzhu")}})})}function ArticleOutGuanZhu(c,a,b){mui(c).on("tap",".guanzhu2",function(d){ArticleNumber=this.getAttribute("articlenumber");ArticleID=this.getAttribute("articleid");ArticleUserNumber=this.getAttribute("articleusernumber");OutFollow()})};