(function(e,h){var j='<div id="{{id}}" class="mui-slider mui-preview-image mui-fullscreen"><div class="mui-preview-header">{{header}}</div><div class="mui-slider-group"></div><div class="mui-preview-footer mui-hidden">{{footer}}</div><div class="mui-preview-loading"><span class="mui-spinner mui-spinner-white"></span></div></div>';var i='<div class="mui-slider-item mui-zoom-wrapper {{className}}"><div class="mui-zoom-scroller"><img src="{{src}}" data-preview-lazyload="{{lazyload}}" style="{{style}}" class="mui-zoom"></div></div>';var g="__DEFAULT";var b=document.createElement("div");var c=0;var d=true;var a=function(l){this.options=e.extend(true,{id:"__MUI_PREVIEWIMAGE",zoom:true,header:'<span class="mui-preview-indicator"></span>',footer:"",callback1:null,callback2:null},l||{});this.init();this.initEvent()};var f=a.prototype;f.init=function(){var l=this.options;var m=document.getElementById(this.options.id);if(!m){b.innerHTML=j.replace(/\{\{id\}\}/g,this.options.id).replace("{{header}}",l.header).replace("{{footer}}",l.footer);document.body.appendChild(b.firstElementChild);m=document.getElementById(this.options.id)}this.element=m;this.scroller=this.element.querySelector(e.classSelector(".slider-group"));this.indicator=this.element.querySelector(e.classSelector(".preview-indicator"));this.loader=this.element.querySelector(e.classSelector(".preview-loading"));if(l.footer){this.element.querySelector(e.classSelector(".preview-footer")).classList.remove(e.className("hidden"))}this.addImages()};f.initEvent=function(){var m=this;e(document.body).on("tap","img[data-preview-src]",function(){m.open(this);return false});var l=null;var n=function(){!l&&(l=e.later(function(){m.loader.removeEventListener("tap",n);m.scroller.removeEventListener("tap",n);m.close()},300))};this.scroller.addEventListener("doubletap",function(){if(l){l.cancel();l=null}});this.element.addEventListener("webkitAnimationEnd",function(){if(m.element.classList.contains(e.className("preview-out"))){m.element.style.display="none";m.element.classList.remove(e.className("preview-out"));m.element.classList.remove(e.className("preview-in"));l=null}else{m.loader.addEventListener("tap",n);m.scroller.addEventListener("tap",n)}});this.element.addEventListener("slide",function(q){if(m.options.zoom){var p=m.element.querySelector(".mui-zoom-wrapper:nth-child("+(m.lastIndex+1)+")");if(p){e(p).zoom().setZoom(1)}}var o=q.detail.slideNumber;m.lastIndex=o;m.indicator&&(m.indicator.innerText=(o+1)+"/"+m.currentGroup.length);m._loadItem(o)})};f.addImages=function(o,m){this.groups={};var p=[];if(o){if(o===g){p=document.querySelectorAll("img[data-preview-src]:not([data-preview-group])")}else{p=document.querySelectorAll("img[data-preview-src][data-preview-group='"+o+"']")}}else{p=document.querySelectorAll("img[data-preview-src]")}if(p.length){for(var n=0,l=p.length;n<l;n+=1){this.addImage(p[n])}}};f.addImage=function(m){var o=m.getAttribute("data-preview-group");o=o||g;if(!this.groups[o]){this.groups[o]=[]}var p=m.getAttribute("href");if(!p){p=m.getAttribute("src")}if(m.__mui_img_data&&m.__mui_img_data.src===p){this.groups[o].push(m.__mui_img_data)}else{var l=m.getAttribute("data-preview-src");if(!l){l=p}var n={src:p,lazyload:p===l?"":l,loaded:p===l?true:false,sWidth:0,sHeight:0,sTop:0,sLeft:0,sScale:1,el:m};this.groups[o].push(n);m.__mui_img_data=n}};f.empty=function(){this.scroller.innerHTML=""};f._initImgData=function(l,n){if(!l.sWidth){var m=l.el;l.sWidth=m.offsetWidth;l.sHeight=m.offsetHeight;var o=e.offset(m);l.sTop=o.top;l.sLeft=o.left;l.sScale=Math.max(l.sWidth/h.innerWidth,l.sHeight/h.innerHeight)}};f._getScale=function(p,o){var m=p.width/o.width;var l=p.height/o.height;var n=1;if(m<=l){n=p.height/(o.height*m)}else{n=p.width/(o.width*l)}return n};f._imgTransitionEnd=function(m){var l=m.target;l.classList.remove(e.className("transitioning"));l.removeEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this))};f._loadItem=function(n,q){var p=this.scroller.querySelector(e.classSelector(".slider-item:nth-child("+(n+1)+")"));var l=this.currentGroup[n];var r=p.querySelector("img");this._initImgData(l,r);if(q){var o=this._getPosition(l);r.style.webkitTransitionDuration="0ms";r.offsetHeight}if(!l.loaded&&r.getAttribute("data-preview-lazyload")){var m=this;m.loader.classList.add(e.className("active"));r.style.webkitTransitionDuration="0.5s";r.addEventListener("webkitTransitionEnd",m._imgTransitionEnd.bind(m));this.loadImage(r,function(){l.loaded=true;r.src=l.lazyload;m._initZoom(p,this.width,this.height);r.classList.add(e.className("transitioning"));r.addEventListener("webkitTransitionEnd",m._imgTransitionEnd.bind(m));r.setAttribute("style","");r.offsetHeight;m.loader.classList.remove(e.className("active"))})}else{l.lazyload&&(r.src=l.lazyload);this._initZoom(p,r.width,r.height);r.classList.add(e.className("transitioning"));r.addEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this));r.setAttribute("style","");r.offsetHeight}this._preloadItem(n+1);this._preloadItem(n-1)};f._preloadItem=function(m){var n=this.scroller.querySelector(e.classSelector(".slider-item:nth-child("+(m+1)+")"));if(n){var l=this.currentGroup[m];if(!l.sWidth){var o=n.querySelector("img");this._initImgData(l,o)}}};f._initZoom=function(n,q,p){if(!this.options.zoom){return}if(n.getAttribute("data-zoomer")){return}var o=n.querySelector(e.classSelector(".zoom"));if(o.tagName==="IMG"){var m=this;var l=m._getScale({width:n.offsetWidth,height:n.offsetHeight},{width:q,height:p});e(n).zoom({maxZoom:Math.max(l,1)})}else{e(n).zoom()}};f.loadImage=function(n,o){var m=function(){o&&o.call(this)};var l=new Image();l.onload=m;l.onerror=m;l.src=n.getAttribute("data-preview-lazyload")};f.getRangeByIndex=function(l,m){return{from:0,to:m-1}};f._getPosition=function(m){var n=m.sLeft-h.pageXOffset;var l=m.sTop-h.pageYOffset;var p=(h.innerWidth-m.sWidth)/2;var o=(h.innerHeight-m.sHeight)/2;return{left:n,top:l,x:n-p,y:l-o}};f.refresh=function(s,y){this.currentGroup=y;var m=y.length;var p=[];var r=this.getRangeByIndex(s,m);var w=r.from;var x=r.to+1;var t=s;var u="";var z="";var o=h.innerWidth;var v=h.innerHeight;for(var q=0;w<x;w+=1,q+=1){var n=y[w];var l="";if(n.sWidth){}z=i.replace("{{src}}",n.src).replace("{{lazyload}}",n.lazyload).replace("{{style}}",l);if(w===s){t=q;u=e.className("active")}else{u=""}p.push(z.replace("{{className}}",u))}this.scroller.innerHTML=p.join("");this.element.style.display="block";this.element.classList.add(e.className("preview-in"));this.lastIndex=t;this.element.offsetHeight;e(this.element).slider().gotoItem(t,0);this.indicator&&(this.indicator.innerText=(t+1)+"/"+this.currentGroup.length);this._loadItem(t,true)};f.openByGroup=function(l,m){l=Math.min(Math.max(0,l),this.groups[m].length-1);this.refresh(l,this.groups[m])};f.open=function(l,m){if(!d){return}if(this.isShown()){return}if(typeof l==="number"){m=m||g;this.addImages(m,l);this.openByGroup(l,m)}else{m=l.getAttribute("data-preview-group");m=m||g;this.addImages(m,l);this.openByGroup(this.groups[m].indexOf(l.__mui_img_data),m)}if(this.options.callback1!=null){this.options.callback1(1)}};f.close=function(r,v){if(!d){return}if(!this.isShown()){return}this.element.classList.remove(e.className("preview-in"));this.element.classList.add(e.className("preview-out"));var t=this.scroller.querySelector(e.classSelector(".slider-item:nth-child("+(this.lastIndex+1)+")"));var l=t.querySelector("img");if(l){l.classList.add(e.className("transitioning"));var o=this.currentGroup[this.lastIndex];var n=this._getPosition(o);var s=n.left;var u=n.top;if(u>h.innerHeight||s>h.innerWidth||u<0||s<0){l.style.opacity=0;l.style.webkitTransitionDuration="0s";l.style.webkitTransform="scale("+o.sScale+")"}else{if(this.options.zoom){e(l.parentNode.parentNode).zoom().toggleZoom(0)}l.style.webkitTransitionDuration="0s";l.style.webkitTransform="translate3d("+n.x+"px,"+n.y+"px,0) scale("+o.sScale+")"}}var m=this.element.querySelectorAll(e.classSelector(".zoom-wrapper"));for(var p=0,q=m.length;p<q;p+=1){e(m[p]).zoom().destroy()}e(this.element).slider().destroy();if(this.options.callback2!=null){this.options.callback2(0)}};f.isShown=function(){return this.element.classList.contains(e.className("preview-in"))};var k=null;e.previewImage=function(l){if(!k){k=new a(l)}return k};e.getPreviewImage=function(){return k};e.setPreviewEnable=function(l){d=l}})(mui,window);