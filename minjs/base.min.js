(function(d,c){var e=d.documentElement,b="orientationchange" in window?"orientationchange":"resize",a=function(){var g=e.clientWidth;var f=localStorage.getItem("$screenwidth");if(f){g=f}if(!g){return}e.style.fontSize=16*(g/320)+"px";e.style.width="100%";e.style.height="100%"};if(!d.addEventListener){return}c.addEventListener(b,a,false);d.addEventListener("DOMContentLoaded",a,false);(function(){return;var j=scale=1;var g=c.navigator.appVersion.match(/iphone/gi);var f=c.devicePixelRatio;if(g){if(f>=3&&(!j||j>=3)){j=3}else{if(f>=2&&(!j||j>=2)){j=2}else{j=1}}}else{j=1}scale=1/j;var h="";h=d.createElement("meta");h.setAttribute("name","viewport");h.setAttribute("content","initial-scale="+scale+", maximum-scale="+scale+", minimum-scale="+scale+", user-scalable=no");if(e.firstElementChild){e.firstElementChild.appendChild(h)}else{var i=d.createElement("div");i.appendChild(h);d.write(i.innerHTML)}})()})(document,window);var waiting=new function(){this.create=function(b){var a=base.Get("waiting");if(a){base.Get("waiting_title").innerHTML=b;return a}var c=document.createElement("div");c.className="waiting c333 f13 tc";c.setAttribute("id","waiting");c.style.zIndex="2147483647";c.innerHTML='<div><img src="../images/loading.gif" class="fl" /><span id="waiting_title">'+b+"</span></div>";document.getElementsByTagName("body")[0].appendChild(c);return c};this.setTitle=function(b){var a=this.create(b);base.Get("waiting_title").innerHTML=b};this.show=function(b){var a=this.create(b);a.classList.remove("hide")};this.close=function(){var a=this.create("");a.classList.add("hide")}};var isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"};var browser={versions:function(){var a=navigator.userAgent,b=navigator.appVersion;return{trident:a.indexOf("Trident")>-1,presto:a.indexOf("Presto")>-1,webKit:a.indexOf("AppleWebKit")>-1,gecko:a.indexOf("Gecko")>-1&&a.indexOf("KHTML")==-1,mobile:!!a.match(/AppleWebKit.*Mobile.*/),ios:!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:a.indexOf("Android")>-1||a.indexOf("Linux")>-1,iPhone:a.indexOf("iPhone")>-1,iPad:a.indexOf("iPad")>-1,webApp:a.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()};var base=new function(){this.ErrorCode={UnLogin:1};this.TriggerMain=true;this.InitPosition=function(c,b){plus.geolocation.getCurrentPosition(function(e){var d={Province:e.address.province,City:e.address.city,District:e.address.district,Street:e.address.street,DetailName:e.address.poiName,CityCode:e.address.cityCode,Latitude:e.coords.latitude,Longitude:e.coords.longitude};localStorage.setItem("$position",JSON.stringify(d));if(c){c()}},function(d){localStorage.removeItem("$position");if(b){b()}})};this.GetCurrentPosition=function(){var b=localStorage.getItem("$position")||"";if(base.IsNullOrEmpty(b)){return{Province:"",City:"",District:"",Street:"",DetailName:"",CityCode:"",Latitude:"",Longitude:""}}return JSON.parse(b)};this.youku_client_id="59bec9b0be1fc34b";this.youku_client_secret="244a6bbc4b212e01b8702745b879e52d";this.IsLoading=false;this.CurrAnimate="";this.PageSize=15;this.AnimateDuration=350;this.RootUrl="http://www.xiaoweipian.com/";this.RootUrlTest="http://www.xiaoweipian.com:8080/";this.DefaultImg="../images/logo_default.png";this.DefaultAvatar="../images/avatar.png";this.ShowLoading=function(b){if(b){base.Get("loader").classList.remove("hide")}else{base.Get("loader").classList.add("hide")}};this.ShowNone=function(b){if(b){base.Get("none").classList.remove("hide")}else{base.Get("none").classList.add("hide")}};this.GetUserInfo=function(){var b=localStorage.getItem("$userinfo")||"";if(b==""){return""}return JSON.parse(b)};this.GetSettings=function(){var b=localStorage.getItem("$settings")||"{}";return JSON.parse(b)};this.CheckLogin=function(b,c){if(b==""||c==base.ErrorCode.UnLogin){base.IsLoading=false;base.OpenWindow("login","../page/login.html",{},"fade-in");return false}};this.IsNullOrEmpty=function(b){if(!b){return true}if(b==""){return true}if(b.toString().toLowerCase()=="null"){return true}if(b.toString().toLowerCase()=="undefined"){return true}return false};this.FormatStr=function(b,c){return base.IsNullOrEmpty(b)||b==" "?c:b};this.GetUid=function(){return new Date().getTime().toString()};this.CheckPhone=function(b){if(base.IsNullOrEmpty(b)){return false}return b.length==11&&!isNaN(b)&&(/^1[3|4|5|6|7|8|9][0-9]\d{4,8}$/.test(b))};this.ShowWaiting=function(b){waiting.show(b)};this.CloseWaiting=function(){waiting.close()};this.Waiting=function(b,c){if(b){plus.nativeUI.showWaiting(c,{width:"80%",padding:"5%",background:"rgba(0,0,0,0.6)",loading:{display:"inline"}})}else{plus.nativeUI.closeWaiting()}};this.CreateMask=function(c,e){var d=document.createElement("div");d.classList.add("mui-backdrop");d.addEventListener(mui.EVENT_MOVE,mui.preventDefault);d.addEventListener("tap",function(){if(b._enable){b.close()}});var b=[d];b._show=false;b._enable=c;b.show=function(){b._show=true;d.setAttribute("style","opacity:1");document.body.appendChild(d);return b};b._remove=function(){if(b._show){b._show=false;d.setAttribute("style","opacity:0");mui.later(function(){var f=document.body;d.parentNode===f&&f.removeChild(d)},350)}return b};b.close=function(){b._remove();e()};return b};var a=null;this.RepeatAction=function(){if(a){return true}a=new Date().getTime();mui.later(function(){a=null},1000);return false};this.ShowAnimate=function(){var b="pop-in";if(mui.os.android){if(parseFloat(mui.os.version)<4.4){b="slide-in-right"}}return b};this.HideAnimate=function(){var b="pop-out";if(mui.os.android){if(parseFloat(mui.os.version)<4.4){b="slide-out-right"}}return b};this.OpenWindow=function(i,d,h,c,g,b,e){if(base.RepeatAction()){return}var f={top:"0px",bottom:"0px",width:"100%",height:"100%",popGesture:"close",bounce:g?g:"none",scrollIndicator:"none",backButtonAutoControl:b?b:"none"};if(e){f.background=e}mui.openWindow({id:i,url:d,show:{autoShow:true,duration:c&&c=="none"?0:base.AnimateDuration,aniShow:c?c:base.ShowAnimate()},styles:f,createNew:true,waiting:{autoShow:false},extras:h})};this.OpenWindowNew=function(e,i,h,g){var c=plus.webview.create(e,i,h,g),f=new plus.nativeObj.Bitmap("nwbitmap");console.log("aa");var b=function(j,k,l){console.log("aaaa");plus.nativeObj.View.startAnimation({type:j||"pop-in"},{},{bitmap:k},function(){console.log("动画结束");l&&l()})};console.log("bb");var d=function(j,k,l){k=k||new plus.nativeObj.Bitmap("defultBitMap");j.draw(k,function(){l&&l(k)},function(m){l&&l();console.log("截图错误："+JSON.stringify(m))})};console.log("cc");c.onloaded=function(j){console.log("dd");d(c,f,function(k){console.log(k);if(!k){c.show("pop-in",250);return}b("pop-in",k,function(){console.log("ee");c.show("none",0,function(){console.log("ff");c.onclose=function(){b("pop-out",k,function(){plus.nativeObj.View.clearAnimation()})};plus.nativeObj.View.clearAnimation()})})})}};this.UpdateFan=function(c,b){if(b){c.Follows=b}else{c.Follows+=1}localStorage.setItem("$userinfo",JSON.stringify(c));base.RefreshUser()};this.InitSlider=function(b){mui(".mui-slider").slider({bounce:b});mui(".mui-scroll-wrapper.mui-slider-indicator.mui-segmented-control").scroll({scrollY:false,scrollX:true,indicators:false,bounce:false,snap:".mui-control-item"})};this.InitScroll=function(c){var b=mui.os.ios?0.003:0.0009;mui(".mui-scroll-wrapper").scroll({bounce:c?c:false,indicators:false,deceleration:b})};this.RefreshScroll=function(){mui(".mui-scroll-wrapper").scroll().refresh()};this.ToTop=function(){base.Get("header").addEventListener("doubletap",function(){if(base.IsLoading){return}base.IsLoading=true;mui.scrollTo(0,250);mui.later(function(){base.IsLoading=false},250)},false)};this.UpdateUser=function(c,b){HttpGet(base.RootUrl+"User/Info",{Number:c},function(d){if(d!=null){if(d.result){d=d.message;var e={ID:d.ID,Sex:d.Sex=="0"?"男":"女",Signature:d.Signature,Password:d.Password,Avatar:d.Avatar==""?base.DefaultImg:d.Avatar,NickName:d.NickName,Address:d.Address,Birthday:d.BirthdayText,Follows:d.Follows,Fans:d.Fans,Articles:d.Articles,Keeps:d.Keeps,Comments:d.Comments,Zans:d.Zans,Cover:d.Cover,Phone:d.Phone,WeiXin:d.WeiXin,QQ:d.QQ,Weibo:d.Weibo,ShareNick:d.ShareNick,AutoMusic:d.AutoMusic,IsPay:d.IsPay,Money:d.Money,UseDraw:d.UseDraw,Number:d.Number,ShowZan:d.ShowZan,ShowKeep:d.ShowKeep,ShowFollow:d.ShowFollow,ShowFan:d.ShowFan,ShowPush:d.ShowPush,ShowPosition:d.ShowPosition,UserRole:d.UserRole};localStorage.setItem("$userinfo",JSON.stringify(e));if(b){b(e)}}}})};this.ShowUser=function(b){mui(b).on("tap",".user",function(f){if(!base.TriggerMain){return false}var d=this.getAttribute("userid");var c=this.getAttribute("nickname");var g=this.getAttribute("cover");var e=this.getAttribute("avatar");base.OpenWindow("user"+d,"user.html",{UserNumber:d,NickName:c,Cover:g,Avatar:e},"","none")})};this.ShowArticle=function(d,b,c){mui(d).on("tap",".article",function(h){var g=this.getAttribute("articleid");var i=this.getAttribute("userid");var f=this.getAttribute("power").toString();var e=this.getAttribute("nickname").toString();if(c==i){f=3}base.OpenWindow("articledetail","articledetail.html",{ArticleID:g,Source:b,ArticlePower:f,NickName:e},null,"none")})};this.ShowThumb=function(c,b){if(base.IsNullOrEmpty(c)){return base.DefaultImg}if(c.indexOf("_0")<0){return c}c=c.replace("_0","_"+b);if(c.toString().toLowerCase().indexOf("http://")<0){c=base.RootUrl+c}return c};this.ShareLog=function(b,d,e,c){HttpGet(base.RootUrl+"ShareLog/Edit",{UserNumber:b,Number:d,Source:e,ShareType:c},function(f){})};this.SwitchChange=function(c,b){base.ToggleClass(["#"+c],"active",b)};this.AppendUser=function(l,d,j,h,f,i,k,m){var c=document.createElement("div");if(m){c.className="mui-table-view-cell user user1 bounceInUp"}else{c.className="mui-table-view-cell user user1"}c.setAttribute("userid",l.Number);c.setAttribute("nickname",l.NickName);c.setAttribute("cover",l.Cover);c.setAttribute("avatar",l.Avatar);var g=[];if(h){g.push('<div class="mui-slider-right mui-disabled"><a class="mui-btn mui-btn-red">'+f+"</a></div>");g.push('<div class="mui-slider-cell mui-slider-handle">')}g.push('<div class="flex-box flex-row">');g.push('<div style="flex:0 0 16%;" class="flex-item tl">');if(k){g.push('<div class="avatar"><img onload="LazyImg(this)" src="../images/avatar.png" data-lazyload="'+base.ShowThumb(l.Avatar,1)+'" class="fl"  /></div>')}else{g.push('<div class="avatar"><img src="'+base.ShowThumb(l.Avatar,1)+'" class="fl"  /></div>')}g.push("</div>");if(j){g.push('<div style="flex:0 0 64%;" class="flex-item tl">')}else{g.push('<div style="flex:0 0 84%;" class="flex-item">')}g.push('<p class="f13 c333 mt3">'+base.UnUnicodeText(l.NickName)+"</p>");if(d){g.push('<p class="f10 mt3 c999">'+base.UnUnicodeText(l.Signature)+"</p>")}if(i){var b=parseFloat(l.Distance);var e=parseInt(b/100);if(e<9){g.push('<p class="f10 mt3 c999">'+(e+1)+"00米以内</p>")}else{g.push('<p class="f10 mt3 c999">'+(parseInt(b/1000)+1)+"公里以内</p>")}}g.push("</div>");if(j){g.push('<div style="flex:0 0 20%;" class="flex-item tr">');if(l.IsFollow==0&&userinfo.Number!=l.Number){g.push('<div class="guanzhu" userid="'+l.Number+'"><img src="../images/base/follow0.png" class="fr" /></div>')}else{g.push('<div class="guanzhu2" userid="'+l.Number+'"><img src="../images/base/follow1.png" class="fr" /></div>')}g.push("</div>")}g.push("</div>");if(h){g.push("</div>")}c.innerHTML=g.join("");return c};this.UserAddFan=function(c,b){mui(c).on("tap",".guanzhu",function(e){base.TriggerMain=false;if(base.IsLoading){return false}base.IsLoading=true;var g=this;var d=this.getAttribute("userid");var f={ID:b.ID,ToUserNumber:d};HttpGet(base.RootUrl+"Api/Fan/Edit",f,function(h){h=JSON.parse(h);base.CheckLogin(b,h.code);if(h!=null){if(h.result){g.classList.remove("guanzhu");g.classList.add("guanzhu2");g.childNodes[0].setAttribute("src","../images/base/follow1.png");base.UpdateFan(b,h.message)}mui.toast(h.result?"关注成功,在[关注]中可以找到Ta哦!":h.message)}else{mui.toast("失败")}base.IsLoading=false;base.TriggerMain=true})})};this.UserOutFan=function(c,b){mui(c).on("tap",".guanzhu2",function(e){base.TriggerMain=false;if(base.IsLoading){return false}base.IsLoading=true;var f=this;var d=this.getAttribute("userid");mui.confirm("确认取消关注？","",["确认","取消"],function(g){if(g.index<0){base.IsLoading=false;base.TriggerMain=true;return}if(g.index==0){HttpGet(base.RootUrl+"Api/Fan/Delete",{ID:b.ID,ToUserNumber:d},function(h){h=JSON.parse(h);base.CheckLogin(b,h.code);if(h.result){f.classList.remove("guanzhu2");f.classList.add("guanzhu");f.childNodes[0].setAttribute("src","../images/base/follow0.png");base.UpdateFan(b,records)}else{mui.toast(h.message)}base.IsLoading=false;base.TriggerMain=true})}else{base.IsLoading=false;base.TriggerMain=true}})})};this.UnicodeText=function(b){if(base.IsNullOrEmpty(b)){return""}return escape(b).toLocaleLowerCase().replace(/%u/gi,"\\u")};this.UnUnicodeText=function(b){if(base.IsNullOrEmpty(b)){return""}return unescape(b.replace(/\\u/gi,"%u"))};this.AddClass=function(b,c){this.ToggleClass(b,c,true)};this.RemoveClass=function(b,c){this.ToggleClass(b,c,false)};this.ToggleClass=function(c,b,e){if(base.IsNullOrEmpty(c)){return}var d=b.split(" ");if(e){mui.each(c,function(h,g){if(g.indexOf(".")<0){var f=mui(g)[0];mui.each(d,function(i,j){f.classList.add(j)})}else{mui.each(d,function(i,j){mui(g).each(function(l,k){k.classList.add(j)})})}})}else{mui.each(c,function(h,g){if(g.indexOf(".")<0){var f=mui(g)[0];mui.each(d,function(i,j){f.classList.remove(j)})}else{mui.each(d,function(i,j){mui(g).each(function(l,k){k.classList.remove(j)})})}})}};this.HasClass=function(c,b){return c.className.indexOf(b)>=0};this.Get=function(b){if(b.indexOf(".")<0){return mui("#"+b)[0]}else{return mui(b)}};this.GetView=function(b){return plus.webview.getWebviewById(b)};this.RefreshUser=function(){if(base.GetView("my")!=null){base.GetView("my").evalJS("Refresh()")}};this.InitPull=function(d,b,c){mui(base.Get(d)).pullToRefresh({down:{callback:function(){if(b){b()}var e=this;pulldownRefresh(e)}},up:{auto:true,callback:function(){if(c){c()}var e=this;pullupRefresh(e)}}})};this.BrowserName=function(){var b="";if(browser.versions.webKit){b="-webkit-"}else{if(browser.versions.gecko){b="-moz-"}else{if(browser.versions.presto){b="-o-"}else{if(browser.versions.trident){b="-ms-"}}}}return b};this.Immersed=function(f){var b=0;var d=(/Html5Plus\/.+\s\(.*(Immersed\/(\d+\.?\d*).*)\)/gi).exec(navigator.userAgent);if(d&&d.length>=3){b=parseFloat(d[2])}if(!b){return}var e=document.getElementById("header");if(e){e.style.paddingTop=b+"px";e.style.paddingBottom="45px";if(e.getAttribute("immersed")!="none"){e.style.background="-webkit-linear-gradient(left,#4e8cfb 0%,#24c3fb 75%,#39b8fd 100%)";var c=base.BrowserName();e.style.background=c+"linear-gradient(left,#4e8cfb 0%,#24c3fb 75%,#39b8fd 100%)";e=document.getElementById("scroll-wrapper");if(e){e.style.marginTop=b+"px"}}else{e.style.background="transparent";e=document.getElementById("scroll-wrapper");if(e){e.style.marginTop="0px"}}}e=document.getElementById("muicontent");if(e){e.style.paddingTop=b+45+"px"}};this.ShowTemplate=function(g,c,f,e,b,d){if(base.RepeatAction()){return}base.GetView("template").evalJS("InitPage('"+g+"', '"+c+"', '"+f+"', '"+e+"', '"+d+"')");base.GetView("template").show(base.IsNullOrEmpty(b)?base.ShowAnimate():b,base.AnimateDuration)}};function HttpGet(a,b,c){mui.getJSON(a,b,c)}function HttpPost(a,b,c){mui.post(a,b,c,"json")}function ChangeSlider(b){var a=b.parentNode.children[0];a.style.width=b.clientWidth+"px";a.style.transform="translateX("+b.offsetLeft+"px)";base.RemoveClass([".tabs_item"],"is-active");b.classList.add("is-active")}function LoadPull(a,d,f,b,e,c){HttpGet(a,d,function(i){var j="";i=JSON.parse(i);if(i!=null){if(i.result){i=i.message;totalpage=i.totalpage;records=i.records;if(f){base.ShowNone(false)}var h=base.Get("scroll-view");if(records>0){j=i.list;if(b){DelayEachArray(i.list,0,50,base.CurrAnimate,function(k){var l=e(k);h.appendChild(l)})}else{var g=document.createDocumentFragment();mui.each(i.list,function(k,l){g.appendChild(e(l))});h.appendChild(g)}}}else{totalpage=1;records=0}}if(records==0&&f){base.ShowNone(true)}if(c){c(j)}base.ShowLoading(false)})}function LoadScript(b,c){var a=document.createElement("script");a.type="text/javascript";if(typeof(c)!="undefined"){if(a.readyState){a.onreadystatechange=function(){if(a.readyState=="loaded"||a.readyState=="complete"){a.onreadystatechange=null;c()}}}else{a.onload=function(){c()}}}a.src=b;document.body.appendChild(a)}function DelayEachArray(a,c,b,d,e){if(c==0){base.CurrAnimate=d}if(d!=base.CurrAnimate){return}if(e){e(a[c])}c++;if(c<a.length){mui.later(function(){DelayEachArray(a,c,b,d,e)},b)}else{base.CurrAnimate=""}}function Top(){mui.scrollTo(0,250)}function SetPullEnable(a,b){if(a){self.setPullToRefresh({support:true,height:"100px",style:"circle"},function(){if(b){b()}else{pulldownRefresh()}})}else{self.setPullToRefresh({support:false,style:"circle",height:"0px"},function(){})}}function LazyImg(a){a.removeAttribute("onload");a.setAttribute("src",a.getAttribute("data-lazyload"))}var PushType={Comment:1,Money:2,Fan:3,FanArticle:4,Article:5,Update:10};